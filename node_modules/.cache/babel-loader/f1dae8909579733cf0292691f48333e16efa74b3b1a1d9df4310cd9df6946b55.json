{"ast":null,"code":"import _objectWithoutProperties from\"/workspaces/Sofalia-v8/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _objectSpread from\"/workspaces/Sofalia-v8/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const _excluded=[\"packItemId\"],_excluded2=[\"label\"],_excluded3=[\"label\",\"children\"];import React,{useState,useEffect,useMemo,useCallback}from'react';import{initializeApp}from'firebase/app';import{getAuth,onAuthStateChanged,signInAnonymously,signInWithCustomToken}from'firebase/auth';import{getFirestore,collection,doc,addDoc,updateDoc,deleteDoc,onSnapshot,query,writeBatch,getDoc,setDoc,getDocs,where,orderBy,runTransaction}from'firebase/firestore';import{Printer,Plus,Trash2,Edit,X,Users,Package,ShoppingCart,DollarSign,BarChart2,Tag,Image as ImageIcon,CreditCard,CheckCircle,ListChecks,Settings,AlertCircle,FileText,ArrowLeft,Filter,Share2,List,LayoutGrid,MinusCircle,PlusCircle,Search,Archive,ChevronDown,Phone,MessageSquare,Menu}from'lucide-react';// --- Translations ---\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const translations={fr:{dashboard:\"Tableau de Bord\",products:\"Produits\",categories:\"Catégories\",customers:\"Clients\",sales:\"Ventes\",debts:\"Créances\",refunds:\"Remboursements\",settings:\"Paramètres\",newSale:\"Nouvelle Vente\",searchPlaceholder:\"Rechercher une facture, un client, un produit...\",searchResults:\"Résultats de la recherche\",invoices:\"Factures\",salesToday:\"Ventes du Jour\",totalSales:\"Total Ventes\",lowStock:\"Stocks Faibles\",currentStock:\"Stock Actuel\",threshold:\"Seuil\",recentSales:\"Ventes Récentes\",invoiceNo:\"N° Facture\",total:\"Total\",date:\"Date\",addProduct:\"Ajouter Produit\",startSale:\"Démarrer la Vente\",productList:\"Liste des produits\",stockManagement:\"Gestion du Stock\",photo:\"Photo\",name:\"Nom\",category:\"Catégorie\",stock:\"Stock\",price:\"Prix\",actions:\"Actions\",edit:\"Modifier\",delete:\"Supprimer\",addCategory:\"Ajouter Catégorie\",parentCategory:\"Catégorie Parente\",addCustomer:\"Ajouter Client\",searchCustomer:\"Rechercher un client...\",nickname:\"Surnom\",phone:\"Téléphone\",customerDeposit:\"Acompte Client\",loading:\"Chargement...\",backToList:\"Retour à la liste\",purchaseHistory:\"Historique des achats\",noPurchases:\"Aucun achat enregistré.\",filter:\"Filtrer\",hide:\"Masquer\",today:\"Aujourd'hui\",thisWeek:\"Cette semaine\",thisMonth:\"Ce mois\",thisYear:\"Cette année\",all:\"Toutes\",from:\"Du\",to:\"Au\",totalDisplayed:\"Total affiché\",amountDue:\"Montant Dû\",makePayment:\"Faire un paiement\",refundHistory:\"Historique de Remboursements\",amount:\"Montant\",method:\"Méthode\",invoiceRef:\"Facture Réf.\",generalInfo:\"Informations Générales\",companyName:\"Nom de l'entreprise\",address:\"Adresse\",docCustomization:\"Personnalisation des Documents\",salesInvoicePrefix:\"Préfixe Facture de Vente\",refundInvoicePrefix:\"Préfixe Facture de Remboursement\",depositReceiptPrefix:\"Préfixe Reçu d'Acompte\",invoiceFooterMessage:\"Message de Pied de Facture\",save:\"Enregistrer\",language:\"Langue\",francais:\"Français\",english:\"Anglais\",editProduct:\"Modifier Produit\",productName:\"Nom du produit\",productType:\"Type de Produit\",standardItem:\"Article Standard (Simple ou avec Gammes)\",pack:\"Pack\",quantity:\"Quantité\",reorderThreshold:\"Seuil de réappro.\",salePrice:\"Prix de Vente\",basePrice:\"Prix de Base\",productVariantsOptional:\"Gammes du Produit (Optionnel)\",packSalePrice:\"Prix de Vente du Pack\",packComposition:\"Composition du Pack\",mainCategory:\"Catégorie Principale\",select:\"Sélectionner...\",subCategory:\"Sous-catégorie\",description:\"Description\",cancel:\"Annuler\",update:\"Mettre à jour\",add:\"Ajouter\",variantName:\"Nom Gamme\",priceMod:\"Modif. Prix\",reorderThresh:\"Seuil Réappro.\",product:\"Produit\",chooseProduct:\"Choisir un produit...\",variant:\"Gamme\",chooseVariant:\"Choisir une gamme...\",editCategory:\"Modifier Catégorie\",addCategoryTitle:\"Ajouter Catégorie\",parentCategoryOptional:\"Catégorie Parente (Optionnel)\",noneMain:\"Aucune (Principale)\",editCustomer:\"Modifier Client\",addCustomerTitle:\"Ajouter Client\",fullName:\"Nom complet\",nicknameOptional:\"Surnom (Optionnel)\",addressOptional:\"Adresse (Optionnel)\",email:\"Email\",addDeposit:\"Ajouter un dépôt\",for:\"pour\",depositAmount:\"Montant du dépôt (F CFA)\",salesCart:\"Panier de Vente\",items:\"Articles\",cartEmpty:\"Le panier est vide.\",summary:\"Résumé\",discount:\"Remise\",applyVAT:\"Appliquer la TVA (18%)\",paymentType:\"Type de paiement\",subtotal:\"Sous-total\",continueShopping:\"Poursuivre les achats\",validateSale:\"Valider la Vente\",paymentReceipt:\"REÇU DE PAIEMENT\",receivedFrom:\"Reçu de :\",originalInvoice:\"Facture d'origine :\",amountPaid:\"Montant Payé:\",paymentMethod:\"Méthode de paiement:\",remainingBalanceDebt:\"Solde Restant sur la Créance:\",close:\"Fermer\",share:\"Partager\",print:\"Imprimer\",depositReceipt:\"REÇU D'ACOMPTE\",depositAmountLabel:\"Montant de l'acompte:\",newDepositBalance:\"Nouveau solde d'acompte:\",invoice:\"FACTURE\",billedTo:\"Facturé à :\",payment:\"Paiement :\",qty:\"Qté\",pu:\"P.U.\",amountBeforeTax:\"Montant HT:\",vat18:\"TVA (18%):\",thankYou:\"Merci pour votre achat !\",makeAPayment:\"Faire un Paiement\",remainingBalance:\"Solde Restant:\",available:\"Disponible:\",savePayment:\"Enregistrer Paiement\",selectProducts:\"Sélectionner des produits\",search:\"Rechercher...\",viewCart:\"Voir le Panier\",manageStock:\"Gérer le stock\",addToCart:\"Ajouter au panier\",appeler:\"Appeler\",sms:\"SMS\",salesComparison:\"Comparaison des Ventes (Hier / Aujourd'hui)\",yesterday:\"Hier\"},en:{dashboard:\"Dashboard\",products:\"Products\",categories:\"Categories\",customers:\"Customers\",sales:\"Sales\",debts:\"Debts\",refunds:\"Refunds\",settings:\"Settings\",newSale:\"New Sale\",searchPlaceholder:\"Search for an invoice, customer, product...\",searchResults:\"Search Results\",invoices:\"Invoices\",salesToday:\"Today's Sales\",totalSales:\"Total Sales\",lowStock:\"Low Stock\",currentStock:\"Current Stock\",threshold:\"Threshold\",recentSales:\"Recent Sales\",invoiceNo:\"Invoice #\",total:\"Total\",date:\"Date\",addProduct:\"Add Product\",startSale:\"Start Sale\",productList:\"Product List\",stockManagement:\"Stock Management\",photo:\"Photo\",name:\"Name\",category:\"Category\",stock:\"Stock\",price:\"Price\",actions:\"Actions\",edit:\"Edit\",delete:\"Delete\",addCategory:\"Add Category\",parentCategory:\"Parent Category\",addCustomer:\"Add Customer\",searchCustomer:\"Search for a customer...\",nickname:\"Nickname\",phone:\"Phone\",customerDeposit:\"Customer Deposit\",loading:\"Loading...\",backToList:\"Back to list\",purchaseHistory:\"Purchase History\",noPurchases:\"No purchases recorded.\",filter:\"Filter\",hide:\"Hide\",today:\"Today\",thisWeek:\"This week\",thisMonth:\"This month\",thisYear:\"This year\",all:\"All\",from:\"From\",to:\"To\",totalDisplayed:\"Total displayed\",amountDue:\"Amount Due\",makePayment:\"Make Payment\",refundHistory:\"Refund History\",amount:\"Amount\",method:\"Method\",invoiceRef:\"Invoice Ref.\",generalInfo:\"General Information\",companyName:\"Company Name\",address:\"Address\",docCustomization:\"Document Customization\",salesInvoicePrefix:\"Sales Invoice Prefix\",refundInvoicePrefix:\"Refund Invoice Prefix\",depositReceiptPrefix:\"Deposit Receipt Prefix\",invoiceFooterMessage:\"Invoice Footer Message\",save:\"Save\",language:\"Language\",francais:\"French\",english:\"English\",editProduct:\"Edit Product\",productName:\"Product Name\",productType:\"Product Type\",standardItem:\"Standard Item (Simple or with Variants)\",pack:\"Pack\",quantity:\"Quantity\",reorderThreshold:\"Reorder Threshold\",salePrice:\"Sale Price\",basePrice:\"Base Price\",productVariantsOptional:\"Product Variants (Optional)\",packSalePrice:\"Pack Sale Price\",packComposition:\"Pack Composition\",mainCategory:\"Main Category\",select:\"Select...\",subCategory:\"Sub-category\",description:\"Description\",cancel:\"Cancel\",update:\"Update\",add:\"Add\",variantName:\"Variant Name\",priceMod:\"Price Mod.\",reorderThresh:\"Reorder Thresh.\",product:\"Product\",chooseProduct:\"Choose a product...\",variant:\"Variant\",chooseVariant:\"Choose a variant...\",editCategory:\"Edit Category\",addCategoryTitle:\"Add Category\",parentCategoryOptional:\"Parent Category (Optional)\",noneMain:\"None (Main)\",editCustomer:\"Edit Customer\",addCustomerTitle:\"Add Customer\",fullName:\"Full Name\",nicknameOptional:\"Nickname (Optional)\",addressOptional:\"Address (Optional)\",email:\"Email\",addDeposit:\"Add a deposit\",for:\"for\",depositAmount:\"Deposit Amount (F CFA)\",salesCart:\"Sales Cart\",items:\"Items\",cartEmpty:\"The cart is empty.\",summary:\"Summary\",discount:\"Discount\",applyVAT:\"Apply VAT (18%)\",paymentType:\"Payment Type\",subtotal:\"Subtotal\",continueShopping:\"Continue Shopping\",validateSale:\"Validate Sale\",paymentReceipt:\"PAYMENT RECEIPT\",receivedFrom:\"Received from:\",originalInvoice:\"Original Invoice:\",amountPaid:\"Amount Paid:\",paymentMethod:\"Payment Method:\",remainingBalanceDebt:\"Remaining Balance on Debt:\",close:\"Close\",share:\"Share\",print:\"Print\",depositReceipt:\"DEPOSIT RECEIPT\",depositAmountLabel:\"Deposit amount:\",newDepositBalance:\"New deposit balance:\",invoice:\"INVOICE\",billedTo:\"Billed to:\",payment:\"Payment:\",qty:\"Qty\",pu:\"P.U.\",amountBeforeTax:\"Amount before tax:\",vat18:\"VAT (18%):\",thankYou:\"Thank you for your purchase!\",makeAPayment:\"Make a Payment\",remainingBalance:\"Remaining Balance:\",available:\"Available:\",savePayment:\"Save Payment\",selectProducts:\"Select products\",search:\"Search...\",viewCart:\"View Cart\",manageStock:\"Manage Stock\",addToCart:\"Add to Cart\",appeler:\"Call\",sms:\"SMS\",salesComparison:\"Sales Comparison (Yesterday / Today)\",yesterday:\"Yesterday\"}};// --- Firebase Configuration ---\nconst firebaseConfig=typeof __firebase_config!=='undefined'?JSON.parse(__firebase_config):{};const appId=typeof __app_id!=='undefined'?__app_id:'default-app-id';// --- Firebase Initialization ---\nconst app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);// --- Constants ---\nconst PAYMENT_TYPES=[\"Espèce\",\"Wave\",\"Orange Money\",\"Créance\",\"Acompte Client\"];const ROLES={ADMIN:'admin',VENDEUR:'vendeur'};const SALE_STATUS={COMPLETED:'Complété',PARTIALLY_RETURNED:'Partiellement Retourné',RETURNED:'Retourné',CREDIT:'Créance'};const VAT_RATE=0.18;// 18%\nconst PRODUCT_TYPES={SIMPLE:'simple',PACK:'pack',VARIANT:'variant'};// --- Utility Functions ---\nconst formatCurrency=function(number){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'fr';const locale=lang==='fr'?'fr-FR':'en-US';const currencyDisplay='F CFA';if(isNaN(Number(number)))return\"0 \".concat(currencyDisplay);return Number(number).toLocaleString(locale,{minimumFractionDigits:0,maximumFractionDigits:0}).replace(/,/g,' ')+\" \".concat(currencyDisplay);};const formatDateTime=function(isoString){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'fr';if(!isoString)return'N/A';const date=new Date(isoString);const options={day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hourCycle:'h23'};const locale=lang==='fr'?'fr-FR':'en-US';return new Intl.DateTimeFormat(locale,options).format(date);};const formatDate=function(isoString){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'fr';if(!isoString)return'N/A';const date=new Date(isoString);const options={day:'2-digit',month:'2-digit',year:'numeric'};const locale=lang==='fr'?'fr-FR':'en-US';return new Intl.DateTimeFormat(locale,options).format(date);};const toInputDate=date=>{if(!date)return'';const d=new Date(date);const year=d.getFullYear();const month=(d.getMonth()+1).toString().padStart(2,'0');const day=d.getDate().toString().padStart(2,'0');return\"\".concat(year,\"-\").concat(month,\"-\").concat(day);};const resizeImage=(file,maxWidth,maxHeight)=>new Promise((resolve,reject)=>{const reader=new FileReader();reader.readAsDataURL(file);reader.onload=event=>{const img=new Image();img.src=event.target.result;img.onload=()=>{const canvas=document.createElement('canvas');let{width,height}=img;if(width>height){if(width>maxWidth){height*=maxWidth/width;width=maxWidth;}}else{if(height>maxHeight){width*=maxHeight/height;height=maxHeight;}}canvas.width=width;canvas.height=height;const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,width,height);resolve(canvas.toDataURL('image/jpeg',0.8));};img.onerror=error=>reject(error);};reader.onerror=error=>reject(error);});// --- UI Components ---\nconst Modal=/*#__PURE__*/React.memo(_ref=>{let{children,onClose,size='md'}=_ref;const sizeClass={md:'max-w-md',lg:'max-w-2xl',xl:'max-w-4xl','5xl':'max-w-5xl','7xl':'max-w-7xl'}[size];return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-start p-4 overflow-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl w-full \".concat(sizeClass,\" m-4 mt-12\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end p-2 no-print\",children:/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(X,{size:24})})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-4 sm:px-8 pb-8\",children:children})]})});});const AlertModal=/*#__PURE__*/React.memo(_ref2=>{let{message,onClose}=_ref2;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl w-full max-w-sm m-4 p-8 text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"mb-6\",children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"px-6 py-2 rounded-lg text-white bg-blue-500 hover:bg-blue-600 font-semibold\",children:\"OK\"})]})});});const ConfirmModal=/*#__PURE__*/React.memo(_ref3=>{let{message,onConfirm,onClose}=_ref3;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl w-full max-w-sm m-4 p-8 text-center\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"mx-auto text-red-500 mb-4\",size:48}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-6\",children:message}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"px-6 py-2 rounded-lg text-gray-600 bg-gray-200 hover:bg-gray-300\",children:\"Annuler\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onConfirm,className:\"px-6 py-2 rounded-lg text-white bg-red-500 hover:bg-red-600 font-semibold\",children:\"Confirmer\"})]})]})});});const StatCard=/*#__PURE__*/React.memo(_ref4=>{let{icon,title,value,color,valueColor='text-gray-800'}=_ref4;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-2xl shadow-md flex items-center space-x-4 border-l-4 \".concat(color),children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl\",children:icon}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 font-medium\",children:title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold \".concat(valueColor),children:value})]})]});});// --- Main Component: App ---\nexport default function App(){const[user,setUser]=useState(null);const[isAuthReady,setIsAuthReady]=useState(false);const[language,setLanguage]=useState('fr');const userRole=ROLES.ADMIN;const userPseudo='Admin';const[currentView,setCurrentView]=useState('dashboard');const[viewPayload,setViewPayload]=useState(null);const[products,setProducts]=useState([]);const[customers,setCustomers]=useState([]);const[sales,setSales]=useState([]);const[categories,setCategories]=useState([]);const[payments,setPayments]=useState([]);const[companyProfile,setCompanyProfile]=useState({name:\"Ma boutique\",address:\"Dakar - Sénégal\",phone:\"+221\",logo:null,invoicePrefix:\"FAC-\",refundPrefix:\"REM-\",depositPrefix:\"DEP-\",invoiceFooterMessage:\"Merci pour votre achat !\",lastInvoiceNumber:0,language:'fr'});const[cart,setCart]=useState([]);const[modalState,setModalState]=useState({isOpen:false,type:null,item:null,size:'md'});const[alertInfo,setAlertInfo]=useState({show:false,message:''});const[confirmInfo,setConfirmInfo]=useState({show:false,message:'',onConfirm:null});const[isMenuCollapsed,setIsMenuCollapsed]=useState(false);const[isMobileMenuOpen,setIsMobileMenuOpen]=useState(false);const t=useCallback(key=>{return translations[language][key]||key;},[language]);const productsToReorder=useMemo(()=>{const toReorder=[];products.forEach(p=>{if(p.type===PRODUCT_TYPES.VARIANT){var _p$variants;(_p$variants=p.variants)===null||_p$variants===void 0?void 0:_p$variants.forEach(v=>{if(v.quantity<=(v.reorderThreshold||0)&&v.quantity>0){toReorder.push({id:\"\".concat(p.id,\"-\").concat(v.id),name:\"\".concat(p.name,\" - \").concat(v.name),quantity:v.quantity,reorderThreshold:v.reorderThreshold||0});}});}else if(p.type===PRODUCT_TYPES.SIMPLE&&p.quantity<=(p.reorderThreshold||0)&&p.quantity>0){toReorder.push(p);}});return toReorder;},[products]);const showAlert=useCallback(message=>setAlertInfo({show:true,message}),[]);const showConfirm=useCallback((message,onConfirm)=>setConfirmInfo({show:true,message,onConfirm}),[]);const navigate=useCallback(function(view){let payload=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setCurrentView(view);setViewPayload(payload);setIsMobileMenuOpen(false);},[]);const addToCart=useCallback(function(product,quantity){let variant=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;setCart(currentCart=>{const cartItemId=variant?\"\".concat(product.id,\"-\").concat(variant.id):product.id;const existingItem=currentCart.find(item=>item.cartId===cartItemId);if(existingItem){return currentCart.map(item=>item.cartId===cartItemId?_objectSpread(_objectSpread({},item),{},{quantity:item.quantity+quantity}):item);}const newItem=_objectSpread(_objectSpread({},product),{},{cartId:cartItemId,name:variant?\"\".concat(product.name,\" - \").concat(variant.name):product.name,price:variant?(product.basePrice||product.price)+(variant.priceModifier||0):product.price,quantity,variant:variant?{id:variant.id,name:variant.name}:null});return[...currentCart,newItem];});},[]);// --- Authentication & Script Loading ---\nuseEffect(()=>{const unsubscribeAuth=onAuthStateChanged(auth,async authUser=>{if(authUser){setUser(authUser);setIsAuthReady(true);}else{try{if(typeof __initial_auth_token!=='undefined'&&__initial_auth_token){await signInWithCustomToken(auth,__initial_auth_token);}else{await signInAnonymously(auth);}}catch(error){console.error(\"Anonymous auth error:\",error);setIsAuthReady(true);}}});const loadScript=src=>new Promise((resolve,reject)=>{if(document.querySelector(\"script[src=\\\"\".concat(src,\"\\\"]\"))){resolve();return;}const script=document.createElement('script');script.src=src;script.onload=()=>resolve();script.onerror=()=>reject(new Error(\"Script load error for \".concat(src)));document.body.appendChild(script);});Promise.all([loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"),loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\")]).catch(error=>console.error(\"Error loading scripts:\",error));return()=>unsubscribeAuth();},[]);// --- Firestore Data Subscription ---\nuseEffect(()=>{if(!isAuthReady)return;const collectionsToSubscribe=[{name:'products',setter:setProducts},{name:'customers',setter:setCustomers},{name:'categories',setter:setCategories},{name:'payments',setter:setPayments},{name:'sales',setter:setSales}];const unsubscribers=collectionsToSubscribe.map(_ref5=>{let{name,setter}=_ref5;const path=\"artifacts/\".concat(appId,\"/public/data/\").concat(name);const q=query(collection(db,path));return onSnapshot(q,snapshot=>{const items=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setter(items);},err=>console.error(\"Error reading \".concat(name,\":\"),err));});const profileDocRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/companyProfile\"),'main');const unsubProfile=onSnapshot(profileDocRef,docSnap=>{if(docSnap.exists()){const data=docSnap.data();setCompanyProfile(prev=>_objectSpread(_objectSpread({},prev),data));if(data.language){setLanguage(data.language);}}else{setDoc(profileDocRef,companyProfile);}});unsubscribers.push(unsubProfile);return()=>unsubscribers.forEach(unsub=>unsub&&unsub());},[isAuthReady,appId]);const closeModal=useCallback(()=>setModalState({isOpen:false,type:null,item:null,size:'md'}),[]);// --- CRUD Functions ---\nconst handleAddItem=useCallback(async(collectionName,data,onSuccess)=>{if(!user)return;const path=\"artifacts/\".concat(appId,\"/public/data/\").concat(collectionName);try{const docRef=await addDoc(collection(db,path),data);if(onSuccess)onSuccess(_objectSpread({id:docRef.id},data));closeModal();}catch(error){console.error(\"Add error:\",error);showAlert(\"Add error: \"+error.message);}},[user,appId,closeModal,showAlert]);const handleEditItem=useCallback(async(collectionName,id,data)=>{if(!user)return;const path=\"artifacts/\".concat(appId,\"/public/data/\").concat(collectionName);try{await updateDoc(doc(db,path,id),data);closeModal();}catch(error){console.error(\"Edit error:\",error);showAlert(\"Edit error: \"+error.message);}},[user,appId,closeModal,showAlert]);const handleSaveProfile=useCallback(async profileData=>{if(!user)return;const profileDocRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/companyProfile\"),'main');try{await setDoc(profileDocRef,profileData,{merge:true});if(profileData.language){setLanguage(profileData.language);}showAlert(\"Company profile updated!\");}catch(error){console.error(\"Profile update error:\",error);showAlert(\"Error: \"+error.message);}},[user,appId,showAlert]);const handleDeleteItem=useCallback((collectionName,id)=>{showConfirm(\"Are you sure you want to delete this item?\",async()=>{if(!user)return;try{const path=\"artifacts/\".concat(appId,\"/public/data/\").concat(collectionName);await deleteDoc(doc(db,path,id));}catch(error){console.error(\"Delete error:\",error);showAlert(\"Error: \"+error.message);}});},[user,appId,showConfirm,showAlert]);const openModal=useCallback(function(type){let item=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let size=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'md';setModalState({isOpen:true,type,item,size});},[]);const handleAddSale=useCallback(async saleData=>{if(!user)return;const{customerId,paymentType,items,totalPrice,discountAmount,vatAmount}=saleData;const customer=customers.find(c=>c.id===customerId);if(!customer){showAlert(\"Customer not found!\");return;}try{const newSaleRef=doc(collection(db,\"artifacts/\".concat(appId,\"/public/data/sales\")));const profileRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/companyProfile\"),'main');const newSaleData=await runTransaction(db,async transaction=>{// --- PHASE 1: READ ALL DOCUMENTS ---\nconst profileDoc=await transaction.get(profileRef);if(!profileDoc.exists()){throw\"Company profile not found.\";}const productsToRead=new Map();items.forEach(item=>{productsToRead.set(item.id,doc(db,\"artifacts/\".concat(appId,\"/public/data/products\"),item.id));});const mainProductDocs=await Promise.all(Array.from(productsToRead.values()).map(ref=>transaction.get(ref)));const productsDataMap=new Map();mainProductDocs.forEach(doc=>{if(doc.exists()){productsDataMap.set(doc.id,doc.data());}});const packItemRefsToRead=new Map();productsDataMap.forEach(productData=>{if(productData.type===PRODUCT_TYPES.PACK){productData.packItems.forEach(packItem=>{if(!productsDataMap.has(packItem.productId)){packItemRefsToRead.set(packItem.productId,doc(db,\"artifacts/\".concat(appId,\"/public/data/products\"),packItem.productId));}});}});if(packItemRefsToRead.size>0){const packItemDocs=await Promise.all(Array.from(packItemRefsToRead.values()).map(ref=>transaction.get(ref)));packItemDocs.forEach(doc=>{if(doc.exists()){productsDataMap.set(doc.id,doc.data());}});}// --- PHASE 2: VALIDATE STOCK ---\nfor(const item of items){const productData=productsDataMap.get(item.id);if(!productData)throw\"Product \".concat(item.name,\" not found!\");if(item.variant){const variantIndex=productData.variants.findIndex(v=>v.id===item.variant.id);if(variantIndex===-1||productData.variants[variantIndex].quantity<item.quantity){throw\"Insufficient stock for variant \".concat(item.name);}}else if(productData.type===PRODUCT_TYPES.PACK){for(const packItem of productData.packItems){const childProductData=productsDataMap.get(packItem.productId);if(!childProductData)throw\"Child product \".concat(packItem.name,\" not found.\");if(packItem.variant&&packItem.variant.id){const variantIndex=childProductData.variants.findIndex(v=>v.id===packItem.variant.id);if(variantIndex===-1||childProductData.variants[variantIndex].quantity<packItem.quantity*item.quantity){throw\"Insufficient stock for \".concat(packItem.name,\" in the pack.\");}}else{if(childProductData.quantity<packItem.quantity*item.quantity){throw\"Insufficient stock for \".concat(childProductData.name,\" in the pack.\");}}}}else{if(productData.quantity<item.quantity){throw\"Insufficient stock for \".concat(item.name,\"!\");}}}// --- PHASE 3: EXECUTE WRITES ---\nfor(const item of items){const productData=productsDataMap.get(item.id);const productRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/products\"),item.id);if(item.variant){const newVariants=[...productData.variants];const variantIndex=newVariants.findIndex(v=>v.id===item.variant.id);newVariants[variantIndex].quantity-=item.quantity;transaction.update(productRef,{variants:newVariants});}else if(productData.type===PRODUCT_TYPES.PACK){for(const packItem of productData.packItems){const childProductData=productsDataMap.get(packItem.productId);const childProductRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/products\"),packItem.productId);if(packItem.variant&&packItem.variant.id){const newVariants=[...childProductData.variants];const variantIndex=newVariants.findIndex(v=>v.id===packItem.variant.id);newVariants[variantIndex].quantity-=packItem.quantity*item.quantity;transaction.update(childProductRef,{variants:newVariants});}else{const newQuantity=childProductData.quantity-packItem.quantity*item.quantity;transaction.update(childProductRef,{quantity:newQuantity});}}}else{const newQuantity=productData.quantity-item.quantity;transaction.update(productRef,{quantity:newQuantity});}}if(paymentType==='Acompte Client'){const customerBalance=customer.balance||0;if(customerBalance<totalPrice){throw\"Insufficient customer deposit.\";}const customerRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/customers\"),customerId);transaction.update(customerRef,{balance:customerBalance-totalPrice});}const lastInvoiceNumber=profileDoc.data().lastInvoiceNumber||0;const newInvoiceNumber=lastInvoiceNumber+1;const invoiceId=\"\".concat(companyProfile.invoicePrefix||'FAC-').concat(newInvoiceNumber.toString().padStart(5,'0'));const status=paymentType==='Créance'?SALE_STATUS.CREDIT:SALE_STATUS.COMPLETED;const finalSaleData={invoiceId,customerId,customerName:customer.name,paymentType,items:items.map(i=>({productId:i.id,productName:i.name,quantity:i.quantity,unitPrice:i.price,subtotal:i.price*i.quantity,variant:i.variant})),totalPrice,discountAmount,vatAmount,status,paidAmount:status===SALE_STATUS.COMPLETED?totalPrice:0,saleDate:new Date().toISOString(),userId:user.uid,userPseudo};transaction.set(newSaleRef,finalSaleData);transaction.update(profileRef,{lastInvoiceNumber:newInvoiceNumber});return finalSaleData;});setCart([]);openModal('showInvoice',_objectSpread(_objectSpread({},newSaleData),{},{id:newSaleRef.id,customer}),'lg');}catch(error){console.error(\"Sale transaction error:\",error);showAlert(\"Error: \"+error.toString());}},[user,customers,products,appId,companyProfile.invoicePrefix,showAlert,openModal]);const handleShowInvoice=useCallback(sale=>{const customer=customers.find(c=>c.id===sale.customerId);if(!customer){showAlert(\"Could not find the customer for this sale.\");return;}openModal('showInvoice',_objectSpread(_objectSpread({},sale),{},{customer}),'lg');},[customers,openModal,showAlert]);const handleMakePayment=useCallback(async(saleToPay,amountPaidStr,paymentType)=>{const amountPaid=Number(amountPaidStr);if(!amountPaid||amountPaid<=0){showAlert(\"Invalid amount.\");return;}const currentPaidAmount=saleToPay.paidAmount||0;const remainingBalance=saleToPay.totalPrice-currentPaidAmount;if(amountPaid>remainingBalance){showAlert(\"The amount paid cannot exceed the remaining balance.\");return;}let newPaidAmount=currentPaidAmount+amountPaid;const isFullyPaid=newPaidAmount>=saleToPay.totalPrice;if(isFullyPaid){newPaidAmount=saleToPay.totalPrice;}const newStatus=isFullyPaid?SALE_STATUS.COMPLETED:SALE_STATUS.CREDIT;try{const batch=writeBatch(db);const saleRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/sales\"),saleToPay.id);if(paymentType==='Acompte Client'){const customer=customers.find(c=>c.id===saleToPay.customerId);if(!customer||(customer.balance||0)<amountPaid){showAlert(\"Insufficient customer deposit.\");return;}const customerRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/customers\"),saleToPay.customerId);batch.update(customerRef,{balance:customer.balance-amountPaid});}const paymentData={saleId:saleToPay.id,invoiceId:saleToPay.invoiceId,customerName:saleToPay.customerName,amount:amountPaid,paymentType,paymentDate:new Date().toISOString()};batch.set(doc(collection(db,\"artifacts/\".concat(appId,\"/public/data/payments\"))),paymentData);batch.update(saleRef,{paidAmount:newPaidAmount,status:newStatus});await batch.commit();openModal('showPaymentReceipt',_objectSpread(_objectSpread({},paymentData),{},{customer:customers.find(c=>c.id===saleToPay.customerId),remainingBalance:saleToPay.totalPrice-newPaidAmount,companyProfile}),'lg');}catch(error){console.error(\"Error during payment:\",error);showAlert(\"Error during payment: \"+error.message);}},[appId,customers,companyProfile,openModal,showAlert]);const handleAddDeposit=useCallback(async(customerId,amount)=>{const customer=customers.find(c=>c.id===customerId);if(!customer||!amount||amount<=0){showAlert(\"Invalid information.\");return;}const newBalance=(customer.balance||0)+Number(amount);try{const customerRef=doc(db,\"artifacts/\".concat(appId,\"/public/data/customers\"),customerId);await updateDoc(customerRef,{balance:newBalance});showAlert(\"Deposit saved!\");closeModal();openModal('showDepositReceipt',{customer:_objectSpread(_objectSpread({},customer),{},{balance:newBalance}),amount:Number(amount),companyProfile,depositDate:new Date().toISOString(),customerId},'lg');}catch(error){console.error(\"Error during deposit:\",error);showAlert(\"Error: \"+error.message);}},[appId,customers,closeModal,showAlert,openModal,companyProfile]);const openSaleModal=useCallback(function(){let customer=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;openModal('productSelection',customer?{preselectedCustomerId:customer.id}:null,'7xl');},[openModal]);const navItems=[{view:'dashboard',label:t('dashboard'),icon:/*#__PURE__*/_jsx(BarChart2,{}),activeViews:['dashboard']},{view:'products',label:t('products'),icon:/*#__PURE__*/_jsx(Package,{}),activeViews:['products']},{view:'categories',label:t('categories'),icon:/*#__PURE__*/_jsx(Tag,{}),activeViews:['categories']},{view:'customers',label:t('customers'),icon:/*#__PURE__*/_jsx(Users,{}),activeViews:['customers','customer-details']},{view:'sales',label:t('sales'),icon:/*#__PURE__*/_jsx(ShoppingCart,{}),activeViews:['sales']},{view:'debts',label:t('debts'),icon:/*#__PURE__*/_jsx(CreditCard,{}),activeViews:['debts']},{view:'refunds',label:t('refunds'),icon:/*#__PURE__*/_jsx(ListChecks,{}),activeViews:['refunds']},{view:'settings',label:t('settings'),icon:/*#__PURE__*/_jsx(Settings,{}),activeViews:['settings']}];// --- View Rendering ---\nconst renderModalContent=()=>{if(!modalState.isOpen)return null;const{type,item}=modalState;switch(type){case'productSelection':return/*#__PURE__*/_jsx(ProductSelectionModal,{products:products,onAddToCart:addToCart,openModal:openModal,onClose:closeModal,onProceedToCart:()=>openModal('addSale',item,'7xl'),cart:cart,t:t,language:language});case'productDetails':return/*#__PURE__*/_jsx(ProductDetailModal,{product:item,onAddToCart:addToCart,onClose:closeModal,openModal:openModal,t:t,language:language});case'addProduct':case'editProduct':return/*#__PURE__*/_jsx(ProductForm,{onSubmit:type==='addProduct'?(d,cb)=>handleAddItem('products',d,cb):d=>handleEditItem('products',item.id,d),initialData:item,categories:categories,products:products,onClose:closeModal,t:t,language:language});case'addCategory':case'editCategory':return/*#__PURE__*/_jsx(CategoryForm,{onSubmit:type==='addCategory'?d=>handleAddItem('categories',d):d=>handleEditItem('categories',item.id,d),initialData:item,categories:categories,onClose:closeModal,t:t});case'addCustomer':return/*#__PURE__*/_jsx(CustomerForm,{onSubmit:(d,cb)=>handleAddItem('customers',d,cb),initialData:item,onClose:closeModal,onSuccess:item===null||item===void 0?void 0:item.onSuccess,t:t});case'editCustomer':return/*#__PURE__*/_jsx(CustomerForm,{onSubmit:d=>handleEditItem('customers',item.id,d),initialData:item,onClose:closeModal,t:t});case'addSale':return/*#__PURE__*/_jsx(SaleForm,{onSubmit:handleAddSale,customers:customers,onClose:closeModal,cart:cart,setCart:setCart,preselectedCustomerId:item===null||item===void 0?void 0:item.preselectedCustomerId,openModal:openModal,showAlert:showAlert,t:t,language:language});case'makePayment':return/*#__PURE__*/_jsx(PaymentForm,{onSubmit:(amount,pType)=>handleMakePayment(item,amount,pType),sale:item,customers:customers,onClose:closeModal,t:t,language:language});case'addDeposit':return/*#__PURE__*/_jsx(DepositForm,{customer:item,onSubmit:amount=>handleAddDeposit(item.id,amount),onClose:closeModal,t:t});case'showInvoice':return/*#__PURE__*/_jsx(Invoice,{sale:item,products:products,companyProfile:companyProfile,onClose:closeModal,showAlert:showAlert,t:t,language:language});case'showPaymentReceipt':return/*#__PURE__*/_jsx(PaymentReceipt,{receiptData:item,onClose:closeModal,showAlert:showAlert,t:t,language:language});case'showDepositReceipt':return/*#__PURE__*/_jsx(DepositReceipt,{receiptData:item,onClose:closeModal,showAlert:showAlert,t:t,language:language});default:return null;}};if(!isAuthReady){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-screen bg-gray-100\",children:t('loading')});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"style\",{children:\".invoice-container, .receipt-container { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; } @media print { body * { visibility: hidden; } .printable-area, .printable-area * { visibility: visible; } .printable-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; padding: 20px; font-size: 12px; } .no-print { display: none; } }\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex h-screen bg-gray-100 font-sans\",children:[isMobileMenuOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden\",onClick:()=>setIsMobileMenuOpen(false)}),/*#__PURE__*/_jsxs(\"nav\",{className:\"fixed inset-y-0 left-0 bg-white shadow-lg flex flex-col z-30 transform transition-transform duration-300 ease-in-out md:relative md:translate-x-0 \".concat(isMobileMenuOpen?'translate-x-0':'-translate-x-full',\" \").concat(isMenuCollapsed?'md:w-20':'md:w-64'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center border-b h-16 \".concat(isMenuCollapsed?'justify-center':'justify-between',\" px-4\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-bold text-gray-800 text-2xl \".concat(isMenuCollapsed?'hidden':'block'),children:companyProfile.logo?/*#__PURE__*/_jsx(\"img\",{src:companyProfile.logo,alt:companyProfile.name,className:\"max-h-10 max-w-full object-contain\"}):companyProfile.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsMenuCollapsed(!isMenuCollapsed),className:\"hidden md:block p-2 rounded-full hover:bg-gray-200\",children:/*#__PURE__*/_jsx(Menu,{size:24})})]}),/*#__PURE__*/_jsx(\"ul\",{className:\"flex-1 p-4 space-y-2\",children:navItems.map(item=>/*#__PURE__*/_jsx(NavItem,{icon:item.icon,label:item.label,active:item.activeViews.includes(currentView),onClick:()=>navigate(item.view),isCollapsed:isMenuCollapsed},item.view))}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-t text-xs text-gray-500 \".concat(isMenuCollapsed?'hidden':'block'),children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"User: \",userPseudo]}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold capitalize\",children:[\"Role: \",userRole]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"flex justify-between items-center bg-white shadow-md p-4 sticky top-0 z-10\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsMobileMenuOpen(true),className:\"md:hidden p-2\",children:/*#__PURE__*/_jsx(Menu,{size:24})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl sm:text-2xl font-bold text-gray-800\",children:t(currentView)})]}),currentView!=='settings'&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 sm:gap-4\",children:[cart.length>0&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openModal('addSale',null,'7xl'),className:\"flex items-center bg-yellow-400 text-yellow-900 font-bold py-2 px-3 sm:px-4 rounded-lg shadow-md hover:bg-yellow-500 transition-colors\",children:[/*#__PURE__*/_jsx(ShoppingCart,{size:20,className:\"mr-0 sm:mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline\",children:t('viewCart')}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 bg-white text-yellow-900 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\",children:cart.length})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openSaleModal(),className:\"flex items-center bg-blue-500 text-white font-bold py-2 px-3 sm:px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors\",children:[/*#__PURE__*/_jsx(Plus,{size:20,className:\"mr-0 sm:mr-2\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline\",children:t('newSale')})]})]})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"flex-1 p-4 sm:p-8 overflow-y-auto\",children:[currentView==='dashboard'&&/*#__PURE__*/_jsx(DashboardView,{sales:sales,products:products,customers:customers,categories:categories,productsToReorder:productsToReorder,openSaleModal:openSaleModal,navigate:navigate,handleShowInvoice:handleShowInvoice,openModal:openModal,t:t,language:language}),currentView==='products'&&/*#__PURE__*/_jsx(ProductsView,{products:products,categories:categories,openModal:openModal,handleDelete:handleDeleteItem,setCart:setCart,openSaleModal:openSaleModal,productsToReorder:productsToReorder,t:t,language:language}),currentView==='categories'&&/*#__PURE__*/_jsx(CategoriesView,{categories:categories,openModal:openModal,handleDelete:handleDeleteItem,t:t,language:language}),currentView==='customers'&&/*#__PURE__*/_jsx(CustomersView,{customers:customers,openModal:openModal,handleDelete:handleDeleteItem,navigate:navigate,t:t,language:language}),currentView==='customer-details'&&/*#__PURE__*/_jsx(CustomerDetailsView,{customerId:viewPayload===null||viewPayload===void 0?void 0:viewPayload.id,customers:customers,db:db,appId:appId,navigate:navigate,openSaleModal:openSaleModal,t:t,language:language}),currentView==='sales'&&/*#__PURE__*/_jsx(SalesView,{sales:sales,handleShowInvoice:handleShowInvoice,t:t,language:language}),currentView==='debts'&&/*#__PURE__*/_jsx(DebtsView,{sales:sales,openModal:openModal,t:t,language:language}),currentView==='refunds'&&/*#__PURE__*/_jsx(RefundsView,{payments:payments,t:t,language:language}),currentView==='settings'&&/*#__PURE__*/_jsx(SettingsView,{companyProfile:companyProfile,handleSaveProfile:handleSaveProfile,t:t})]})]}),modalState.isOpen&&/*#__PURE__*/_jsx(Modal,{onClose:closeModal,size:modalState.size,children:renderModalContent()}),alertInfo.show&&/*#__PURE__*/_jsx(AlertModal,{message:alertInfo.message,onClose:()=>setAlertInfo({show:false,message:''})}),confirmInfo.show&&/*#__PURE__*/_jsx(ConfirmModal,{message:confirmInfo.message,onConfirm:()=>{confirmInfo.onConfirm();setConfirmInfo(_objectSpread(_objectSpread({},confirmInfo),{},{show:false}));},onClose:()=>setConfirmInfo(_objectSpread(_objectSpread({},confirmInfo),{},{show:false}))})]})]});}// --- View and Form Components ---\nconst NavItem=/*#__PURE__*/React.memo(_ref6=>{let{icon,label,active,onClick,isCollapsed}=_ref6;return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"a\",{href:\"#\",onClick:onClick,className:\"flex items-center p-3 rounded-lg transition-colors \".concat(active?'bg-blue-500 text-white shadow-md':'text-gray-600 hover:bg-gray-200',\" \").concat(isCollapsed?'justify-center':''),children:[icon,/*#__PURE__*/_jsx(\"span\",{className:\"ml-4 font-medium whitespace-nowrap overflow-hidden \".concat(isCollapsed?'md:hidden':'block'),children:label})]})});});// --- VIEWS ---\nconst DashboardView=/*#__PURE__*/React.memo(_ref7=>{let{sales,products,customers,categories,productsToReorder,openSaleModal,navigate,handleShowInvoice,openModal,t,language}=_ref7;const[searchTerm,setSearchTerm]=useState('');const[searchResults,setSearchResults]=useState(null);const handleSearch=useCallback(e=>{const term=e.target.value.toLowerCase();setSearchTerm(term);if(term.length<2){setSearchResults(null);return;}const foundProducts=products.filter(p=>p.name.toLowerCase().includes(term));const foundCustomers=customers.filter(c=>c.name.toLowerCase().includes(term));const foundSales=sales.filter(s=>s.invoiceId&&s.invoiceId.toLowerCase().includes(term)||s.customerName.toLowerCase().includes(term));setSearchResults({products:foundProducts,customers:foundCustomers,sales:foundSales});},[products,customers,sales]);const totalCredit=useMemo(()=>sales.filter(s=>s.status===SALE_STATUS.CREDIT).reduce((acc,s)=>acc+(s.totalPrice-(s.paidAmount||0)),0),[sales]);const totalSalesToday=useMemo(()=>{const today=new Date().toISOString().split('T')[0];return sales.filter(s=>s.saleDate&&s.saleDate.startsWith(today)).reduce((acc,sale)=>acc+sale.totalPrice,0);},[sales]);const displayedSales=useMemo(()=>sales.sort((a,b)=>new Date(b.saleDate)-new Date(a.saleDate)).slice(0,5),[sales]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:t('searchPlaceholder'),value:searchTerm,onChange:handleSearch,className:\"w-full pl-12 pr-4 py-3 border rounded-full text-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"}),/*#__PURE__*/_jsx(Search,{className:\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\",size:24})]}),searchResults&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-2xl shadow-md mb-8\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-700 mb-4\",children:t('searchResults')}),searchResults.products.length===0&&searchResults.customers.length===0&&searchResults.sales.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"No results found.\"}),searchResults.products.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2 text-blue-600\",children:t('products')}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-1\",children:searchResults.products.map(p=>/*#__PURE__*/_jsx(\"li\",{onClick:()=>openModal('productDetails',p,'md'),className:\"cursor-pointer hover:bg-gray-100 p-2 rounded-md\",children:p.name},p.id))})]}),searchResults.customers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2 text-green-600\",children:t('customers')}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-1\",children:searchResults.customers.map(c=>/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate('customer-details',{id:c.id}),className:\"cursor-pointer hover:bg-gray-100 p-2 rounded-md\",children:c.name},c.id))})]}),searchResults.sales.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2 text-purple-600\",children:t('invoices')}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-1\",children:searchResults.sales.map(s=>/*#__PURE__*/_jsxs(\"li\",{onClick:()=>handleShowInvoice(s),className:\"cursor-pointer hover:bg-gray-100 p-2 rounded-md\",children:[s.invoiceId,\" for \",s.customerName,\" - \",formatCurrency(s.totalPrice,language)]},s.id))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Package,{}),title:t('products'),value:products.length,color:\"border-blue-500\"}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(DollarSign,{}),title:t('salesToday'),value:formatCurrency(totalSalesToday,language),color:\"border-yellow-500\"}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(CreditCard,{}),title:t('debts'),value:formatCurrency(totalCredit,language),color:\"border-red-500\",valueColor:\"text-red-500\"}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Users,{}),title:t('customers'),value:customers.length,color:\"border-green-500\"}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Tag,{}),title:t('categories'),value:categories.length,color:\"border-indigo-500\"}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(ShoppingCart,{}),title:t('totalSales'),value:sales.length,color:\"border-purple-500\"})]}),productsToReorder.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 bg-white p-6 rounded-2xl shadow-md\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-orange-600 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"mr-2\"}),t('lowStock')]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('products')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('currentStock')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('threshold')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:productsToReorder.map(p=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:p.name}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 font-bold text-red-500\",children:p.quantity}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-sm text-gray-500\",children:p.reorderThreshold||0})]},p.id))})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 bg-white p-6 rounded-2xl shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-700 mb-4\",children:t('recentSales')}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('invoiceNo')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('products')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('customers')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('total')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('date')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:displayedSales.map(sale=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3 font-semibold\",children:sale.invoiceId}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-sm\",children:sale.items.map(i=>i.productName).join(', ')}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:sale.customerName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 font-medium text-green-600\",children:formatCurrency(sale.totalPrice,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-sm text-gray-500\",children:formatDate(sale.saleDate,language)})]},sale.id))})]})})]})]});});const StockManagementView=/*#__PURE__*/React.memo(_ref8=>{let{productsToReorder,openModal}=_ref8;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Products to Restock\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b-2\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:\"Product / Variant\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:\"Current Stock\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:\"Reorder Threshold\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4 text-right\",children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:productsToReorder.length>0?productsToReorder.map(item=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:item.name}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4 font-bold text-red-500\",children:item.quantity}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:item.reorderThreshold}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4 text-right\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal('addToStock',item,'md'),className:\"p-2 bg-green-100 text-green-700 rounded-full hover:bg-green-200\",children:/*#__PURE__*/_jsx(Plus,{size:16})})})]},item.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"4\",className:\"text-center p-8 text-gray-500\",children:\"No products with low stock.\"})})})]})})]});});const ProductsView=/*#__PURE__*/React.memo(_ref9=>{let{products,categories,openModal,handleDelete,setCart,openSaleModal,productsToReorder,t,language}=_ref9;const[viewMode,setViewMode]=useState('list');const[selectedProducts,setSelectedProducts]=useState(new Set());const[activeTab,setActiveTab]=useState('list');const toggleProductSelection=useCallback(product=>{setSelectedProducts(prev=>{const newSet=new Set(prev);if(newSet.has(product.id)){newSet.delete(product.id);}else{newSet.add(product.id);}return newSet;});},[]);const handleStartSale=useCallback(()=>{const cartItems=products.filter(p=>selectedProducts.has(p.id)).map(p=>_objectSpread(_objectSpread({},p),{},{cartId:p.id,quantity:1}));setCart(cartItems);setSelectedProducts(new Set());openSaleModal();},[products,selectedProducts,setCart,openSaleModal]);const categoryMap=useMemo(()=>categories.reduce((acc,cat)=>_objectSpread(_objectSpread({},acc),{},{[cat.id]:cat}),{}),[categories]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:[activeTab==='list'&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end items-center mb-6 flex-wrap gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setViewMode('list'),className:\"p-2 rounded-lg \".concat(viewMode==='list'?'bg-blue-500 text-white':'bg-gray-200 text-gray-600'),children:/*#__PURE__*/_jsx(List,{})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setViewMode('grid'),className:\"p-2 rounded-lg \".concat(viewMode==='grid'?'bg-blue-500 text-white':'bg-gray-200 text-gray-600'),children:/*#__PURE__*/_jsx(LayoutGrid,{})})]}),selectedProducts.size>0&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleStartSale,className:\"flex items-center bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-600 transition-colors\",children:[/*#__PURE__*/_jsx(ShoppingCart,{size:20,className:\"mr-2\"}),\" \",t('startSale'),\" (\",selectedProducts.size,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openModal('addProduct'),className:\"flex items-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors\",children:[/*#__PURE__*/_jsx(Plus,{size:20,className:\"mr-2\"}),\" \",t('addProduct')]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex border-b mb-6\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('list'),className:\"px-4 py-2 text-sm font-semibold flex items-center gap-2 \".concat(activeTab==='list'?'border-b-2 border-blue-500 text-blue-600':'text-gray-500'),children:[/*#__PURE__*/_jsx(List,{size:16}),\" \",t('productList')]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('stock'),className:\"px-4 py-2 text-sm font-semibold flex items-center gap-2 \".concat(activeTab==='stock'?'border-b-2 border-blue-500 text-blue-600':'text-gray-500'),children:[/*#__PURE__*/_jsx(Archive,{size:16}),\" \",t('stockManagement')]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:activeTab==='list'?viewMode==='list'?/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b-2 border-gray-200\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-4 w-12\",children:/*#__PURE__*/_jsx(PlusCircle,{size:20,className:\"text-gray-400\"})}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('photo')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('name')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('category')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('stock')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('price')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4 text-right\",children:t('actions')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:products.map(item=>{var _categoryMap$item$cat;return/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",disabled:item.type===PRODUCT_TYPES.VARIANT,checked:selectedProducts.has(item.id),onChange:()=>toggleProductSelection(item),className:\"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:bg-gray-200\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:/*#__PURE__*/_jsx(\"img\",{src:item.photoURL||'https://placehold.co/60x60/e2e8f0/4a5568?text=N/A',alt:item.name,className:\"w-12 h-12 rounded-lg object-cover\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4 font-semibold\",children:item.name}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4 text-sm\",children:((_categoryMap$item$cat=categoryMap[item.categoryId])===null||_categoryMap$item$cat===void 0?void 0:_categoryMap$item$cat.name)||'N/A'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:/*#__PURE__*/_jsx(\"span\",{className:item.type!==PRODUCT_TYPES.VARIANT&&item.quantity<=(item.reorderThreshold||0)?'font-bold text-red-500':'',children:item.type===PRODUCT_TYPES.VARIANT?'Variants':item.quantity})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:formatCurrency(item.price||item.basePrice,language)}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-4 text-right whitespace-nowrap\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal('editProduct',item),className:\"text-blue-500 hover:text-blue-700 mr-4\",children:/*#__PURE__*/_jsx(Edit,{size:20})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete('products',item.id),className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(Trash2,{size:20})})]})]},item.id);})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6\",children:products.map(product=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-md p-4 flex flex-col items-center text-center relative \".concat(product.type===PRODUCT_TYPES.PACK||product.type===PRODUCT_TYPES.SIMPLE?'cursor-pointer':'opacity-70'),onClick:()=>(product.type===PRODUCT_TYPES.PACK||product.type===PRODUCT_TYPES.SIMPLE)&&toggleProductSelection(product),children:[/*#__PURE__*/_jsx(\"img\",{src:product.photoURL||'https://placehold.co/150x150/e2e8f0/4a5568?text=N/A',alt:product.name,className:\"w-full h-32 object-cover rounded-lg mb-4\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800 flex-grow\",children:product.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-600 font-bold\",children:formatCurrency(product.price||product.basePrice,language)}),(product.type===PRODUCT_TYPES.PACK||product.type===PRODUCT_TYPES.SIMPLE)&&/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedProducts.has(product.id),readOnly:true,className:\"absolute top-2 right-2 h-6 w-6 rounded-md border-gray-400 text-blue-600 focus:ring-blue-500\"})]},product.id))}):/*#__PURE__*/_jsx(StockManagementView,{productsToReorder:productsToReorder,openModal:openModal})})]});});const CategoriesView=/*#__PURE__*/React.memo(_ref0=>{let{categories,openModal,handleDelete,t}=_ref0;const categoryMap=useMemo(()=>categories.reduce((acc,cat)=>_objectSpread(_objectSpread({},acc),{},{[cat.id]:cat.name}),{}),[categories]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold text-gray-800\",children:t('categories')}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openModal('addCategory'),className:\"flex items-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600\",children:[/*#__PURE__*/_jsx(Plus,{size:20,className:\"mr-2\"}),\" \",t('addCategory')]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b-2\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('name')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('parentCategory')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4 text-right\",children:t('actions')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:categories.map(item=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:item.name}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:item.parentId?categoryMap[item.parentId]:\"N/A (Main)\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-4 text-right\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal('editCategory',item),className:\"text-blue-500 hover:text-blue-700 mr-4\",children:/*#__PURE__*/_jsx(Edit,{size:20})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete('categories',item.id),className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(Trash2,{size:20})})]})]},item.id))})]})})]});});const CustomersView=/*#__PURE__*/React.memo(_ref1=>{let{customers,openModal,handleDelete,navigate,t,language}=_ref1;const[searchTerm,setSearchTerm]=useState('');const filteredCustomers=useMemo(()=>customers.filter(c=>c.name.toLowerCase().includes(searchTerm.toLowerCase())),[customers,searchTerm]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold text-gray-800\",children:t('customers')}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openModal('addCustomer'),className:\"flex items-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600\",children:[/*#__PURE__*/_jsx(Plus,{size:20,className:\"mr-2\"}),\" \",t('addCustomer')]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:t('searchCustomer'),value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"w-full px-4 py-2 border rounded-lg\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b-2\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('name')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4 hidden sm:table-cell\",children:t('nickname')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4\",children:t('phone')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4 hidden md:table-cell\",children:t('customerDeposit')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-4 text-right\",children:t('actions')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredCustomers.map(item=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:/*#__PURE__*/_jsx(\"a\",{href:\"#\",onClick:e=>{e.preventDefault();navigate('customer-details',{id:item.id});},className:\"text-blue-600 hover:underline\",children:item.name})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4 hidden sm:table-cell\",children:item.nickname}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4\",children:item.phone}),/*#__PURE__*/_jsx(\"td\",{className:\"p-4 hidden md:table-cell\",children:formatCurrency(item.balance||0,language)}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-4 text-right\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal('addDeposit',item),title:\"Add deposit\",className:\"text-green-500 hover:text-green-700 mr-4\",children:/*#__PURE__*/_jsx(DollarSign,{size:20})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal('editCustomer',item),className:\"text-blue-500 hover:text-blue-700 mr-4\",children:/*#__PURE__*/_jsx(Edit,{size:20})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete('customers',item.id),className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(Trash2,{size:20})})]})]},item.id))})]})})]});});const CustomerDetailsView=/*#__PURE__*/React.memo(_ref10=>{let{customerId,customers,db,appId,navigate,openSaleModal,t,language}=_ref10;const[customerSales,setCustomerSales]=useState([]);const[loading,setLoading]=useState(true);const customer=useMemo(()=>customers.find(c=>c.id===customerId),[customers,customerId]);useEffect(()=>{if(!customerId)return;setLoading(true);const salesRef=collection(db,\"artifacts/\".concat(appId,\"/public/data/sales\"));const q=query(salesRef,where(\"customerId\",\"==\",customerId));const unsubscribe=onSnapshot(q,snapshot=>{const salesData=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));salesData.sort((a,b)=>new Date(b.saleDate)-new Date(a.saleDate));setCustomerSales(salesData);setLoading(false);},err=>{console.error(\"Error reading history:\",err);setLoading(false);});return()=>unsubscribe();},[customerId,db,appId]);if(!customer)return/*#__PURE__*/_jsxs(\"div\",{children:[\"Customer not found. \",/*#__PURE__*/_jsx(\"button\",{className:\"text-blue-500 underline\",onClick:()=>navigate('customers'),children:t('backToList')})]});const sanitizedPhone=customer.phone?customer.phone.replace(/[\\s+()-]/g,''):'';return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('customers'),className:\"flex items-center text-blue-600 hover:underline mb-4\",children:[/*#__PURE__*/_jsx(ArrowLeft,{size:18,className:\"mr-2\"}),\" \",t('backToList')]}),/*#__PURE__*/_jsxs(\"h2\",{className:\"text-3xl font-bold text-gray-800\",children:[customer.name,\" \",customer.nickname&&\"(\".concat(customer.nickname,\")\")]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:customer.phone}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:customer.address})]}),customer.phone&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-3 mb-6 border-t pt-6 mt-4\",children:[/*#__PURE__*/_jsxs(\"a\",{href:\"tel:\".concat(customer.phone),className:\"flex items-center gap-2 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors text-sm\",children:[/*#__PURE__*/_jsx(Phone,{size:16}),\" \",t('appeler')]}),/*#__PURE__*/_jsxs(\"a\",{href:\"sms:\".concat(customer.phone),className:\"flex items-center gap-2 bg-cyan-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-cyan-600 transition-colors text-sm\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:16}),\" \",t('sms')]}),/*#__PURE__*/_jsxs(\"a\",{href:\"https://wa.me/\".concat(sanitizedPhone),target:\"_blank\",rel:\"noopener noreferrer\",className:\"flex items-center gap-2 bg-green-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-600 transition-colors text-sm\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:16}),\" WhatsApp\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-green-50 border border-green-200 rounded-lg mb-6\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold text-green-700\",children:[\"Acompte disponible: \",formatCurrency(customer.balance||0,language)]})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-700 mb-4\",children:t('purchaseHistory')}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:loading?/*#__PURE__*/_jsxs(\"p\",{children:[t('loading'),\"...\"]}):/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('invoiceNo')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('date')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 hidden sm:table-cell\",children:t('products')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 text-right\",children:t('total')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 text-center\",children:\"Status\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:customerSales.length>0?customerSales.map(sale=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3 font-semibold\",children:sale.invoiceId}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:formatDateTime(sale.saleDate,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-sm hidden sm:table-cell\",children:sale.items.map(i=>\"\".concat(i.productName,\" (x\").concat(i.quantity,\")\")).join(', ')}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-right\",children:formatCurrency(sale.totalPrice,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-center\",children:/*#__PURE__*/_jsx(StatusBadge,{status:sale.status})})]},sale.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"5\",className:\"text-center p-8 text-gray-500\",children:t('noPurchases')})})})]})})]});});const SalesView=/*#__PURE__*/React.memo(_ref11=>{let{sales,handleShowInvoice,t,language}=_ref11;const[activeFilter,setActiveFilter]=useState('day');const[customStartDate,setCustomStartDate]=useState(toInputDate(new Date()));const[customEndDate,setCustomEndDate]=useState(toInputDate(new Date()));const[showFilters,setShowFilters]=useState(false);const filteredSales=useMemo(()=>{if(!sales)return[];let start,end;const now=new Date();switch(activeFilter){case'day':start=new Date(new Date().setHours(0,0,0,0));end=new Date(new Date().setHours(23,59,59,999));break;case'week':const first=now.getDate()-now.getDay()+(now.getDay()===0?-6:1);start=new Date(new Date().setDate(first));start.setHours(0,0,0,0);end=new Date(new Date(start).setDate(start.getDate()+6));end.setHours(23,59,59,999);break;case'month':start=new Date(now.getFullYear(),now.getMonth(),1);end=new Date(now.getFullYear(),now.getMonth()+1,0,23,59,59,999);break;case'year':start=new Date(now.getFullYear(),0,1);end=new Date(now.getFullYear(),11,31,23,59,59,999);break;case'custom':if(customStartDate&&customEndDate){start=new Date(customStartDate);start.setHours(0,0,0,0);end=new Date(customEndDate);end.setHours(23,59,59,999);}break;default:return[...sales].sort((a,b)=>new Date(b.saleDate)-new Date(a.saleDate));}if(!start||!end)return[...sales].sort((a,b)=>new Date(b.saleDate)-new Date(a.saleDate));return sales.filter(s=>{const d=new Date(s.saleDate);return d>=start&&d<=end;}).sort((a,b)=>new Date(b.saleDate)-new Date(a.saleDate));},[sales,activeFilter,customStartDate,customEndDate]);const subtotal=useMemo(()=>filteredSales.reduce((acc,sale)=>acc+sale.totalPrice,0),[filteredSales]);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end items-center mb-6\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowFilters(!showFilters),className:\"flex items-center text-sm font-semibold text-blue-600 hover:text-blue-800\",children:[/*#__PURE__*/_jsx(Filter,{size:16,className:\"mr-1\"}),\" \",showFilters?t('hide'):t('filter')]})}),showFilters&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 p-6 rounded-2xl shadow-inner mb-6 border\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-end gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveFilter('day'),className:\"px-4 py-2 rounded-lg text-sm \".concat(activeFilter==='day'?'bg-blue-500 text-white':'bg-gray-200'),children:t('today')}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveFilter('week'),className:\"px-4 py-2 rounded-lg text-sm \".concat(activeFilter==='week'?'bg-blue-500 text-white':'bg-gray-200'),children:t('thisWeek')}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveFilter('month'),className:\"px-4 py-2 rounded-lg text-sm \".concat(activeFilter==='month'?'bg-blue-500 text-white':'bg-gray-200'),children:t('thisMonth')}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveFilter('year'),className:\"px-4 py-2 rounded-lg text-sm \".concat(activeFilter==='year'?'bg-blue-500 text-white':'bg-gray-200'),children:t('thisYear')}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveFilter('all'),className:\"px-4 py-2 rounded-lg text-sm \".concat(activeFilter==='all'?'bg-blue-500 text-white':'bg-gray-200'),children:t('all')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end gap-2 border-l-2 pl-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:t('from')}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:customStartDate,onChange:e=>setCustomStartDate(e.target.value),className:\"w-full px-3 py-1.5 border rounded-lg text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:t('to')}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:customEndDate,onChange:e=>setCustomEndDate(e.target.value),className:\"w-full px-3 py-1.5 border rounded-lg text-sm\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveFilter('custom'),className:\"px-4 py-2 rounded-lg text-sm \".concat(activeFilter==='custom'?'bg-blue-500 text-white':'bg-blue-200'),children:t('filter')})]})]})}),filteredSales.length>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"mb-4 text-xl font-bold text-center bg-blue-500 text-white p-4 rounded-lg\",children:[t('totalDisplayed'),\": \",formatCurrency(subtotal,language)]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('invoiceNo')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 hidden sm:table-cell\",children:t('products')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('customers')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('total')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 hidden md:table-cell\",children:t('date')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 text-right\",children:t('actions')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredSales.map(sale=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3 font-semibold\",children:sale.invoiceId}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-sm hidden sm:table-cell\",children:sale.items.map(i=>i.productName).join(', ')}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:sale.customerName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:formatCurrency(sale.totalPrice,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 hidden md:table-cell\",children:formatDateTime(sale.saleDate,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:/*#__PURE__*/_jsx(StatusBadge,{status:sale.status})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-right\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleShowInvoice(sale),children:/*#__PURE__*/_jsx(Printer,{size:20})})})]},sale.id))})]})})]});});const DebtsView=/*#__PURE__*/React.memo(_ref12=>{let{sales,openModal,t,language}=_ref12;const debtSales=useMemo(()=>sales.filter(s=>s.status===SALE_STATUS.CREDIT),[sales]);return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('invoiceNo')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('customers')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('amountDue')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 hidden md:table-cell\",children:t('date')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 text-right\",children:t('actions')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:debtSales.map(sale=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3 font-semibold\",children:sale.invoiceId}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:sale.customerName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-red-600 font-semibold\",children:formatCurrency(sale.totalPrice-(sale.paidAmount||0),language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 hidden md:table-cell\",children:formatDateTime(sale.saleDate,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 text-right\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal('makePayment',sale),className:\"text-green-500\",children:/*#__PURE__*/_jsx(CheckCircle,{size:20})})})]},sale.id))})]})})});});const RefundsView=/*#__PURE__*/React.memo(_ref13=>{let{payments,t,language}=_ref13;const sortedPayments=useMemo(()=>[...payments].sort((a,b)=>new Date(b.paymentDate)-new Date(a.paymentDate)),[payments]);return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\",children:/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('date')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('customers')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('amount')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 hidden sm:table-cell\",children:t('method')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('invoiceRef')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:sortedPayments.map((item,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:formatDateTime(item.paymentDate,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:item.customerName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:formatCurrency(item.amount,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 hidden sm:table-cell\",children:item.paymentType}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3\",children:item.invoiceId})]},item.id||index))})]})})});});const SettingsView=/*#__PURE__*/React.memo(_ref14=>{let{companyProfile,handleSaveProfile,t}=_ref14;return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 sm:p-8 rounded-2xl shadow-md max-w-2xl mx-auto\",children:/*#__PURE__*/_jsx(CompanyProfileForm,{initialData:companyProfile,onSubmit:handleSaveProfile,t:t})});});// --- FORMS AND MODALS ---\nconst ProductForm=/*#__PURE__*/React.memo(_ref15=>{var _initialData$quantity,_initialData$reorderT;let{onSubmit,initialData,categories,products,onClose,t,language}=_ref15;const[name,setName]=useState((initialData===null||initialData===void 0?void 0:initialData.name)||'');const[description,setDescription]=useState((initialData===null||initialData===void 0?void 0:initialData.description)||'');const[price,setPrice]=useState((initialData===null||initialData===void 0?void 0:initialData.price)||'');const[basePrice,setBasePrice]=useState((initialData===null||initialData===void 0?void 0:initialData.basePrice)||'');const[photoURL,setPhotoURL]=useState((initialData===null||initialData===void 0?void 0:initialData.photoURL)||null);const[parentCategoryId,setParentCategoryId]=useState('');const[subCategoryId,setSubCategoryId]=useState((initialData===null||initialData===void 0?void 0:initialData.categoryId)||'');const[productType,setProductType]=useState((initialData===null||initialData===void 0?void 0:initialData.type)===PRODUCT_TYPES.PACK?PRODUCT_TYPES.PACK:PRODUCT_TYPES.SIMPLE);// State for Simple product\nconst[quantity,setQuantity]=useState((_initialData$quantity=initialData===null||initialData===void 0?void 0:initialData.quantity)!==null&&_initialData$quantity!==void 0?_initialData$quantity:'');const[reorderThreshold,setReorderThreshold]=useState((_initialData$reorderT=initialData===null||initialData===void 0?void 0:initialData.reorderThreshold)!==null&&_initialData$reorderT!==void 0?_initialData$reorderT:'');// State for Pack product\nconst[packItems,setPackItems]=useState(()=>((initialData===null||initialData===void 0?void 0:initialData.packItems)||[]).map(item=>_objectSpread(_objectSpread({},item),{},{packItemId:crypto.randomUUID()})));// State for Variant product\nconst[variants,setVariants]=useState((initialData===null||initialData===void 0?void 0:initialData.variants)||[]);const parentCategories=useMemo(()=>categories.filter(c=>!c.parentId),[categories]);const subCategories=useMemo(()=>parentCategoryId?categories.filter(c=>c.parentId===parentCategoryId):[],[categories,parentCategoryId]);useEffect(()=>{if(initialData!==null&&initialData!==void 0&&initialData.categoryId){const cat=categories.find(c=>c.id===initialData.categoryId);if(cat!==null&&cat!==void 0&&cat.parentId){setParentCategoryId(cat.parentId);setSubCategoryId(cat.id);}else{setParentCategoryId((cat===null||cat===void 0?void 0:cat.id)||'');}}},[initialData,categories]);const handleSubmit=e=>{e.preventDefault();const finalProductType=productType===PRODUCT_TYPES.PACK?PRODUCT_TYPES.PACK:variants.length>0?PRODUCT_TYPES.VARIANT:PRODUCT_TYPES.SIMPLE;const commonData={name,description,photoURL,type:finalProductType};let data={};if(finalProductType!==PRODUCT_TYPES.PACK){commonData.categoryId=subCategoryId||parentCategoryId;}else{commonData.categoryId=null;}if(finalProductType===PRODUCT_TYPES.SIMPLE){data=_objectSpread(_objectSpread({},commonData),{},{price:Number(price),quantity:Number(quantity),reorderThreshold:Number(reorderThreshold)});}else if(finalProductType===PRODUCT_TYPES.PACK){const finalPackItems=packItems.map(_ref16=>{let{packItemId}=_ref16,rest=_objectWithoutProperties(_ref16,_excluded);return rest;});data=_objectSpread(_objectSpread({},commonData),{},{price:Number(price),packItems:finalPackItems,quantity:0});}else if(finalProductType===PRODUCT_TYPES.VARIANT){data=_objectSpread(_objectSpread({},commonData),{},{basePrice:Number(basePrice),variants});}onSubmit(data);};const handlePhotoChange=async e=>{if(e.target.files[0]){const r=await resizeImage(e.target.files[0],400,400);setPhotoURL(r);}};const handleAddPackItem=item=>{setPackItems(current=>[...current,_objectSpread(_objectSpread({},item),{},{packItemId:crypto.randomUUID()})]);};const handleRemovePackItem=packItemId=>{setPackItems(current=>current.filter(item=>item.packItemId!==packItemId));};const handleAddVariant=variant=>{if(variants.length===0&&price){setBasePrice(price);}setVariants(current=>[...current,_objectSpread(_objectSpread({},variant),{},{id:crypto.randomUUID()})]);};const handleRemoveVariant=variantId=>{const newVariants=variants.filter(v=>v.id!==variantId);if(newVariants.length===0&&basePrice){setPrice(basePrice);setBasePrice('');}setVariants(newVariants);};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center\",children:initialData?t('editProduct'):t('addProduct')}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"w-full text-sm font-medium\",children:t('photo')}),/*#__PURE__*/_jsx(\"div\",{className:\"w-32 h-32 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-dashed\",children:photoURL?/*#__PURE__*/_jsx(\"img\",{src:photoURL,alt:\"Preview\",className:\"w-full h-full object-cover rounded-lg\"}):/*#__PURE__*/_jsx(ImageIcon,{className:\"text-gray-400\",size:40})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handlePhotoChange,className:\"text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"})]}),/*#__PURE__*/_jsx(FormField,{label:t('productName'),type:\"text\",value:name,onChange:e=>setName(e.target.value),required:true}),/*#__PURE__*/_jsxs(FormSelect,{label:t('productType'),value:productType,onChange:e=>setProductType(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:PRODUCT_TYPES.SIMPLE,children:t('standardItem')}),/*#__PURE__*/_jsx(\"option\",{value:PRODUCT_TYPES.PACK,children:t('pack')})]}),productType===PRODUCT_TYPES.SIMPLE&&/*#__PURE__*/_jsxs(_Fragment,{children:[variants.length===0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FormField,{label:t('quantity'),type:\"number\",value:quantity,onChange:e=>setQuantity(e.target.value),required:true,min:\"0\"}),/*#__PURE__*/_jsx(FormField,{label:t('reorderThreshold'),type:\"number\",value:reorderThreshold,onChange:e=>setReorderThreshold(e.target.value),required:true,min:\"0\"}),/*#__PURE__*/_jsx(FormField,{label:t('salePrice'),type:\"number\",value:price,onChange:e=>setPrice(e.target.value),required:true,min:\"0\"})]}):/*#__PURE__*/_jsx(FormField,{label:t('basePrice'),type:\"number\",value:basePrice,onChange:e=>setBasePrice(e.target.value),required:true,min:\"0\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border rounded-lg space-y-4 bg-gray-50\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold\",children:t('productVariantsOptional')}),/*#__PURE__*/_jsx(VariantForm,{onAddVariant:handleAddVariant,t:t}),variants.length>0&&/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-2\",children:variants.map(v=>/*#__PURE__*/_jsxs(\"li\",{className:\"flex justify-between items-center bg-white p-2 rounded-md text-sm\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[v.name,\" (\",t('priceMod'),\": \",formatCurrency(v.priceModifier,language),\", \",t('stock'),\": \",v.quantity,\")\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleRemoveVariant(v.id),className:\"text-red-500\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})]},v.id))})]})]}),productType===PRODUCT_TYPES.PACK&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FormField,{label:t('packSalePrice'),type:\"number\",value:price,onChange:e=>setPrice(e.target.value),required:true,min:\"0\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border rounded-lg space-y-4 bg-gray-50\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold\",children:t('packComposition')}),/*#__PURE__*/_jsx(PackItemSelector,{products:products.filter(p=>p.type===PRODUCT_TYPES.SIMPLE||p.type===PRODUCT_TYPES.VARIANT),onAddItem:handleAddPackItem,t:t}),/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-2\",children:packItems.map(item=>/*#__PURE__*/_jsxs(\"li\",{className:\"flex justify-between items-center bg-white p-2 rounded-md\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[item.name,\" x \",item.quantity]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleRemovePackItem(item.packItemId),className:\"text-red-500\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})]},item.packItemId))})]})]}),/*#__PURE__*/_jsxs(FormSelect,{label:t('mainCategory'),value:parentCategoryId,onChange:e=>{setParentCategoryId(e.target.value);setSubCategoryId('');},disabled:productType===PRODUCT_TYPES.PACK,children:[/*#__PURE__*/_jsxs(\"option\",{value:\"\",children:[t('select'),\"...\"]}),parentCategories.map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat.id,children:cat.name},cat.id))]}),/*#__PURE__*/_jsxs(FormSelect,{label:t('subCategory'),value:subCategoryId,onChange:e=>setSubCategoryId(e.target.value),disabled:!parentCategoryId||subCategories.length===0||productType===PRODUCT_TYPES.PACK,children:[/*#__PURE__*/_jsxs(\"option\",{value:\"\",children:[t('select'),\"...\"]}),subCategories.map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat.id,children:cat.name},cat.id))]}),/*#__PURE__*/_jsx(FormField,{label:t('description'),type:\"text\",value:description,onChange:e=>setDescription(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('cancel')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\",children:initialData?t('update'):t('add')})]})]});});const VariantForm=/*#__PURE__*/React.memo(_ref17=>{let{onAddVariant,t}=_ref17;const[name,setName]=useState('');const[priceModifier,setPriceModifier]=useState(0);const[quantity,setQuantity]=useState('');const[reorderThreshold,setReorderThreshold]=useState('');const handleAdd=()=>{if(!name||quantity==='')return;onAddVariant({name,priceModifier:Number(priceModifier),quantity:Number(quantity),reorderThreshold:Number(reorderThreshold||0)});setName('');setPriceModifier(0);setQuantity('');setReorderThreshold('');};return/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-2 items-end\",children:[/*#__PURE__*/_jsx(FormField,{label:t('variantName'),value:name,onChange:e=>setName(e.target.value),placeholder:\"Ex: Rouge, XL...\"}),/*#__PURE__*/_jsx(FormField,{label:t('priceMod'),type:\"number\",value:priceModifier,onChange:e=>setPriceModifier(e.target.value),placeholder:\"Ex: 500 ou -200\"}),/*#__PURE__*/_jsx(FormField,{label:t('stock'),type:\"number\",value:quantity,onChange:e=>setQuantity(e.target.value),placeholder:t('quantity')}),/*#__PURE__*/_jsx(FormField,{label:t('reorderThresh'),type:\"number\",value:reorderThreshold,onChange:e=>setReorderThreshold(e.target.value),placeholder:t('threshold')}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleAdd,className:\"px-4 py-2 bg-blue-500 text-white rounded-lg h-10\",children:/*#__PURE__*/_jsx(Plus,{size:20})})]});});const PackItemSelector=/*#__PURE__*/React.memo(_ref18=>{let{products,onAddItem,t}=_ref18;const[selectedProductId,setSelectedProductId]=useState('');const[selectedVariantId,setSelectedVariantId]=useState('');const[quantity,setQuantity]=useState(1);const selectedProduct=useMemo(()=>{return products.find(p=>p.id===selectedProductId);},[products,selectedProductId]);useEffect(()=>{setSelectedVariantId('');},[selectedProductId]);const handleAdd=()=>{if(!selectedProduct||quantity<=0)return;if(selectedProduct.type===PRODUCT_TYPES.VARIANT){if(!selectedVariantId)return;const variant=selectedProduct.variants.find(v=>v.id===selectedVariantId);if(variant){const itemToAdd={productId:selectedProduct.id,name:\"\".concat(selectedProduct.name,\" - \").concat(variant.name),quantity:quantity,variant:{id:variant.id,name:variant.name}};onAddItem(itemToAdd);}}else{const itemToAdd={productId:selectedProduct.id,name:selectedProduct.name,quantity:quantity,variant:null};onAddItem(itemToAdd);}setSelectedProductId('');setSelectedVariantId('');setQuantity(1);};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-end gap-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow min-w-[150px]\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:t('product')}),/*#__PURE__*/_jsxs(\"select\",{value:selectedProductId,onChange:e=>setSelectedProductId(e.target.value),className:\"w-full px-3 py-2 border rounded-lg bg-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:t('chooseProduct')}),products.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p.id,children:p.name},p.id))]})]}),selectedProduct&&selectedProduct.type===PRODUCT_TYPES.VARIANT&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow min-w-[150px]\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:t('variant')}),/*#__PURE__*/_jsxs(\"select\",{value:selectedVariantId,onChange:e=>setSelectedVariantId(e.target.value),className:\"w-full px-3 py-2 border rounded-lg bg-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:t('chooseVariant')}),selectedProduct.variants.map(v=>/*#__PURE__*/_jsxs(\"option\",{value:v.id,children:[v.name,\" (Stock: \",v.quantity,\")\"]},v.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-24\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:t('quantity')}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:quantity,onChange:e=>setQuantity(Number(e.target.value)),min:\"1\",className:\"w-full px-3 py-2 border rounded-lg\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleAdd,className:\"px-4 py-2 bg-blue-500 text-white rounded-lg h-10 self-end\",children:/*#__PURE__*/_jsx(Plus,{size:20})})]});});const CategoryForm=/*#__PURE__*/React.memo(_ref19=>{let{onSubmit,initialData,categories,onClose,t}=_ref19;const[name,setName]=useState((initialData===null||initialData===void 0?void 0:initialData.name)||'');const[parentId,setParentId]=useState((initialData===null||initialData===void 0?void 0:initialData.parentId)||'');const parentCategories=categories.filter(c=>!c.parentId&&c.id!==(initialData===null||initialData===void 0?void 0:initialData.id));const handleSubmit=e=>{e.preventDefault();onSubmit({name,parentId:parentId||null});};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center\",children:initialData?t('editCategory'):t('addCategoryTitle')}),/*#__PURE__*/_jsx(FormField,{label:t('name'),type:\"text\",value:name,onChange:e=>setName(e.target.value),required:true}),/*#__PURE__*/_jsxs(FormSelect,{label:t('parentCategoryOptional'),value:parentId,onChange:e=>setParentId(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:t('noneMain')}),parentCategories.map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat.id,children:cat.name},cat.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('cancel')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\",children:initialData?t('update'):t('add')})]})]});});const CustomerForm=/*#__PURE__*/React.memo(_ref20=>{let{onSubmit,initialData,onClose,onSuccess,t}=_ref20;const[name,setName]=useState((initialData===null||initialData===void 0?void 0:initialData.name)||'');const[nickname,setNickname]=useState((initialData===null||initialData===void 0?void 0:initialData.nickname)||'');const[address,setAddress]=useState((initialData===null||initialData===void 0?void 0:initialData.address)||'');const[email,setEmail]=useState((initialData===null||initialData===void 0?void 0:initialData.email)||'');const[phone,setPhone]=useState((initialData===null||initialData===void 0?void 0:initialData.phone)||'');const handleSubmit=e=>{e.preventDefault();const data={name,nickname,address,email,phone,balance:(initialData===null||initialData===void 0?void 0:initialData.balance)||0};if(!initialData&&onSuccess){onSubmit(data,onSuccess);}else{onSubmit(data);}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center\",children:initialData?t('editCustomer'):t('addCustomerTitle')}),/*#__PURE__*/_jsx(FormField,{label:t('fullName'),type:\"text\",value:name,onChange:e=>setName(e.target.value),required:true}),/*#__PURE__*/_jsx(FormField,{label:t('nicknameOptional'),type:\"text\",value:nickname,onChange:e=>setNickname(e.target.value)}),/*#__PURE__*/_jsx(FormField,{label:t('addressOptional'),type:\"text\",value:address,onChange:e=>setAddress(e.target.value)}),/*#__PURE__*/_jsx(FormField,{label:t('email'),type:\"email\",value:email,onChange:e=>setEmail(e.target.value)}),/*#__PURE__*/_jsx(FormField,{label:t('phone'),type:\"tel\",value:phone,onChange:e=>setPhone(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('cancel')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\",children:initialData?t('update'):t('add')})]})]});});const DepositForm=/*#__PURE__*/React.memo(_ref21=>{let{customer,onSubmit,onClose,t}=_ref21;const[amount,setAmount]=useState('');const handleSubmit=e=>{e.preventDefault();onSubmit(amount);};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center\",children:t('addDeposit')}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-center\",children:[t('for'),\" \",customer.name]}),/*#__PURE__*/_jsx(FormField,{label:t('depositAmount'),type:\"number\",value:amount,onChange:e=>setAmount(e.target.value),required:true,min:\"1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('cancel')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 rounded-lg text-white bg-green-500 font-semibold\",children:t('save')})]})]});});const SaleForm=/*#__PURE__*/React.memo(_ref22=>{let{onSubmit,customers,onClose,cart,setCart,preselectedCustomerId,openModal,showAlert,t,language}=_ref22;const[customerId,setCustomerId]=useState(preselectedCustomerId||'');const[paymentType,setPaymentType]=useState(PAYMENT_TYPES[0]);const[discountType,setDiscountType]=useState('percentage');const[discountValue,setDiscountValue]=useState(0);const[applyVAT,setApplyVAT]=useState(false);const{subtotal,discountAmount,vatAmount,finalTotal}=useMemo(()=>{const subtotal=cart.reduce((acc,item)=>acc+item.price*item.quantity,0);const discountAmount=discountType==='percentage'?subtotal*(Number(discountValue)/100):Number(discountValue);const subtotalAfterDiscount=subtotal-discountAmount;const vatAmount=applyVAT?subtotalAfterDiscount*VAT_RATE:0;const finalTotal=subtotalAfterDiscount+vatAmount;return{subtotal,discountAmount,vatAmount,finalTotal};},[cart,discountType,discountValue,applyVAT]);const handleSubmit=e=>{e.preventDefault();if(cart.length===0){showAlert(t('cartEmpty'));return;}if(!customerId){showAlert(t('selectCustomer'));return;}onSubmit({customerId,paymentType,items:cart,totalPrice:finalTotal,discountAmount,vatAmount});};const handleAddNewCustomer=()=>{openModal('addCustomer',{onSuccess:newCustomer=>{setCustomerId(newCustomer.id);}},'md');};const updateCartItemQuantity=(cartId,newQuantity)=>{setCart(currentCart=>currentCart.map(item=>item.cartId===cartId?_objectSpread(_objectSpread({},item),{},{quantity:Math.max(0,newQuantity)}):item).filter(item=>item.quantity>0));};const selectedCustomer=useMemo(()=>customers.find(c=>c.id===customerId),[customers,customerId]);return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center text-gray-800\",children:t('salesCart')}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-bold text-lg\",children:[t('items'),\" (\",cart.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-96 overflow-y-auto space-y-3 pr-2\",children:cart.length>0?cart.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 bg-gray-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.photoURL||'https://placehold.co/60x60',alt:item.name,className:\"w-16 h-16 rounded-md object-cover\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:item.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:formatCurrency(item.price,language)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>updateCartItemQuantity(item.cartId,item.quantity-1),className:\"text-red-500\",children:/*#__PURE__*/_jsx(MinusCircle,{size:20})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:item.quantity,onChange:e=>updateCartItemQuantity(item.cartId,parseInt(e.target.value,10)||0),className:\"w-16 text-center border rounded-md p-1\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>updateCartItemQuantity(item.cartId,item.quantity+1),className:\"text-green-500\",children:/*#__PURE__*/_jsx(PlusCircle,{size:20})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"w-24 text-right font-semibold\",children:formatCurrency(item.price*item.quantity,language)})]},item.cartId)):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 py-8\",children:t('cartEmpty')})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-6 rounded-2xl space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-lg\",children:t('summary')}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow\",children:/*#__PURE__*/_jsxs(FormSelect,{label:t('customers'),value:customerId,onChange:e=>setCustomerId(e.target.value),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:t('selectCustomer')}),customers.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c.id,children:c.name},c.id))]})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleAddNewCustomer,className:\"p-2 bg-blue-500 text-white rounded-lg\",children:/*#__PURE__*/_jsx(Plus,{size:20})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:t('discount')}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"select\",{value:discountType,onChange:e=>setDiscountType(e.target.value),className:\"w-1/3 px-3 py-2 border rounded-l-lg bg-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"percentage\",children:\"%\"}),/*#__PURE__*/_jsx(\"option\",{value:\"fixed\",children:\"F CFA\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:discountValue,onChange:e=>setDiscountValue(e.target.value),min:\"0\",className:\"w-2/3 px-3 py-2 border-t border-b border-r rounded-r-lg\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"vat-checkbox\",checked:applyVAT,onChange:e=>setApplyVAT(e.target.checked),className:\"h-4 w-4 rounded\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"vat-checkbox\",className:\"ml-2 text-sm\",children:t('applyVAT')})]}),/*#__PURE__*/_jsx(FormSelect,{label:t('paymentType'),value:paymentType,onChange:e=>setPaymentType(e.target.value),required:true,children:PAYMENT_TYPES.map(type=>{if(type==='Acompte Client'&&(!selectedCustomer||(selectedCustomer.balance||0)<=0))return null;return/*#__PURE__*/_jsxs(\"option\",{value:type,children:[type,\" \",type==='Acompte Client'&&\"(\".concat(formatCurrency((selectedCustomer===null||selectedCustomer===void 0?void 0:selectedCustomer.balance)||0,language),\")\")]},type);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-4 space-y-2 text-right border-t\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[t('subtotal'),\": \",formatCurrency(subtotal,language)]}),discountAmount>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-500\",children:[t('discount'),\": -\",formatCurrency(discountAmount,language)]}),applyVAT&&/*#__PURE__*/_jsxs(\"p\",{children:[t('vat18'),\": +\",formatCurrency(vatAmount,language)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-green-600\",children:[t('total'),\": \",formatCurrency(finalTotal,language)]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-6\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>openModal('productSelection',{preselectedCustomerId:customerId},'7xl'),className:\"px-6 py-3 rounded-lg bg-gray-200 hover:bg-gray-300\",children:t('continueShopping')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-8 py-3 rounded-lg text-white bg-blue-500 font-semibold\",children:t('validateSale')})]})]});});const PaymentReceipt=/*#__PURE__*/React.memo(_ref23=>{let{receiptData,onClose,showAlert,t,language}=_ref23;if(!receiptData)return null;const{customer,amount,paymentType,paymentDate,remainingBalance,companyProfile,saleId,invoiceId}=receiptData;const[canShare,setCanShare]=useState(false);useEffect(()=>{if(navigator.share&&typeof navigator.canShare==='function'){const dummyFile=new File([\"\"],\"dummy.pdf\",{type:\"application/pdf\"});if(navigator.canShare({files:[dummyFile]})){setCanShare(true);}}},[]);const handlePrint=()=>window.print();const generatePdf=async()=>{const{jsPDF}=window.jspdf;const input=document.querySelector('.receipt-container.printable-area');if(!input||!window.html2canvas){showAlert(\"PDF generation library is not loaded.\");return null;}try{const canvas=await window.html2canvas(input,{scale:2,backgroundColor:'#ffffff'});const imgData=canvas.toDataURL('image/png');const pdf=new jsPDF('p','mm','a4');const pdfWidth=pdf.internal.pageSize.getWidth();const pdfHeight=canvas.height*pdfWidth/canvas.width;pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);return pdf;}catch(error){console.error(\"Error generating PDF:\",error);showAlert(\"Could not generate PDF.\");return null;}};const handleDownloadPDF=async()=>{const pdf=await generatePdf();if(pdf){pdf.save(\"payment-receipt-\".concat(invoiceId,\".pdf\"));}};const handleSharePDF=async()=>{const pdf=await generatePdf();if(pdf&&navigator.share){const pdfBlob=pdf.output('blob');const fileName=\"payment-receipt-\".concat(invoiceId,\".pdf\");const file=new File([pdfBlob],fileName,{type:'application/pdf'});try{await navigator.share({title:'Payment Receipt',text:\"Here is the payment receipt for invoice \".concat(invoiceId,\".\"),files:[file]});}catch(error){if(error.name!=='AbortError'){showAlert(\"An error occurred while sharing.\");}}}};return/*#__PURE__*/_jsxs(\"div\",{className:\"receipt-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"printable-area p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:t('paymentReceipt')})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold\",children:companyProfile.name})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-b my-6\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold\",children:t('receivedFrom')}),/*#__PURE__*/_jsx(\"p\",{children:customer.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold\",children:[t('date'),\":\"]}),\" \",formatDateTime(paymentDate,language)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold\",children:[t('originalInvoice'),\":\"]}),\" \",invoiceId]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg\",children:[t('amountPaid'),\": \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-green-600\",children:formatCurrency(amount,language)})]}),/*#__PURE__*/_jsxs(\"p\",{children:[t('paymentMethod'),\": \",paymentType]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg\",children:[t('remainingBalanceDebt'),\": \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-red-600\",children:formatCurrency(remainingBalance,language)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2 p-6 bg-gray-50 rounded-b-2xl no-print\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-4 py-2 rounded-lg bg-gray-200\",children:t('close')}),canShare&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleSharePDF,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-blue-600 font-semibold\",children:[/*#__PURE__*/_jsx(Share2,{size:18,className:\"mr-2\"}),\" \",t('share')]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDownloadPDF,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-green-600 font-semibold\",children:[/*#__PURE__*/_jsx(FileText,{size:18,className:\"mr-2\"}),\" PDF\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handlePrint,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-gray-500 font-semibold\",children:[/*#__PURE__*/_jsx(Printer,{size:18,className:\"mr-2\"}),\" \",t('print')]})]})]});});const DepositReceipt=/*#__PURE__*/React.memo(_ref24=>{let{receiptData,onClose,showAlert,t,language}=_ref24;if(!receiptData)return null;const{customer,amount,depositDate,companyProfile,customerId}=receiptData;const[canShare,setCanShare]=useState(false);const receiptId=\"\".concat(companyProfile.depositPrefix||'DEP-').concat(customerId.substring(0,4).toUpperCase()).concat(new Date(depositDate).getTime().toString().slice(-4));useEffect(()=>{if(navigator.share&&typeof navigator.canShare==='function'){const dummyFile=new File([\"\"],\"dummy.pdf\",{type:\"application/pdf\"});if(navigator.canShare({files:[dummyFile]})){setCanShare(true);}}},[]);const handlePrint=()=>window.print();const generatePdf=async()=>{const{jsPDF}=window.jspdf;const input=document.querySelector('.receipt-container.printable-area');if(!input||!window.html2canvas){showAlert(\"PDF generation library is not loaded.\");return null;}try{const canvas=await window.html2canvas(input,{scale:2,backgroundColor:'#ffffff'});const imgData=canvas.toDataURL('image/png');const pdf=new jsPDF('p','mm','a4');const pdfWidth=pdf.internal.pageSize.getWidth();const pdfHeight=canvas.height*pdfWidth/canvas.width;pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);return pdf;}catch(error){console.error(\"Error generating PDF:\",error);showAlert(\"Could not generate PDF.\");return null;}};const handleDownloadPDF=async()=>{const pdf=await generatePdf();if(pdf){pdf.save(\"deposit-receipt-\".concat(receiptId,\".pdf\"));}};const handleSharePDF=async()=>{const pdf=await generatePdf();if(pdf&&navigator.share){const pdfBlob=pdf.output('blob');const fileName=\"deposit-receipt-\".concat(receiptId,\".pdf\");const file=new File([pdfBlob],fileName,{type:'application/pdf'});try{await navigator.share({title:'Deposit Receipt',text:\"Here is the deposit receipt for \".concat(customer.name,\".\"),files:[file]});}catch(error){if(error.name!=='AbortError'){showAlert(\"An error occurred while sharing.\");}}}};return/*#__PURE__*/_jsxs(\"div\",{className:\"receipt-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"printable-area p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:t('depositReceipt')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm\",children:receiptId})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold\",children:companyProfile.name})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-b my-6\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold\",children:t('receivedFrom')}),/*#__PURE__*/_jsx(\"p\",{children:customer.name})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold\",children:[t('date'),\":\"]}),\" \",formatDateTime(depositDate,language)]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg\",children:[t('depositAmountLabel'),\": \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-green-600\",children:formatCurrency(amount,language)})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg\",children:[t('newDepositBalance'),\": \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-blue-600\",children:formatCurrency(customer.balance||0,language)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2 p-6 bg-gray-50 rounded-b-2xl no-print\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-4 py-2 rounded-lg bg-gray-200\",children:t('close')}),canShare&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleSharePDF,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-blue-600 font-semibold\",children:[/*#__PURE__*/_jsx(Share2,{size:18,className:\"mr-2\"}),\" \",t('share')]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDownloadPDF,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-green-600 font-semibold\",children:[/*#__PURE__*/_jsx(FileText,{size:18,className:\"mr-2\"}),\" PDF\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handlePrint,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-gray-500 font-semibold\",children:[/*#__PURE__*/_jsx(Printer,{size:18,className:\"mr-2\"}),\" \",t('print')]})]})]});});const Invoice=/*#__PURE__*/React.memo(_ref25=>{var _sale$customer;let{sale,products,companyProfile,onClose,showAlert,t,language}=_ref25;if(!sale)return null;const[canShare,setCanShare]=useState(false);useEffect(()=>{if(navigator.share&&typeof navigator.canShare==='function'){const dummyFile=new File([\"\"],\"dummy.pdf\",{type:\"application/pdf\"});if(navigator.canShare({files:[dummyFile]})){setCanShare(true);}}},[]);const handlePrint=()=>window.print();const generatePdf=async()=>{const{jsPDF}=window.jspdf;const input=document.querySelector('.invoice-container.printable-area');if(!input||!window.html2canvas){showAlert(\"PDF generation library is not loaded.\");return null;}try{const canvas=await window.html2canvas(input,{scale:2,backgroundColor:'#ffffff'});const imgData=canvas.toDataURL('image/png');const pdf=new jsPDF('p','mm','a4');const pdfWidth=pdf.internal.pageSize.getWidth();const pdfHeight=canvas.height*pdfWidth/canvas.width;pdf.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);return pdf;}catch(error){console.error(\"Error generating PDF:\",error);showAlert(\"Could not generate PDF.\");return null;}};const handleDownloadPDF=async()=>{const pdf=await generatePdf();if(pdf){pdf.save(\"invoice-\".concat(sale.invoiceId,\".pdf\"));}};const handleSharePDF=async()=>{const pdf=await generatePdf();if(pdf&&navigator.share){const pdfBlob=pdf.output('blob');const fileName=\"invoice-\".concat(sale.invoiceId,\".pdf\");const file=new File([pdfBlob],fileName,{type:'application/pdf'});try{await navigator.share({title:\"Invoice \".concat(sale.invoiceId),text:\"Here is the invoice for \".concat(sale.customer.name,\".\"),files:[file]});}catch(error){if(error.name!=='AbortError'){showAlert(\"An error occurred while sharing.\");}}}};return/*#__PURE__*/_jsxs(\"div\",{className:\"invoice-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"printable-area p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold\",children:t('invoice')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm\",children:sale.invoiceId})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[companyProfile.logo&&/*#__PURE__*/_jsx(\"img\",{src:companyProfile.logo,alt:companyProfile.name,className:\"h-12 w-auto ml-auto mb-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold\",children:companyProfile.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:companyProfile.address}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:companyProfile.phone})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-b my-6\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold\",children:t('billedTo')}),/*#__PURE__*/_jsx(\"p\",{children:(_sale$customer=sale.customer)===null||_sale$customer===void 0?void 0:_sale$customer.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold\",children:[t('date'),\":\"]}),\" \",formatDateTime(sale.saleDate,language)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold\",children:[t('payment'),\":\"]}),\" \",sale.paymentType]})]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left mb-8\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-100\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('product')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3\",children:t('qty')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 text-right\",children:t('pu')}),/*#__PURE__*/_jsx(\"th\",{className:\"p-3 text-right\",children:t('total')})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:sale.items.flatMap((item,i)=>{const productDetails=products.find(p=>p.id===item.productId);const mainRow=/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-3 border-b\",children:item.productName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 border-b\",children:item.quantity}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 border-b text-right\",children:formatCurrency(item.unitPrice,language)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-3 border-b text-right\",children:formatCurrency(item.subtotal,language)})]},item.productId||i);if(productDetails&&productDetails.type===PRODUCT_TYPES.PACK){const subRows=productDetails.packItems.map((packItem,j)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-50 text-sm\",children:[/*#__PURE__*/_jsxs(\"td\",{className:\"pl-8 pr-3 py-2 text-gray-600 border-b\",children:[packItem.quantity*item.quantity,\" x \",packItem.name]}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b\"})]},\"\".concat(item.productId,\"-\").concat(j)));return[mainRow,...subRows];}return[mainRow];})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right w-full max-w-xs ml-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[t('subtotal'),\":\"]}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(sale.items.reduce((acc,i)=>acc+i.subtotal,0),language)})]}),sale.discountAmount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-red-500\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[t('discount'),\":\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"-\",formatCurrency(sale.discountAmount,language)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[t('amountBeforeTax'),\":\"]}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(sale.totalPrice-sale.vatAmount,language)})]}),sale.vatAmount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[t('vat18'),\":\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"+\",formatCurrency(sale.vatAmount,language)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-2xl font-bold border-t mt-2 pt-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[t('total').toUpperCase(),\":\"]}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(sale.totalPrice,language)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-12 text-center text-sm text-gray-500\",children:/*#__PURE__*/_jsx(\"p\",{children:companyProfile.invoiceFooterMessage||t('thankYou')})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2 p-6 bg-gray-50 rounded-b-2xl no-print\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-4 py-2 rounded-lg bg-gray-200\",children:t('close')}),canShare&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleSharePDF,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-blue-600 font-semibold\",children:[/*#__PURE__*/_jsx(Share2,{size:18,className:\"mr-2\"}),\" \",t('share')]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDownloadPDF,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-green-600 font-semibold\",children:[/*#__PURE__*/_jsx(FileText,{size:18,className:\"mr-2\"}),\" PDF\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handlePrint,className:\"flex items-center px-4 py-2 rounded-lg text-white bg-gray-500 font-semibold\",children:[/*#__PURE__*/_jsx(Printer,{size:18,className:\"mr-2\"}),\" \",t('print')]})]})]});});const CompanyProfileForm=/*#__PURE__*/React.memo(_ref26=>{let{onSubmit,initialData,t}=_ref26;const[name,setName]=useState((initialData===null||initialData===void 0?void 0:initialData.name)||'');const[address,setAddress]=useState((initialData===null||initialData===void 0?void 0:initialData.address)||'');const[phone,setPhone]=useState((initialData===null||initialData===void 0?void 0:initialData.phone)||'');const[logo,setLogo]=useState((initialData===null||initialData===void 0?void 0:initialData.logo)||null);const[invoicePrefix,setInvoicePrefix]=useState((initialData===null||initialData===void 0?void 0:initialData.invoicePrefix)||'FAC-');const[refundPrefix,setRefundPrefix]=useState((initialData===null||initialData===void 0?void 0:initialData.refundPrefix)||'REM-');const[depositPrefix,setDepositPrefix]=useState((initialData===null||initialData===void 0?void 0:initialData.depositPrefix)||'DEP-');const[invoiceFooterMessage,setInvoiceFooterMessage]=useState((initialData===null||initialData===void 0?void 0:initialData.invoiceFooterMessage)||'Merci pour votre achat !');const[language,setLanguage]=useState((initialData===null||initialData===void 0?void 0:initialData.language)||'fr');const[isDocSettingsVisible,setIsDocSettingsVisible]=useState(false);const handleLogoChange=async e=>{if(e.target.files[0]){try{const r=await resizeImage(e.target.files[0],200,200);setLogo(r);}catch(err){console.error(err);}}};const handleSubmit=e=>{e.preventDefault();onSubmit({name,address,phone,logo,invoicePrefix,refundPrefix,depositPrefix,invoiceFooterMessage,language});};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-700 mb-4\",children:t('generalInfo')}),/*#__PURE__*/_jsxs(FormSelect,{label:t('language'),value:language,onChange:e=>setLanguage(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"fr\",children:t('francais')}),/*#__PURE__*/_jsx(\"option\",{value:\"en\",children:t('english')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"w-full text-sm font-medium\",children:\"Logo\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-32 h-32 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-dashed\",children:logo?/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"Logo preview\",className:\"w-full h-full object-contain rounded-lg\"}):/*#__PURE__*/_jsx(ImageIcon,{className:\"text-gray-400\",size:40})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleLogoChange,className:\"text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"})]}),/*#__PURE__*/_jsx(FormField,{label:t('companyName'),type:\"text\",value:name,onChange:e=>setName(e.target.value),required:true}),/*#__PURE__*/_jsx(FormField,{label:t('address'),type:\"text\",value:address,onChange:e=>setAddress(e.target.value)}),/*#__PURE__*/_jsx(FormField,{label:t('phone'),type:\"tel\",value:phone,onChange:e=>setPhone(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t pt-6\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setIsDocSettingsVisible(!isDocSettingsVisible),className:\"flex justify-between items-center w-full text-left font-semibold text-lg text-gray-700\",children:[t('docCustomization'),/*#__PURE__*/_jsx(ChevronDown,{className:\"transition-transform \".concat(isDocSettingsVisible?'rotate-180':'')})]}),isDocSettingsVisible&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 space-y-4\",children:[/*#__PURE__*/_jsx(FormField,{label:t('salesInvoicePrefix'),value:invoicePrefix,onChange:e=>setInvoicePrefix(e.target.value)}),/*#__PURE__*/_jsx(FormField,{label:t('refundInvoicePrefix'),value:refundPrefix,onChange:e=>setRefundPrefix(e.target.value)}),/*#__PURE__*/_jsx(FormField,{label:t('depositReceiptPrefix'),value:depositPrefix,onChange:e=>setDepositPrefix(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:t('invoiceFooterMessage')}),/*#__PURE__*/_jsx(\"textarea\",{value:invoiceFooterMessage,onChange:e=>setInvoiceFooterMessage(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\",rows:\"3\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end pt-4\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\",children:t('save')})})]});});const PaymentForm=/*#__PURE__*/React.memo(_ref27=>{let{onSubmit,sale,customers,onClose,t,language}=_ref27;const customer=useMemo(()=>customers.find(c=>c.id===sale.customerId),[customers,sale]);const remainingBalance=sale.totalPrice-(sale.paidAmount||0);const[amount,setAmount]=useState(remainingBalance);const[paymentType,setPaymentType]=useState(PAYMENT_TYPES[0]);useEffect(()=>{if(paymentType==='Acompte Client'&&customer!==null&&customer!==void 0&&customer.balance){setAmount(Math.min(remainingBalance,customer.balance));}else{setAmount(remainingBalance);}},[paymentType,customer,remainingBalance]);const handleSubmit=e=>{e.preventDefault();onSubmit(amount,paymentType);};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center\",children:t('makeAPayment')}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"strong\",{children:[t('customers'),\":\"]}),\" \",sale.customerName]}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold text-red-600\",children:[t('remainingBalance'),\": \",formatCurrency(remainingBalance,language)]})]}),/*#__PURE__*/_jsx(FormField,{label:t('amountPaid'),type:\"number\",value:amount,onChange:e=>setAmount(e.target.value),required:true,min:\"1\",max:paymentType==='Acompte Client'?Math.min(remainingBalance,(customer===null||customer===void 0?void 0:customer.balance)||0):remainingBalance}),/*#__PURE__*/_jsx(FormSelect,{label:t('paymentMethod'),value:paymentType,onChange:e=>setPaymentType(e.target.value),required:true,children:PAYMENT_TYPES.filter(p=>p!=='Créance').filter(p=>p!=='Acompte Client'||customer&&customer.balance>0).map(type=>/*#__PURE__*/_jsxs(\"option\",{value:type,children:[type,\" \",type==='Acompte Client'&&\"(\".concat(t('available'),\": \").concat(formatCurrency((customer===null||customer===void 0?void 0:customer.balance)||0,language),\")\")]},type))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('cancel')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 rounded-lg text-white bg-green-500 font-semibold\",children:t('savePayment')})]})]});});const FormField=/*#__PURE__*/React.memo(_ref28=>{let{label}=_ref28,props=_objectWithoutProperties(_ref28,_excluded2);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:label}),/*#__PURE__*/_jsx(\"input\",_objectSpread(_objectSpread({},props),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"}))]});});const FormSelect=/*#__PURE__*/React.memo(_ref29=>{let{label,children}=_ref29,props=_objectWithoutProperties(_ref29,_excluded3);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:label}),/*#__PURE__*/_jsx(\"select\",_objectSpread(_objectSpread({},props),{},{className:\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white\",children:children}))]});});const StatusBadge=/*#__PURE__*/React.memo(_ref30=>{let{status}=_ref30;const statusClasses={[SALE_STATUS.COMPLETED]:'bg-green-100 text-green-800',[SALE_STATUS.PARTIALLY_RETURNED]:'bg-yellow-100 text-yellow-800',[SALE_STATUS.RETURNED]:'bg-red-100 text-red-800',[SALE_STATUS.CREDIT]:'bg-orange-100 text-orange-800',\"Espèce\":'bg-blue-100 text-blue-800',\"Wave\":'bg-cyan-100 text-cyan-800',\"Orange Money\":'bg-orange-100 text-orange-800',\"Acompte Client\":'bg-purple-100 text-purple-800'};return/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 text-xs font-semibold rounded-full capitalize \".concat(statusClasses[status]||'bg-gray-100 text-gray-800'),children:status});});const ProductSelectionModal=/*#__PURE__*/React.memo(_ref31=>{let{products,onAddToCart,openModal,onClose,onProceedToCart,cart,t,language}=_ref31;const[searchTerm,setSearchTerm]=useState('');const filteredProducts=useMemo(()=>products.filter(p=>p.name.toLowerCase().includes(searchTerm.toLowerCase())),[products,searchTerm]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold\",children:t('selectProducts')}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative w-1/3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:t('search'),value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"w-full pl-10 pr-4 py-2 border rounded-lg\"}),/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\",size:20})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 max-h-[60vh] overflow-y-auto p-2\",children:filteredProducts.map(product=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>openModal('productDetails',product,'md'),className:\"bg-white rounded-lg shadow p-3 flex flex-col items-center text-center cursor-pointer hover:shadow-lg transition-shadow\",children:[/*#__PURE__*/_jsx(\"img\",{src:product.photoURL||'https://placehold.co/150x150',alt:product.name,className:\"w-full h-28 object-cover rounded-md mb-2\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-sm flex-grow\",children:product.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-600 font-bold text-sm\",children:formatCurrency(product.price||product.basePrice,language)})]},product.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-6 mt-4 border-t\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('cancel')}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:onProceedToCart,className:\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold flex items-center\",children:[t('viewCart'),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 bg-white text-blue-500 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\",children:cart.length})]})]})]});});const ProductDetailModal=/*#__PURE__*/React.memo(_ref32=>{var _product$variants,_product$variants$;let{product,onAddToCart,onClose,openModal,t,language}=_ref32;const[quantity,setQuantity]=useState(1);const[selectedVariantId,setSelectedVariantId]=useState(((_product$variants=product.variants)===null||_product$variants===void 0?void 0:(_product$variants$=_product$variants[0])===null||_product$variants$===void 0?void 0:_product$variants$.id)||null);const handleAddAndReturn=()=>{if(product.type===PRODUCT_TYPES.VARIANT){const variant=product.variants.find(v=>v.id===selectedVariantId);if(variant){onAddToCart(product,quantity,variant);// Re-open product selection modal after adding\nopenModal('productSelection',null,'7xl');}}else{onAddToCart(product,quantity);// Re-open product selection modal after adding\nopenModal('productSelection',null,'7xl');}};const selectedVariant=useMemo(()=>{var _product$variants2;return(_product$variants2=product.variants)===null||_product$variants2===void 0?void 0:_product$variants2.find(v=>v.id===selectedVariantId);},[product,selectedVariantId]);const maxQuantity=selectedVariant?selectedVariant.quantity:product.quantity;return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-center mb-4\",children:product.name}),/*#__PURE__*/_jsx(\"img\",{src:product.photoURL||'https://placehold.co/300x200',alt:product.name,className:\"w-full h-48 object-cover rounded-lg mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-xl font-bold text-blue-600 mb-4\",children:formatCurrency(selectedVariant?(product.basePrice||0)+(selectedVariant.priceModifier||0):product.price,language)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-4\",children:product.description}),product.type===PRODUCT_TYPES.VARIANT&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"font-semibold\",children:[t('variant'),\":\"]}),/*#__PURE__*/_jsx(FormSelect,{value:selectedVariantId,onChange:e=>setSelectedVariantId(e.target.value),children:product.variants.map(v=>/*#__PURE__*/_jsxs(\"option\",{value:v.id,children:[v.name,\" (\",t('stock'),\": \",v.quantity,\")\"]},v.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"font-semibold\",children:[t('quantity'),\":\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:quantity,onChange:e=>setQuantity(Number(e.target.value)),min:\"1\",max:maxQuantity,className:\"w-24 text-center border rounded-md p-2\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>openModal('editProduct',product,'lg'),className:\"px-6 py-2 rounded-lg bg-gray-200\",children:t('manageStock')}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleAddAndReturn,className:\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\",children:t('addToCart')})]})]});});","map":{"version":3,"names":["React","useState","useEffect","useMemo","useCallback","initializeApp","getAuth","onAuthStateChanged","signInAnonymously","signInWithCustomToken","getFirestore","collection","doc","addDoc","updateDoc","deleteDoc","onSnapshot","query","writeBatch","getDoc","setDoc","getDocs","where","orderBy","runTransaction","Printer","Plus","Trash2","Edit","X","Users","Package","ShoppingCart","DollarSign","BarChart2","Tag","Image","ImageIcon","CreditCard","CheckCircle","ListChecks","Settings","AlertCircle","FileText","ArrowLeft","Filter","Share2","List","LayoutGrid","MinusCircle","PlusCircle","Search","Archive","ChevronDown","Phone","MessageSquare","Menu","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","translations","fr","dashboard","products","categories","customers","sales","debts","refunds","settings","newSale","searchPlaceholder","searchResults","invoices","salesToday","totalSales","lowStock","currentStock","threshold","recentSales","invoiceNo","total","date","addProduct","startSale","productList","stockManagement","photo","name","category","stock","price","actions","edit","delete","addCategory","parentCategory","addCustomer","searchCustomer","nickname","phone","customerDeposit","loading","backToList","purchaseHistory","noPurchases","filter","hide","today","thisWeek","thisMonth","thisYear","all","from","to","totalDisplayed","amountDue","makePayment","refundHistory","amount","method","invoiceRef","generalInfo","companyName","address","docCustomization","salesInvoicePrefix","refundInvoicePrefix","depositReceiptPrefix","invoiceFooterMessage","save","language","francais","english","editProduct","productName","productType","standardItem","pack","quantity","reorderThreshold","salePrice","basePrice","productVariantsOptional","packSalePrice","packComposition","mainCategory","select","subCategory","description","cancel","update","add","variantName","priceMod","reorderThresh","product","chooseProduct","variant","chooseVariant","editCategory","addCategoryTitle","parentCategoryOptional","noneMain","editCustomer","addCustomerTitle","fullName","nicknameOptional","addressOptional","email","addDeposit","for","depositAmount","salesCart","items","cartEmpty","summary","discount","applyVAT","paymentType","subtotal","continueShopping","validateSale","paymentReceipt","receivedFrom","originalInvoice","amountPaid","paymentMethod","remainingBalanceDebt","close","share","print","depositReceipt","depositAmountLabel","newDepositBalance","invoice","billedTo","payment","qty","pu","amountBeforeTax","vat18","thankYou","makeAPayment","remainingBalance","available","savePayment","selectProducts","search","viewCart","manageStock","addToCart","appeler","sms","salesComparison","yesterday","en","firebaseConfig","__firebase_config","JSON","parse","appId","__app_id","app","auth","db","PAYMENT_TYPES","ROLES","ADMIN","VENDEUR","SALE_STATUS","COMPLETED","PARTIALLY_RETURNED","RETURNED","CREDIT","VAT_RATE","PRODUCT_TYPES","SIMPLE","PACK","VARIANT","formatCurrency","number","lang","arguments","length","undefined","locale","currencyDisplay","isNaN","Number","concat","toLocaleString","minimumFractionDigits","maximumFractionDigits","replace","formatDateTime","isoString","Date","options","day","month","year","hour","minute","hourCycle","Intl","DateTimeFormat","format","formatDate","toInputDate","d","getFullYear","getMonth","toString","padStart","getDate","resizeImage","file","maxWidth","maxHeight","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","event","img","src","target","result","canvas","document","createElement","width","height","ctx","getContext","drawImage","toDataURL","onerror","error","Modal","memo","_ref","children","onClose","size","sizeClass","md","lg","xl","className","onClick","AlertModal","_ref2","message","ConfirmModal","_ref3","onConfirm","StatCard","_ref4","icon","title","value","color","valueColor","App","user","setUser","isAuthReady","setIsAuthReady","setLanguage","userRole","userPseudo","currentView","setCurrentView","viewPayload","setViewPayload","setProducts","setCustomers","setSales","setCategories","payments","setPayments","companyProfile","setCompanyProfile","logo","invoicePrefix","refundPrefix","depositPrefix","lastInvoiceNumber","cart","setCart","modalState","setModalState","isOpen","type","item","alertInfo","setAlertInfo","show","confirmInfo","setConfirmInfo","isMenuCollapsed","setIsMenuCollapsed","isMobileMenuOpen","setIsMobileMenuOpen","t","key","productsToReorder","toReorder","forEach","p","_p$variants","variants","v","push","id","showAlert","showConfirm","navigate","view","payload","currentCart","cartItemId","existingItem","find","cartId","map","_objectSpread","newItem","priceModifier","unsubscribeAuth","authUser","__initial_auth_token","console","loadScript","querySelector","script","Error","body","appendChild","catch","collectionsToSubscribe","setter","unsubscribers","_ref5","path","q","snapshot","docs","data","err","profileDocRef","unsubProfile","docSnap","exists","prev","unsub","closeModal","handleAddItem","collectionName","onSuccess","docRef","handleEditItem","handleSaveProfile","profileData","merge","handleDeleteItem","openModal","handleAddSale","saleData","customerId","totalPrice","discountAmount","vatAmount","customer","c","newSaleRef","profileRef","newSaleData","transaction","profileDoc","get","productsToRead","Map","set","mainProductDocs","Array","values","ref","productsDataMap","packItemRefsToRead","productData","packItems","packItem","has","productId","packItemDocs","variantIndex","findIndex","childProductData","productRef","newVariants","childProductRef","newQuantity","customerBalance","balance","customerRef","newInvoiceNumber","invoiceId","status","finalSaleData","customerName","i","unitPrice","paidAmount","saleDate","toISOString","userId","uid","handleShowInvoice","sale","handleMakePayment","saleToPay","amountPaidStr","currentPaidAmount","newPaidAmount","isFullyPaid","newStatus","batch","saleRef","paymentData","saleId","paymentDate","commit","handleAddDeposit","newBalance","depositDate","openSaleModal","preselectedCustomerId","navItems","label","activeViews","renderModalContent","ProductSelectionModal","onAddToCart","onProceedToCart","ProductDetailModal","ProductForm","onSubmit","cb","initialData","CategoryForm","CustomerForm","SaleForm","PaymentForm","pType","DepositForm","Invoice","PaymentReceipt","receiptData","DepositReceipt","alt","NavItem","active","includes","isCollapsed","DashboardView","ProductsView","handleDelete","CategoriesView","CustomersView","CustomerDetailsView","SalesView","DebtsView","RefundsView","SettingsView","_ref6","href","_ref7","searchTerm","setSearchTerm","setSearchResults","handleSearch","e","term","toLowerCase","foundProducts","foundCustomers","foundSales","s","totalCredit","reduce","acc","totalSalesToday","split","startsWith","displayedSales","sort","a","b","slice","placeholder","onChange","join","StockManagementView","_ref8","colSpan","_ref9","viewMode","setViewMode","selectedProducts","setSelectedProducts","Set","activeTab","setActiveTab","toggleProductSelection","newSet","handleStartSale","cartItems","categoryMap","cat","_categoryMap$item$cat","disabled","checked","photoURL","categoryId","readOnly","_ref0","parentId","_ref1","filteredCustomers","preventDefault","_ref10","customerSales","setCustomerSales","setLoading","salesRef","unsubscribe","salesData","sanitizedPhone","rel","StatusBadge","_ref11","activeFilter","setActiveFilter","customStartDate","setCustomStartDate","customEndDate","setCustomEndDate","showFilters","setShowFilters","filteredSales","start","end","now","setHours","first","getDay","setDate","_ref12","debtSales","_ref13","sortedPayments","index","_ref14","CompanyProfileForm","_ref15","_initialData$quantity","_initialData$reorderT","setName","setDescription","setPrice","setBasePrice","setPhotoURL","parentCategoryId","setParentCategoryId","subCategoryId","setSubCategoryId","setProductType","setQuantity","setReorderThreshold","setPackItems","packItemId","crypto","randomUUID","setVariants","parentCategories","subCategories","handleSubmit","finalProductType","commonData","finalPackItems","_ref16","rest","_objectWithoutProperties","_excluded","handlePhotoChange","files","r","handleAddPackItem","current","handleRemovePackItem","handleAddVariant","handleRemoveVariant","variantId","accept","FormField","required","FormSelect","min","VariantForm","onAddVariant","PackItemSelector","onAddItem","_ref17","setPriceModifier","handleAdd","_ref18","selectedProductId","setSelectedProductId","selectedVariantId","setSelectedVariantId","selectedProduct","itemToAdd","_ref19","setParentId","_ref20","setNickname","setAddress","setEmail","setPhone","_ref21","setAmount","_ref22","setCustomerId","setPaymentType","discountType","setDiscountType","discountValue","setDiscountValue","setApplyVAT","finalTotal","subtotalAfterDiscount","handleAddNewCustomer","newCustomer","updateCartItemQuantity","Math","max","selectedCustomer","parseInt","htmlFor","_ref23","canShare","setCanShare","navigator","dummyFile","File","handlePrint","window","generatePdf","jsPDF","jspdf","input","html2canvas","scale","backgroundColor","imgData","pdf","pdfWidth","internal","pageSize","getWidth","pdfHeight","addImage","handleDownloadPDF","handleSharePDF","pdfBlob","output","fileName","text","_ref24","receiptId","substring","toUpperCase","getTime","_ref25","_sale$customer","flatMap","productDetails","mainRow","subRows","j","_ref26","setLogo","setInvoicePrefix","setRefundPrefix","setDepositPrefix","setInvoiceFooterMessage","isDocSettingsVisible","setIsDocSettingsVisible","handleLogoChange","rows","_ref27","_ref28","props","_excluded2","_ref29","_excluded3","_ref30","statusClasses","_ref31","filteredProducts","_ref32","_product$variants","_product$variants$","handleAddAndReturn","selectedVariant","_product$variants2","maxQuantity"],"sources":["/workspaces/Sofalia-v8/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from 'firebase/auth';\nimport {\n    getFirestore,\n    collection,\n    doc,\n    addDoc,\n    updateDoc,\n    deleteDoc,\n    onSnapshot,\n    query,\n    writeBatch,\n    getDoc,\n    setDoc,\n    getDocs,\n    where,\n    orderBy,\n    runTransaction,\n} from 'firebase/firestore';\nimport { Printer, Plus, Trash2, Edit, X, Users, Package, ShoppingCart, DollarSign, BarChart2, Tag, Image as ImageIcon, CreditCard, CheckCircle, ListChecks, Settings, AlertCircle, FileText, ArrowLeft, Filter, Share2, List, LayoutGrid, MinusCircle, PlusCircle, Search, Archive, ChevronDown, Phone, MessageSquare, Menu } from 'lucide-react';\n\n// --- Translations ---\nconst translations = {\n    fr: {\n        dashboard: \"Tableau de Bord\", products: \"Produits\", categories: \"Catégories\", customers: \"Clients\", sales: \"Ventes\",\n        debts: \"Créances\", refunds: \"Remboursements\", settings: \"Paramètres\", newSale: \"Nouvelle Vente\", searchPlaceholder: \"Rechercher une facture, un client, un produit...\",\n        searchResults: \"Résultats de la recherche\", invoices: \"Factures\", salesToday: \"Ventes du Jour\", totalSales: \"Total Ventes\",\n        lowStock: \"Stocks Faibles\", currentStock: \"Stock Actuel\", threshold: \"Seuil\", recentSales: \"Ventes Récentes\", invoiceNo: \"N° Facture\",\n        total: \"Total\", date: \"Date\", addProduct: \"Ajouter Produit\", startSale: \"Démarrer la Vente\", productList: \"Liste des produits\",\n        stockManagement: \"Gestion du Stock\", photo: \"Photo\", name: \"Nom\", category: \"Catégorie\", stock: \"Stock\", price: \"Prix\", actions: \"Actions\",\n        edit: \"Modifier\", delete: \"Supprimer\", addCategory: \"Ajouter Catégorie\", parentCategory: \"Catégorie Parente\", addCustomer: \"Ajouter Client\",\n        searchCustomer: \"Rechercher un client...\", nickname: \"Surnom\", phone: \"Téléphone\", customerDeposit: \"Acompte Client\",\n        loading: \"Chargement...\", backToList: \"Retour à la liste\", purchaseHistory: \"Historique des achats\", noPurchases: \"Aucun achat enregistré.\",\n        filter: \"Filtrer\", hide: \"Masquer\", today: \"Aujourd'hui\", thisWeek: \"Cette semaine\", thisMonth: \"Ce mois\", thisYear: \"Cette année\", all: \"Toutes\",\n        from: \"Du\", to: \"Au\", totalDisplayed: \"Total affiché\", amountDue: \"Montant Dû\", makePayment: \"Faire un paiement\", refundHistory: \"Historique de Remboursements\",\n        amount: \"Montant\", method: \"Méthode\", invoiceRef: \"Facture Réf.\", generalInfo: \"Informations Générales\", companyName: \"Nom de l'entreprise\",\n        address: \"Adresse\", docCustomization: \"Personnalisation des Documents\", salesInvoicePrefix: \"Préfixe Facture de Vente\",\n        refundInvoicePrefix: \"Préfixe Facture de Remboursement\", depositReceiptPrefix: \"Préfixe Reçu d'Acompte\", invoiceFooterMessage: \"Message de Pied de Facture\",\n        save: \"Enregistrer\", language: \"Langue\", francais: \"Français\", english: \"Anglais\",\n        editProduct: \"Modifier Produit\", productName: \"Nom du produit\", productType: \"Type de Produit\", standardItem: \"Article Standard (Simple ou avec Gammes)\",\n        pack: \"Pack\", quantity: \"Quantité\", reorderThreshold: \"Seuil de réappro.\", salePrice: \"Prix de Vente\", basePrice: \"Prix de Base\",\n        productVariantsOptional: \"Gammes du Produit (Optionnel)\", packSalePrice: \"Prix de Vente du Pack\", packComposition: \"Composition du Pack\",\n        mainCategory: \"Catégorie Principale\", select: \"Sélectionner...\", subCategory: \"Sous-catégorie\", description: \"Description\",\n        cancel: \"Annuler\", update: \"Mettre à jour\", add: \"Ajouter\", variantName: \"Nom Gamme\", priceMod: \"Modif. Prix\",\n        reorderThresh: \"Seuil Réappro.\", product: \"Produit\", chooseProduct: \"Choisir un produit...\", variant: \"Gamme\",\n        chooseVariant: \"Choisir une gamme...\", editCategory: \"Modifier Catégorie\", addCategoryTitle: \"Ajouter Catégorie\",\n        parentCategoryOptional: \"Catégorie Parente (Optionnel)\", noneMain: \"Aucune (Principale)\", editCustomer: \"Modifier Client\",\n        addCustomerTitle: \"Ajouter Client\", fullName: \"Nom complet\", nicknameOptional: \"Surnom (Optionnel)\", addressOptional: \"Adresse (Optionnel)\",\n        email: \"Email\", addDeposit: \"Ajouter un dépôt\", for: \"pour\", depositAmount: \"Montant du dépôt (F CFA)\",\n        salesCart: \"Panier de Vente\", items: \"Articles\", cartEmpty: \"Le panier est vide.\", summary: \"Résumé\",\n        discount: \"Remise\", applyVAT: \"Appliquer la TVA (18%)\", paymentType: \"Type de paiement\", subtotal: \"Sous-total\",\n        continueShopping: \"Poursuivre les achats\", validateSale: \"Valider la Vente\", paymentReceipt: \"REÇU DE PAIEMENT\",\n        receivedFrom: \"Reçu de :\", originalInvoice: \"Facture d'origine :\", amountPaid: \"Montant Payé:\", paymentMethod: \"Méthode de paiement:\",\n        remainingBalanceDebt: \"Solde Restant sur la Créance:\", close: \"Fermer\", share: \"Partager\", print: \"Imprimer\",\n        depositReceipt: \"REÇU D'ACOMPTE\", depositAmountLabel: \"Montant de l'acompte:\", newDepositBalance: \"Nouveau solde d'acompte:\",\n        invoice: \"FACTURE\", billedTo: \"Facturé à :\", payment: \"Paiement :\", qty: \"Qté\", pu: \"P.U.\",\n        amountBeforeTax: \"Montant HT:\", vat18: \"TVA (18%):\", thankYou: \"Merci pour votre achat !\",\n        makeAPayment: \"Faire un Paiement\", remainingBalance: \"Solde Restant:\", available: \"Disponible:\", savePayment: \"Enregistrer Paiement\",\n        selectProducts: \"Sélectionner des produits\", search: \"Rechercher...\", viewCart: \"Voir le Panier\",\n        manageStock: \"Gérer le stock\", addToCart: \"Ajouter au panier\", appeler: \"Appeler\", sms: \"SMS\",\n        salesComparison: \"Comparaison des Ventes (Hier / Aujourd'hui)\", yesterday: \"Hier\",\n    },\n    en: {\n        dashboard: \"Dashboard\", products: \"Products\", categories: \"Categories\", customers: \"Customers\", sales: \"Sales\",\n        debts: \"Debts\", refunds: \"Refunds\", settings: \"Settings\", newSale: \"New Sale\", searchPlaceholder: \"Search for an invoice, customer, product...\",\n        searchResults: \"Search Results\", invoices: \"Invoices\", salesToday: \"Today's Sales\", totalSales: \"Total Sales\",\n        lowStock: \"Low Stock\", currentStock: \"Current Stock\", threshold: \"Threshold\", recentSales: \"Recent Sales\", invoiceNo: \"Invoice #\",\n        total: \"Total\", date: \"Date\", addProduct: \"Add Product\", startSale: \"Start Sale\", productList: \"Product List\",\n        stockManagement: \"Stock Management\", photo: \"Photo\", name: \"Name\", category: \"Category\", stock: \"Stock\", price: \"Price\", actions: \"Actions\",\n        edit: \"Edit\", delete: \"Delete\", addCategory: \"Add Category\", parentCategory: \"Parent Category\", addCustomer: \"Add Customer\",\n        searchCustomer: \"Search for a customer...\", nickname: \"Nickname\", phone: \"Phone\", customerDeposit: \"Customer Deposit\",\n        loading: \"Loading...\", backToList: \"Back to list\", purchaseHistory: \"Purchase History\", noPurchases: \"No purchases recorded.\",\n        filter: \"Filter\", hide: \"Hide\", today: \"Today\", thisWeek: \"This week\", thisMonth: \"This month\", thisYear: \"This year\", all: \"All\",\n        from: \"From\", to: \"To\", totalDisplayed: \"Total displayed\", amountDue: \"Amount Due\", makePayment: \"Make Payment\", refundHistory: \"Refund History\",\n        amount: \"Amount\", method: \"Method\", invoiceRef: \"Invoice Ref.\", generalInfo: \"General Information\", companyName: \"Company Name\",\n        address: \"Address\", docCustomization: \"Document Customization\", salesInvoicePrefix: \"Sales Invoice Prefix\",\n        refundInvoicePrefix: \"Refund Invoice Prefix\", depositReceiptPrefix: \"Deposit Receipt Prefix\", invoiceFooterMessage: \"Invoice Footer Message\",\n        save: \"Save\", language: \"Language\", francais: \"French\", english: \"English\",\n        editProduct: \"Edit Product\", productName: \"Product Name\", productType: \"Product Type\", standardItem: \"Standard Item (Simple or with Variants)\",\n        pack: \"Pack\", quantity: \"Quantity\", reorderThreshold: \"Reorder Threshold\", salePrice: \"Sale Price\", basePrice: \"Base Price\",\n        productVariantsOptional: \"Product Variants (Optional)\", packSalePrice: \"Pack Sale Price\", packComposition: \"Pack Composition\",\n        mainCategory: \"Main Category\", select: \"Select...\", subCategory: \"Sub-category\", description: \"Description\",\n        cancel: \"Cancel\", update: \"Update\", add: \"Add\", variantName: \"Variant Name\", priceMod: \"Price Mod.\",\n        reorderThresh: \"Reorder Thresh.\", product: \"Product\", chooseProduct: \"Choose a product...\", variant: \"Variant\",\n        chooseVariant: \"Choose a variant...\", editCategory: \"Edit Category\", addCategoryTitle: \"Add Category\",\n        parentCategoryOptional: \"Parent Category (Optional)\", noneMain: \"None (Main)\", editCustomer: \"Edit Customer\",\n        addCustomerTitle: \"Add Customer\", fullName: \"Full Name\", nicknameOptional: \"Nickname (Optional)\", addressOptional: \"Address (Optional)\",\n        email: \"Email\", addDeposit: \"Add a deposit\", for: \"for\", depositAmount: \"Deposit Amount (F CFA)\",\n        salesCart: \"Sales Cart\", items: \"Items\", cartEmpty: \"The cart is empty.\", summary: \"Summary\",\n        discount: \"Discount\", applyVAT: \"Apply VAT (18%)\", paymentType: \"Payment Type\", subtotal: \"Subtotal\",\n        continueShopping: \"Continue Shopping\", validateSale: \"Validate Sale\", paymentReceipt: \"PAYMENT RECEIPT\",\n        receivedFrom: \"Received from:\", originalInvoice: \"Original Invoice:\", amountPaid: \"Amount Paid:\", paymentMethod: \"Payment Method:\",\n        remainingBalanceDebt: \"Remaining Balance on Debt:\", close: \"Close\", share: \"Share\", print: \"Print\",\n        depositReceipt: \"DEPOSIT RECEIPT\", depositAmountLabel: \"Deposit amount:\", newDepositBalance: \"New deposit balance:\",\n        invoice: \"INVOICE\", billedTo: \"Billed to:\", payment: \"Payment:\", qty: \"Qty\", pu: \"P.U.\",\n        amountBeforeTax: \"Amount before tax:\", vat18: \"VAT (18%):\", thankYou: \"Thank you for your purchase!\",\n        makeAPayment: \"Make a Payment\", remainingBalance: \"Remaining Balance:\", available: \"Available:\", savePayment: \"Save Payment\",\n        selectProducts: \"Select products\", search: \"Search...\", viewCart: \"View Cart\",\n        manageStock: \"Manage Stock\", addToCart: \"Add to Cart\", appeler: \"Call\", sms: \"SMS\",\n        salesComparison: \"Sales Comparison (Yesterday / Today)\", yesterday: \"Yesterday\",\n    }\n};\n\n\n// --- Firebase Configuration ---\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\n\n// --- Firebase Initialization ---\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n\n// --- Constants ---\nconst PAYMENT_TYPES = [\"Espèce\", \"Wave\", \"Orange Money\", \"Créance\", \"Acompte Client\"];\nconst ROLES = { ADMIN: 'admin', VENDEUR: 'vendeur' };\nconst SALE_STATUS = {\n    COMPLETED: 'Complété',\n    PARTIALLY_RETURNED: 'Partiellement Retourné',\n    RETURNED: 'Retourné',\n    CREDIT: 'Créance',\n};\nconst VAT_RATE = 0.18; // 18%\nconst PRODUCT_TYPES = { SIMPLE: 'simple', PACK: 'pack', VARIANT: 'variant' };\n\n// --- Utility Functions ---\nconst formatCurrency = (number, lang = 'fr') => {\n    const locale = lang === 'fr' ? 'fr-FR' : 'en-US';\n    const currencyDisplay = 'F CFA';\n    if (isNaN(Number(number))) return `0 ${currencyDisplay}`;\n    return Number(number).toLocaleString(locale, { minimumFractionDigits: 0, maximumFractionDigits: 0 }).replace(/,/g, ' ') + ` ${currencyDisplay}`;\n};\n\nconst formatDateTime = (isoString, lang = 'fr') => {\n    if (!isoString) return 'N/A';\n    const date = new Date(isoString);\n    const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hourCycle: 'h23' };\n    const locale = lang === 'fr' ? 'fr-FR' : 'en-US';\n    return new Intl.DateTimeFormat(locale, options).format(date);\n};\n\nconst formatDate = (isoString, lang = 'fr') => {\n    if (!isoString) return 'N/A';\n    const date = new Date(isoString);\n    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };\n    const locale = lang === 'fr' ? 'fr-FR' : 'en-US';\n    return new Intl.DateTimeFormat(locale, options).format(date);\n};\n\nconst toInputDate = (date) => {\n if (!date) return '';\n const d = new Date(date);\n const year = d.getFullYear();\n const month = (d.getMonth() + 1).toString().padStart(2, '0');\n const day = d.getDate().toString().padStart(2, '0');\n return `${year}-${month}-${day}`;\n};\n\nconst resizeImage = (file, maxWidth, maxHeight) => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = (event) => {\n        const img = new Image();\n        img.src = event.target.result;\n        img.onload = () => {\n            const canvas = document.createElement('canvas');\n            let { width, height } = img;\n            if (width > height) { if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; } }\n            else { if (height > maxHeight) { width *= maxHeight / height; height = maxHeight; } }\n            canvas.width = width;\n            canvas.height = height;\n            const ctx = canvas.getContext('2d');\n            ctx.drawImage(img, 0, 0, width, height);\n            resolve(canvas.toDataURL('image/jpeg', 0.8));\n        };\n        img.onerror = (error) => reject(error);\n    };\n    reader.onerror = (error) => reject(error);\n});\n\n// --- UI Components ---\nconst Modal = React.memo(({ children, onClose, size = 'md' }) => {\n    const sizeClass = { md: 'max-w-md', lg: 'max-w-2xl', xl: 'max-w-4xl', '5xl': 'max-w-5xl', '7xl': 'max-w-7xl' }[size];\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-start p-4 overflow-auto\">\n            <div className={`bg-white rounded-2xl shadow-2xl w-full ${sizeClass} m-4 mt-12`}>\n                <div className=\"flex justify-end p-2 no-print\"><button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\"><X size={24} /></button></div>\n                <div className=\"px-4 sm:px-8 pb-8\">{children}</div>\n            </div>\n        </div>\n    );\n});\n\nconst AlertModal = React.memo(({ message, onClose }) => (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4\">\n        <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-sm m-4 p-8 text-center\">\n            <p className=\"mb-6\">{message}</p>\n            <button onClick={onClose} className=\"px-6 py-2 rounded-lg text-white bg-blue-500 hover:bg-blue-600 font-semibold\">OK</button>\n        </div>\n    </div>\n));\n\nconst ConfirmModal = React.memo(({ message, onConfirm, onClose }) => (\n   <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4\">\n        <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-sm m-4 p-8 text-center\">\n            <AlertCircle className=\"mx-auto text-red-500 mb-4\" size={48} />\n            <p className=\"mb-6\">{message}</p>\n            <div className=\"flex justify-center space-x-4\">\n                <button onClick={onClose} className=\"px-6 py-2 rounded-lg text-gray-600 bg-gray-200 hover:bg-gray-300\">Annuler</button>\n                <button onClick={onConfirm} className=\"px-6 py-2 rounded-lg text-white bg-red-500 hover:bg-red-600 font-semibold\">Confirmer</button>\n            </div>\n        </div>\n    </div>\n));\n\nconst StatCard = React.memo(({ icon, title, value, color, valueColor = 'text-gray-800' }) => (\n    <div className={`bg-white p-6 rounded-2xl shadow-md flex items-center space-x-4 border-l-4 ${color}`}>\n        <div className=\"text-3xl\">{icon}</div>\n        <div><p className=\"text-sm text-gray-500 font-medium\">{title}</p><p className={`text-2xl font-bold ${valueColor}`}>{value}</p></div>\n    </div>\n));\n\n// --- Main Component: App ---\nexport default function App() {\n    const [user, setUser] = useState(null);\n    const [isAuthReady, setIsAuthReady] = useState(false);\n    const [language, setLanguage] = useState('fr');\n    const userRole = ROLES.ADMIN;\n    const userPseudo = 'Admin';\n    \n    const [currentView, setCurrentView] = useState('dashboard');\n    const [viewPayload, setViewPayload] = useState(null);\n    const [products, setProducts] = useState([]);\n    const [customers, setCustomers] = useState([]);\n    const [sales, setSales] = useState([]);\n    const [categories, setCategories] = useState([]);\n    const [payments, setPayments] = useState([]);\n    const [companyProfile, setCompanyProfile] = useState({\n        name: \"Ma boutique\",\n        address: \"Dakar - Sénégal\",\n        phone: \"+221\",\n        logo: null,\n        invoicePrefix: \"FAC-\",\n        refundPrefix: \"REM-\",\n        depositPrefix: \"DEP-\",\n        invoiceFooterMessage: \"Merci pour votre achat !\",\n        lastInvoiceNumber: 0,\n        language: 'fr',\n    });\n\n    const [cart, setCart] = useState([]);\n    const [modalState, setModalState] = useState({ isOpen: false, type: null, item: null, size: 'md' });\n\n    const [alertInfo, setAlertInfo] = useState({ show: false, message: '' });\n    const [confirmInfo, setConfirmInfo] = useState({ show: false, message: '', onConfirm: null });\n\n    const [isMenuCollapsed, setIsMenuCollapsed] = useState(false);\n    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n    const t = useCallback((key) => {\n        return translations[language][key] || key;\n    }, [language]);\n\n    const productsToReorder = useMemo(() => {\n        const toReorder = [];\n        products.forEach(p => {\n            if(p.type === PRODUCT_TYPES.VARIANT) {\n                p.variants?.forEach(v => {\n                    if(v.quantity <= (v.reorderThreshold || 0) && v.quantity > 0){\n                        toReorder.push({ id: `${p.id}-${v.id}`, name: `${p.name} - ${v.name}`, quantity: v.quantity, reorderThreshold: v.reorderThreshold || 0 });\n                    }\n                })\n            } else if (p.type === PRODUCT_TYPES.SIMPLE && p.quantity <= (p.reorderThreshold || 0) && p.quantity > 0) {\n                 toReorder.push(p);\n            }\n        });\n        return toReorder;\n    }, [products]);\n\n    const showAlert = useCallback((message) => setAlertInfo({ show: true, message }), []);\n    const showConfirm = useCallback((message, onConfirm) => setConfirmInfo({ show: true, message, onConfirm }), []);\n\n    const navigate = useCallback((view, payload = null) => {\n        setCurrentView(view);\n        setViewPayload(payload);\n        setIsMobileMenuOpen(false);\n    }, []);\n\n    const addToCart = useCallback((product, quantity, variant = null) => {\n        setCart(currentCart => {\n            const cartItemId = variant ? `${product.id}-${variant.id}` : product.id;\n            const existingItem = currentCart.find(item => item.cartId === cartItemId);\n            \n            if (existingItem) {\n                return currentCart.map(item => item.cartId === cartItemId ? { ...item, quantity: item.quantity + quantity } : item);\n            }\n\n            const newItem = {\n                ...product,\n                cartId: cartItemId,\n                name: variant ? `${product.name} - ${variant.name}` : product.name,\n                price: variant ? (product.basePrice || product.price) + (variant.priceModifier || 0) : product.price,\n                quantity,\n                variant: variant ? { id: variant.id, name: variant.name } : null\n            };\n            return [...currentCart, newItem];\n        });\n    }, []);\n    \n    // --- Authentication & Script Loading ---\n    useEffect(() => {\n        const unsubscribeAuth = onAuthStateChanged(auth, async (authUser) => {\n            if (authUser) { setUser(authUser); setIsAuthReady(true); } \n            else { try { if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); } else { await signInAnonymously(auth); } } \n            catch (error) { console.error(\"Anonymous auth error:\", error); setIsAuthReady(true); } }\n        });\n        const loadScript = (src) => new Promise((resolve, reject) => {\n            if (document.querySelector(`script[src=\"${src}\"]`)) { resolve(); return; }\n            const script = document.createElement('script'); script.src = src;\n            script.onload = () => resolve(); script.onerror = () => reject(new Error(`Script load error for ${src}`));\n            document.body.appendChild(script);\n        });\n        Promise.all([\n            loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"),\n            loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\")\n        ]).catch(error => console.error(\"Error loading scripts:\", error));\n        return () => unsubscribeAuth();\n    }, []);\n\n    // --- Firestore Data Subscription ---\n    useEffect(() => {\n        if (!isAuthReady) return;\n        const collectionsToSubscribe = [\n            { name: 'products', setter: setProducts },\n            { name: 'customers', setter: setCustomers },\n            { name: 'categories', setter: setCategories },\n            { name: 'payments', setter: setPayments },\n            { name: 'sales', setter: setSales }\n        ];\n        const unsubscribers = collectionsToSubscribe.map(({ name, setter }) => {\n            const path = `artifacts/${appId}/public/data/${name}`;\n            const q = query(collection(db, path));\n            return onSnapshot(q, (snapshot) => {\n                const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n                setter(items);\n            }, (err) => console.error(`Error reading ${name}:`, err));\n        });\n\n        const profileDocRef = doc(db, `artifacts/${appId}/public/data/companyProfile`, 'main');\n        const unsubProfile = onSnapshot(profileDocRef, (docSnap) => {\n            if (docSnap.exists()) { \n                const data = docSnap.data();\n                setCompanyProfile(prev => ({...prev, ...data}));\n                if (data.language) {\n                    setLanguage(data.language);\n                }\n            } \n            else { setDoc(profileDocRef, companyProfile); }\n        });\n        unsubscribers.push(unsubProfile);\n        return () => unsubscribers.forEach(unsub => unsub && unsub());\n    }, [isAuthReady, appId]);\n\n    const closeModal = useCallback(() => setModalState({ isOpen: false, type: null, item: null, size: 'md' }), []);\n    \n    // --- CRUD Functions ---\n    const handleAddItem = useCallback(async (collectionName, data, onSuccess) => {\n        if (!user) return; const path = `artifacts/${appId}/public/data/${collectionName}`;\n        try { const docRef = await addDoc(collection(db, path), data); if (onSuccess) onSuccess({ id: docRef.id, ...data }); closeModal(); } \n        catch (error) { console.error(\"Add error:\", error); showAlert(\"Add error: \" + error.message); }\n    }, [user, appId, closeModal, showAlert]);\n\n    const handleEditItem = useCallback(async (collectionName, id, data) => {\n        if (!user) return; const path = `artifacts/${appId}/public/data/${collectionName}`;\n        try { await updateDoc(doc(db, path, id), data); closeModal(); } \n        catch (error) { console.error(\"Edit error:\", error); showAlert(\"Edit error: \" + error.message); }\n    }, [user, appId, closeModal, showAlert]);\n\n    const handleSaveProfile = useCallback(async (profileData) => {\n        if (!user) return; const profileDocRef = doc(db, `artifacts/${appId}/public/data/companyProfile`, 'main');\n        try { \n            await setDoc(profileDocRef, profileData, { merge: true }); \n            if (profileData.language) {\n                setLanguage(profileData.language);\n            }\n            showAlert(\"Company profile updated!\"); \n        } \n        catch (error) { console.error(\"Profile update error:\", error); showAlert(\"Error: \" + error.message); }\n    }, [user, appId, showAlert]);\n\n    const handleDeleteItem = useCallback((collectionName, id) => {\n        showConfirm(\"Are you sure you want to delete this item?\", async () => {\n            if (!user) return;\n            try { const path = `artifacts/${appId}/public/data/${collectionName}`; await deleteDoc(doc(db, path, id)); } \n            catch (error) { console.error(\"Delete error:\", error); showAlert(\"Error: \" + error.message); }\n        });\n    }, [user, appId, showConfirm, showAlert]);\n    \n    const openModal = useCallback((type, item = null, size = 'md') => {\n        setModalState({ isOpen: true, type, item, size });\n    }, []);\n\n    const handleAddSale = useCallback(async (saleData) => {\n        if (!user) return;\n        const { customerId, paymentType, items, totalPrice, discountAmount, vatAmount } = saleData;\n        const customer = customers.find(c => c.id === customerId);\n        if (!customer) {\n            showAlert(\"Customer not found!\");\n            return;\n        }\n    \n        try {\n            const newSaleRef = doc(collection(db, `artifacts/${appId}/public/data/sales`));\n            const profileRef = doc(db, `artifacts/${appId}/public/data/companyProfile`, 'main');\n    \n            const newSaleData = await runTransaction(db, async (transaction) => {\n                // --- PHASE 1: READ ALL DOCUMENTS ---\n                const profileDoc = await transaction.get(profileRef);\n                if (!profileDoc.exists()) {\n                    throw \"Company profile not found.\";\n                }\n    \n                const productsToRead = new Map();\n                items.forEach(item => {\n                    productsToRead.set(item.id, doc(db, `artifacts/${appId}/public/data/products`, item.id));\n                });\n    \n                const mainProductDocs = await Promise.all(Array.from(productsToRead.values()).map(ref => transaction.get(ref)));\n    \n                const productsDataMap = new Map();\n                mainProductDocs.forEach(doc => {\n                    if (doc.exists()) {\n                        productsDataMap.set(doc.id, doc.data());\n                    }\n                });\n    \n                const packItemRefsToRead = new Map();\n                productsDataMap.forEach((productData) => {\n                    if (productData.type === PRODUCT_TYPES.PACK) {\n                        productData.packItems.forEach(packItem => {\n                            if (!productsDataMap.has(packItem.productId)) {\n                                packItemRefsToRead.set(packItem.productId, doc(db, `artifacts/${appId}/public/data/products`, packItem.productId));\n                            }\n                        });\n                    }\n                });\n    \n                if (packItemRefsToRead.size > 0) {\n                    const packItemDocs = await Promise.all(Array.from(packItemRefsToRead.values()).map(ref => transaction.get(ref)));\n                    packItemDocs.forEach(doc => {\n                        if (doc.exists()) {\n                            productsDataMap.set(doc.id, doc.data());\n                        }\n                    });\n                }\n    \n                // --- PHASE 2: VALIDATE STOCK ---\n                for (const item of items) {\n                    const productData = productsDataMap.get(item.id);\n                    if (!productData) throw `Product ${item.name} not found!`;\n    \n                    if (item.variant) {\n                        const variantIndex = productData.variants.findIndex(v => v.id === item.variant.id);\n                        if (variantIndex === -1 || productData.variants[variantIndex].quantity < item.quantity) {\n                            throw `Insufficient stock for variant ${item.name}`;\n                        }\n                    } else if (productData.type === PRODUCT_TYPES.PACK) {\n                        for (const packItem of productData.packItems) {\n                            const childProductData = productsDataMap.get(packItem.productId);\n                            if (!childProductData) throw `Child product ${packItem.name} not found.`;\n    \n                            if (packItem.variant && packItem.variant.id) {\n                                const variantIndex = childProductData.variants.findIndex(v => v.id === packItem.variant.id);\n                                if (variantIndex === -1 || childProductData.variants[variantIndex].quantity < packItem.quantity * item.quantity) {\n                                    throw `Insufficient stock for ${packItem.name} in the pack.`;\n                                }\n                            } else {\n                                if (childProductData.quantity < packItem.quantity * item.quantity) {\n                                    throw `Insufficient stock for ${childProductData.name} in the pack.`;\n                                }\n                            }\n                        }\n                    } else {\n                        if (productData.quantity < item.quantity) {\n                            throw `Insufficient stock for ${item.name}!`;\n                        }\n                    }\n                }\n    \n                // --- PHASE 3: EXECUTE WRITES ---\n                for (const item of items) {\n                    const productData = productsDataMap.get(item.id);\n                    const productRef = doc(db, `artifacts/${appId}/public/data/products`, item.id);\n    \n                    if (item.variant) {\n                        const newVariants = [...productData.variants];\n                        const variantIndex = newVariants.findIndex(v => v.id === item.variant.id);\n                        newVariants[variantIndex].quantity -= item.quantity;\n                        transaction.update(productRef, { variants: newVariants });\n                    } else if (productData.type === PRODUCT_TYPES.PACK) {\n                        for (const packItem of productData.packItems) {\n                            const childProductData = productsDataMap.get(packItem.productId);\n                            const childProductRef = doc(db, `artifacts/${appId}/public/data/products`, packItem.productId);\n                            if (packItem.variant && packItem.variant.id) {\n                                const newVariants = [...childProductData.variants];\n                                const variantIndex = newVariants.findIndex(v => v.id === packItem.variant.id);\n                                newVariants[variantIndex].quantity -= packItem.quantity * item.quantity;\n                                transaction.update(childProductRef, { variants: newVariants });\n                            } else {\n                                const newQuantity = childProductData.quantity - (packItem.quantity * item.quantity);\n                                transaction.update(childProductRef, { quantity: newQuantity });\n                            }\n                        }\n                    } else {\n                        const newQuantity = productData.quantity - item.quantity;\n                        transaction.update(productRef, { quantity: newQuantity });\n                    }\n                }\n    \n                if (paymentType === 'Acompte Client') {\n                    const customerBalance = customer.balance || 0;\n                    if (customerBalance < totalPrice) { throw \"Insufficient customer deposit.\"; }\n                    const customerRef = doc(db, `artifacts/${appId}/public/data/customers`, customerId);\n                    transaction.update(customerRef, { balance: customerBalance - totalPrice });\n                }\n    \n                const lastInvoiceNumber = profileDoc.data().lastInvoiceNumber || 0;\n                const newInvoiceNumber = lastInvoiceNumber + 1;\n                const invoiceId = `${companyProfile.invoicePrefix || 'FAC-'}${newInvoiceNumber.toString().padStart(5, '0')}`;\n                const status = paymentType === 'Créance' ? SALE_STATUS.CREDIT : SALE_STATUS.COMPLETED;\n    \n                const finalSaleData = {\n                    invoiceId, customerId, customerName: customer.name, paymentType,\n                    items: items.map(i => ({ productId: i.id, productName: i.name, quantity: i.quantity, unitPrice: i.price, subtotal: i.price * i.quantity, variant: i.variant })),\n                    totalPrice, discountAmount, vatAmount, status,\n                    paidAmount: status === SALE_STATUS.COMPLETED ? totalPrice : 0,\n                    saleDate: new Date().toISOString(), userId: user.uid, userPseudo\n                };\n    \n                transaction.set(newSaleRef, finalSaleData);\n                transaction.update(profileRef, { lastInvoiceNumber: newInvoiceNumber });\n    \n                return finalSaleData;\n            });\n    \n            setCart([]);\n            openModal('showInvoice', { ...newSaleData, id: newSaleRef.id, customer }, 'lg');\n    \n        } catch (error) {\n            console.error(\"Sale transaction error:\", error);\n            showAlert(\"Error: \" + error.toString());\n        }\n    }, [user, customers, products, appId, companyProfile.invoicePrefix, showAlert, openModal]);\n\n    const handleShowInvoice = useCallback((sale) => {\n        const customer = customers.find(c => c.id === sale.customerId);\n        if (!customer) { showAlert(\"Could not find the customer for this sale.\"); return; }\n        openModal('showInvoice', { ...sale, customer }, 'lg');\n    }, [customers, openModal, showAlert]);\n    \n    const handleMakePayment = useCallback(async (saleToPay, amountPaidStr, paymentType) => {\n        const amountPaid = Number(amountPaidStr);\n        if (!amountPaid || amountPaid <= 0) { showAlert(\"Invalid amount.\"); return; }\n    \n        const currentPaidAmount = saleToPay.paidAmount || 0;\n        const remainingBalance = saleToPay.totalPrice - currentPaidAmount;\n    \n        if (amountPaid > remainingBalance) {\n            showAlert(\"The amount paid cannot exceed the remaining balance.\");\n            return;\n        }\n    \n        let newPaidAmount = currentPaidAmount + amountPaid;\n        const isFullyPaid = newPaidAmount >= saleToPay.totalPrice;\n    \n        if (isFullyPaid) {\n            newPaidAmount = saleToPay.totalPrice;\n        }\n    \n        const newStatus = isFullyPaid ? SALE_STATUS.COMPLETED : SALE_STATUS.CREDIT;\n    \n        try {\n            const batch = writeBatch(db);\n            const saleRef = doc(db, `artifacts/${appId}/public/data/sales`, saleToPay.id);\n    \n            if (paymentType === 'Acompte Client') {\n                const customer = customers.find(c => c.id === saleToPay.customerId);\n                if (!customer || (customer.balance || 0) < amountPaid) {\n                    showAlert(\"Insufficient customer deposit.\");\n                    return;\n                }\n                const customerRef = doc(db, `artifacts/${appId}/public/data/customers`, saleToPay.customerId);\n                batch.update(customerRef, { balance: customer.balance - amountPaid });\n            }\n    \n            const paymentData = {\n                saleId: saleToPay.id,\n                invoiceId: saleToPay.invoiceId,\n                customerName: saleToPay.customerName,\n                amount: amountPaid,\n                paymentType,\n                paymentDate: new Date().toISOString()\n            };\n            batch.set(doc(collection(db, `artifacts/${appId}/public/data/payments`)), paymentData);\n    \n            batch.update(saleRef, { paidAmount: newPaidAmount, status: newStatus });\n    \n            await batch.commit();\n    \n            openModal('showPaymentReceipt', {\n                ...paymentData,\n                customer: customers.find(c => c.id === saleToPay.customerId),\n                remainingBalance: saleToPay.totalPrice - newPaidAmount,\n                companyProfile\n            }, 'lg');\n        } catch (error) {\n            console.error(\"Error during payment:\", error);\n            showAlert(\"Error during payment: \" + error.message);\n        }\n    }, [appId, customers, companyProfile, openModal, showAlert]);\n    \n    \n    const handleAddDeposit = useCallback(async (customerId, amount) => {\n        const customer = customers.find(c => c.id === customerId);\n        if(!customer || !amount || amount <= 0) { showAlert(\"Invalid information.\"); return; }\n        const newBalance = (customer.balance || 0) + Number(amount);\n        try {\n            const customerRef = doc(db, `artifacts/${appId}/public/data/customers`, customerId);\n            await updateDoc(customerRef, { balance: newBalance });\n            showAlert(\"Deposit saved!\");\n            closeModal();\n            openModal('showDepositReceipt', { customer: {...customer, balance: newBalance}, amount: Number(amount), companyProfile, depositDate: new Date().toISOString(), customerId }, 'lg');\n        } catch (error) { console.error(\"Error during deposit:\", error); showAlert(\"Error: \" + error.message); }\n    }, [appId, customers, closeModal, showAlert, openModal, companyProfile]);\n    \n    const openSaleModal = useCallback((customer = null) => {\n        openModal('productSelection', customer ? { preselectedCustomerId: customer.id } : null, '7xl');\n    }, [openModal]);\n\n    const navItems = [\n        { view: 'dashboard', label: t('dashboard'), icon: <BarChart2 />, activeViews: ['dashboard'] },\n        { view: 'products', label: t('products'), icon: <Package />, activeViews: ['products'] },\n        { view: 'categories', label: t('categories'), icon: <Tag />, activeViews: ['categories'] },\n        { view: 'customers', label: t('customers'), icon: <Users />, activeViews: ['customers', 'customer-details'] },\n        { view: 'sales', label: t('sales'), icon: <ShoppingCart />, activeViews: ['sales'] },\n        { view: 'debts', label: t('debts'), icon: <CreditCard />, activeViews: ['debts'] },\n        { view: 'refunds', label: t('refunds'), icon: <ListChecks />, activeViews: ['refunds'] },\n        { view: 'settings', label: t('settings'), icon: <Settings />, activeViews: ['settings'] }\n    ];\n\n    // --- View Rendering ---\n    const renderModalContent = () => {\n        if (!modalState.isOpen) return null;\n        const { type, item } = modalState;\n        switch (type) {\n            case 'productSelection': return <ProductSelectionModal products={products} onAddToCart={addToCart} openModal={openModal} onClose={closeModal} onProceedToCart={() => openModal('addSale', item, '7xl')} cart={cart} t={t} language={language} />;\n            case 'productDetails': return <ProductDetailModal product={item} onAddToCart={addToCart} onClose={closeModal} openModal={openModal} t={t} language={language} />;\n            case 'addProduct': case 'editProduct': return <ProductForm onSubmit={type === 'addProduct' ? (d, cb) => handleAddItem('products', d, cb) : (d) => handleEditItem('products', item.id, d)} initialData={item} categories={categories} products={products} onClose={closeModal} t={t} language={language} />;\n            case 'addCategory': case 'editCategory': return <CategoryForm onSubmit={type === 'addCategory' ? (d) => handleAddItem('categories', d) : (d) => handleEditItem('categories', item.id, d)} initialData={item} categories={categories} onClose={closeModal} t={t} />;\n            case 'addCustomer': return <CustomerForm onSubmit={(d, cb) => handleAddItem('customers', d, cb)} initialData={item} onClose={closeModal} onSuccess={item?.onSuccess} t={t} />;\n            case 'editCustomer': return <CustomerForm onSubmit={(d) => handleEditItem('customers', item.id, d)} initialData={item} onClose={closeModal} t={t} />\n            case 'addSale': return <SaleForm onSubmit={handleAddSale} customers={customers} onClose={closeModal} cart={cart} setCart={setCart} preselectedCustomerId={item?.preselectedCustomerId} openModal={openModal} showAlert={showAlert} t={t} language={language} />;\n            case 'makePayment': return <PaymentForm onSubmit={(amount, pType) => handleMakePayment(item, amount, pType)} sale={item} customers={customers} onClose={closeModal} t={t} language={language} />;\n            case 'addDeposit': return <DepositForm customer={item} onSubmit={(amount) => handleAddDeposit(item.id, amount)} onClose={closeModal} t={t} />;\n            case 'showInvoice': return <Invoice sale={item} products={products} companyProfile={companyProfile} onClose={closeModal} showAlert={showAlert} t={t} language={language} />;\n            case 'showPaymentReceipt': return <PaymentReceipt receiptData={item} onClose={closeModal} showAlert={showAlert} t={t} language={language} />;\n            case 'showDepositReceipt': return <DepositReceipt receiptData={item} onClose={closeModal} showAlert={showAlert} t={t} language={language} />;\n            default: return null;\n        }\n    };\n    \n    if (!isAuthReady) { return <div className=\"flex justify-center items-center h-screen bg-gray-100\">{t('loading')}</div>; }\n\n    return (\n        <>\n            <style>{`.invoice-container, .receipt-container { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; } @media print { body * { visibility: hidden; } .printable-area, .printable-area * { visibility: visible; } .printable-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; padding: 20px; font-size: 12px; } .no-print { display: none; } }`}</style>\n            <div className=\"flex h-screen bg-gray-100 font-sans\">\n                {/* Mobile Menu Overlay */}\n                {isMobileMenuOpen && <div className=\"fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden\" onClick={() => setIsMobileMenuOpen(false)}></div>}\n                \n                {/* Sidebar Navigation */}\n                <nav className={`fixed inset-y-0 left-0 bg-white shadow-lg flex flex-col z-30 transform transition-transform duration-300 ease-in-out md:relative md:translate-x-0 ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} ${isMenuCollapsed ? 'md:w-20' : 'md:w-64'}`}>\n                    <div className={`flex items-center border-b h-16 ${isMenuCollapsed ? 'justify-center' : 'justify-between'} px-4`}>\n                         <div className={`font-bold text-gray-800 text-2xl ${isMenuCollapsed ? 'hidden' : 'block'}`}>\n                            {companyProfile.logo ? <img src={companyProfile.logo} alt={companyProfile.name} className=\"max-h-10 max-w-full object-contain\" /> : companyProfile.name}\n                        </div>\n                        <button onClick={() => setIsMenuCollapsed(!isMenuCollapsed)} className=\"hidden md:block p-2 rounded-full hover:bg-gray-200\">\n                            <Menu size={24} />\n                        </button>\n                    </div>\n                    <ul className=\"flex-1 p-4 space-y-2\">\n                        {navItems.map(item => (\n                            <NavItem \n                                key={item.view}\n                                icon={item.icon} \n                                label={item.label} \n                                active={item.activeViews.includes(currentView)}\n                                onClick={() => navigate(item.view)} \n                                isCollapsed={isMenuCollapsed}\n                            />\n                        ))}\n                    </ul>\n                    <div className={`p-4 border-t text-xs text-gray-500 ${isMenuCollapsed ? 'hidden' : 'block'}`}>\n                        <p>User: {userPseudo}</p>\n                        <p className=\"font-bold capitalize\">Role: {userRole}</p>\n                    </div>\n                </nav>\n                \n                <div className=\"flex-1 flex flex-col\">\n                     {/* Header for Mobile and Main Content */}\n                    <header className=\"flex justify-between items-center bg-white shadow-md p-4 sticky top-0 z-10\">\n                        <div className=\"flex items-center gap-4\">\n                            <button onClick={() => setIsMobileMenuOpen(true)} className=\"md:hidden p-2\">\n                                <Menu size={24} />\n                            </button>\n                            <h2 className=\"text-xl sm:text-2xl font-bold text-gray-800\">{t(currentView)}</h2>\n                        </div>\n                        \n                        {currentView !== 'settings' && (\n                            <div className=\"flex items-center gap-2 sm:gap-4\">\n                                {cart.length > 0 && (\n                                    <button onClick={() => openModal('addSale', null, '7xl')} className=\"flex items-center bg-yellow-400 text-yellow-900 font-bold py-2 px-3 sm:px-4 rounded-lg shadow-md hover:bg-yellow-500 transition-colors\">\n                                        <ShoppingCart size={20} className=\"mr-0 sm:mr-2\" />\n                                        <span className=\"hidden sm:inline\">{t('viewCart')}</span>\n                                        <span className=\"ml-2 bg-white text-yellow-900 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\">{cart.length}</span>\n                                    </button>\n                                )}\n                                <button onClick={() => openSaleModal()} className=\"flex items-center bg-blue-500 text-white font-bold py-2 px-3 sm:px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors\">\n                                    <Plus size={20} className=\"mr-0 sm:mr-2\" /> <span className=\"hidden sm:inline\">{t('newSale')}</span>\n                                </button>\n                            </div>\n                        )}\n                    </header>\n                    <main className=\"flex-1 p-4 sm:p-8 overflow-y-auto\">\n                        {currentView === 'dashboard' && <DashboardView sales={sales} products={products} customers={customers} categories={categories} productsToReorder={productsToReorder} openSaleModal={openSaleModal} navigate={navigate} handleShowInvoice={handleShowInvoice} openModal={openModal} t={t} language={language} />}\n                        {currentView === 'products' && <ProductsView products={products} categories={categories} openModal={openModal} handleDelete={handleDeleteItem} setCart={setCart} openSaleModal={openSaleModal} productsToReorder={productsToReorder} t={t} language={language} />}\n                        {currentView === 'categories' && <CategoriesView categories={categories} openModal={openModal} handleDelete={handleDeleteItem} t={t} language={language} />}\n                        {currentView === 'customers' && <CustomersView customers={customers} openModal={openModal} handleDelete={handleDeleteItem} navigate={navigate} t={t} language={language} />}\n                        {currentView === 'customer-details' && <CustomerDetailsView customerId={viewPayload?.id} customers={customers} db={db} appId={appId} navigate={navigate} openSaleModal={openSaleModal} t={t} language={language} />}\n                        {currentView === 'sales' && <SalesView sales={sales} handleShowInvoice={handleShowInvoice} t={t} language={language} />}\n                        {currentView === 'debts' && <DebtsView sales={sales} openModal={openModal} t={t} language={language} />}\n                        {currentView === 'refunds' && <RefundsView payments={payments} t={t} language={language} />}\n                        {currentView === 'settings' && <SettingsView companyProfile={companyProfile} handleSaveProfile={handleSaveProfile} t={t} />}\n                    </main>\n                </div>\n\n                {modalState.isOpen && (<Modal onClose={closeModal} size={modalState.size}>{renderModalContent()}</Modal>)}\n                {alertInfo.show && <AlertModal message={alertInfo.message} onClose={() => setAlertInfo({ show: false, message: '' })} />}\n                {confirmInfo.show && <ConfirmModal message={confirmInfo.message} onConfirm={() => { confirmInfo.onConfirm(); setConfirmInfo({ ...confirmInfo, show: false }); }} onClose={() => setConfirmInfo({ ...confirmInfo, show: false })} />}\n            </div>\n        </>\n    );\n}\n\n// --- View and Form Components ---\nconst NavItem = React.memo(({ icon, label, active, onClick, isCollapsed }) => (\n    <li>\n        <a href=\"#\" onClick={onClick} className={`flex items-center p-3 rounded-lg transition-colors ${active ? 'bg-blue-500 text-white shadow-md' : 'text-gray-600 hover:bg-gray-200'} ${isCollapsed ? 'justify-center' : ''}`}>\n            {icon}\n            <span className={`ml-4 font-medium whitespace-nowrap overflow-hidden ${isCollapsed ? 'md:hidden' : 'block'}`}>{label}</span>\n        </a>\n    </li>\n));\n\n// --- VIEWS ---\nconst DashboardView = React.memo(({ sales, products, customers, categories, productsToReorder, openSaleModal, navigate, handleShowInvoice, openModal, t, language }) => {\n    const [searchTerm, setSearchTerm] = useState('');\n    const [searchResults, setSearchResults] = useState(null);\n\n    const handleSearch = useCallback((e) => {\n        const term = e.target.value.toLowerCase();\n        setSearchTerm(term);\n\n        if (term.length < 2) {\n            setSearchResults(null);\n            return;\n        }\n\n        const foundProducts = products.filter(p => p.name.toLowerCase().includes(term));\n        const foundCustomers = customers.filter(c => c.name.toLowerCase().includes(term));\n        const foundSales = sales.filter(s => (s.invoiceId && s.invoiceId.toLowerCase().includes(term)) || s.customerName.toLowerCase().includes(term));\n\n        setSearchResults({ products: foundProducts, customers: foundCustomers, sales: foundSales });\n    }, [products, customers, sales]);\n\n\n    const totalCredit = useMemo(() => sales.filter(s => s.status === SALE_STATUS.CREDIT).reduce((acc, s) => acc + (s.totalPrice - (s.paidAmount || 0)), 0), [sales]);\n    const totalSalesToday = useMemo(() => {\n        const today = new Date().toISOString().split('T')[0];\n        return sales.filter(s => s.saleDate && s.saleDate.startsWith(today)).reduce((acc, sale) => acc + sale.totalPrice, 0);\n    }, [sales]);\n    const displayedSales = useMemo(() => sales.sort((a,b) => new Date(b.saleDate) - new Date(a.saleDate)).slice(0, 5), [sales]);\n\n    return (\n        <div>\n            <div className=\"mb-8 relative\">\n                <input \n                    type=\"text\" \n                    placeholder={t('searchPlaceholder')} \n                    value={searchTerm} \n                    onChange={handleSearch} \n                    className=\"w-full pl-12 pr-4 py-3 border rounded-full text-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n                <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" size={24}/>\n            </div>\n            \n            {searchResults && (\n                <div className=\"bg-white p-6 rounded-2xl shadow-md mb-8\">\n                    <h3 className=\"text-xl font-bold text-gray-700 mb-4\">{t('searchResults')}</h3>\n                    {searchResults.products.length === 0 && searchResults.customers.length === 0 && searchResults.sales.length === 0 && <p>No results found.</p>}\n                    \n                    {searchResults.products.length > 0 && <div className=\"mb-4\">\n                        <h4 className=\"font-semibold mb-2 text-blue-600\">{t('products')}</h4>\n                        <ul className=\"space-y-1\">{searchResults.products.map(p => <li key={p.id} onClick={() => openModal('productDetails', p, 'md')} className=\"cursor-pointer hover:bg-gray-100 p-2 rounded-md\">{p.name}</li>)}</ul>\n                    </div>}\n                    \n                    {searchResults.customers.length > 0 && <div className=\"mb-4\">\n                        <h4 className=\"font-semibold mb-2 text-green-600\">{t('customers')}</h4>\n                        <ul className=\"space-y-1\">{searchResults.customers.map(c => <li key={c.id} onClick={() => navigate('customer-details', { id: c.id })} className=\"cursor-pointer hover:bg-gray-100 p-2 rounded-md\">{c.name}</li>)}</ul>\n                    </div>}\n\n                    {searchResults.sales.length > 0 && <div>\n                        <h4 className=\"font-semibold mb-2 text-purple-600\">{t('invoices')}</h4>\n                        <ul className=\"space-y-1\">{searchResults.sales.map(s => <li key={s.id} onClick={() => handleShowInvoice(s)} className=\"cursor-pointer hover:bg-gray-100 p-2 rounded-md\">{s.invoiceId} for {s.customerName} - {formatCurrency(s.totalPrice, language)}</li>)}</ul>\n                    </div>}\n                </div>\n            )}\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                <StatCard icon={<Package />} title={t('products')} value={products.length} color=\"border-blue-500\" />\n                <StatCard icon={<DollarSign />} title={t('salesToday')} value={formatCurrency(totalSalesToday, language)} color=\"border-yellow-500\" />\n                <StatCard icon={<CreditCard />} title={t('debts')} value={formatCurrency(totalCredit, language)} color=\"border-red-500\" valueColor=\"text-red-500\"/>\n                <StatCard icon={<Users />} title={t('customers')} value={customers.length} color=\"border-green-500\" />\n                <StatCard icon={<Tag />} title={t('categories')} value={categories.length} color=\"border-indigo-500\" />\n                <StatCard icon={<ShoppingCart />} title={t('totalSales')} value={sales.length} color=\"border-purple-500\" />\n            </div>\n            {productsToReorder.length > 0 && (\n                <div className=\"mt-8 bg-white p-6 rounded-2xl shadow-md\">\n                    <h3 className=\"text-xl font-bold text-orange-600 mb-4 flex items-center\"><AlertCircle className=\"mr-2\"/>{t('lowStock')}</h3>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-left\">\n                            <thead><tr className=\"border-b\"><th className=\"p-3\">{t('products')}</th><th className=\"p-3\">{t('currentStock')}</th><th className=\"p-3\">{t('threshold')}</th></tr></thead>\n                            <tbody>{productsToReorder.map(p => (<tr key={p.id} className=\"border-b hover:bg-gray-50\"><td className=\"p-3\">{p.name}</td><td className=\"p-3 font-bold text-red-500\">{p.quantity}</td><td className=\"p-3 text-sm text-gray-500\">{p.reorderThreshold || 0}</td></tr>))}</tbody>\n                        </table>\n                    </div>\n                </div>\n            )}\n            <div className=\"mt-8 bg-white p-6 rounded-2xl shadow-md\">\n                <h3 className=\"text-xl font-bold text-gray-700 mb-4\">{t('recentSales')}</h3>\n                 <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-left\">\n                        <thead><tr className=\"border-b\"><th className=\"p-3\">{t('invoiceNo')}</th><th className=\"p-3\">{t('products')}</th><th className=\"p-3\">{t('customers')}</th><th className=\"p-3\">{t('total')}</th><th className=\"p-3\">{t('date')}</th></tr></thead>\n                        <tbody>\n                            {displayedSales.map(sale => (\n                                <tr key={sale.id} className=\"border-b hover:bg-gray-50\">\n                                    <td className=\"p-3 font-semibold\">{sale.invoiceId}</td>\n                                    <td className=\"p-3 text-sm\">{sale.items.map(i => i.productName).join(', ')}</td>\n                                    <td className=\"p-3\">{sale.customerName}</td>\n                                    <td className=\"p-3 font-medium text-green-600\">{formatCurrency(sale.totalPrice, language)}</td>\n                                    <td className=\"p-3 text-sm text-gray-500\">{formatDate(sale.saleDate, language)}</td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n    );\n});\n\nconst StockManagementView = React.memo(({ productsToReorder, openModal }) => {\n    return (\n        <div>\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Products to Restock</h3>\n             <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-left\">\n                    <thead>\n                        <tr className=\"border-b-2\">\n                            <th className=\"p-4\">Product / Variant</th>\n                            <th className=\"p-4\">Current Stock</th>\n                            <th className=\"p-4\">Reorder Threshold</th>\n                            <th className=\"p-4 text-right\">Action</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {productsToReorder.length > 0 ? productsToReorder.map(item => (\n                            <tr key={item.id} className=\"border-b hover:bg-gray-50\">\n                                <td className=\"p-4\">{item.name}</td>\n                                <td className=\"p-4 font-bold text-red-500\">{item.quantity}</td>\n                                <td className=\"p-4\">{item.reorderThreshold}</td>\n                                <td className=\"p-4 text-right\">\n                                    <button onClick={() => openModal('addToStock', item, 'md')} className=\"p-2 bg-green-100 text-green-700 rounded-full hover:bg-green-200\">\n                                        <Plus size={16} />\n                                    </button>\n                                </td>\n                            </tr>\n                        )) : (\n                           <tr><td colSpan=\"4\" className=\"text-center p-8 text-gray-500\">No products with low stock.</td></tr>\n                        )}\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    )\n});\n\nconst ProductsView = React.memo(({ products, categories, openModal, handleDelete, setCart, openSaleModal, productsToReorder, t, language }) => {\n    const [viewMode, setViewMode] = useState('list');\n    const [selectedProducts, setSelectedProducts] = useState(new Set());\n    const [activeTab, setActiveTab] = useState('list');\n\n    const toggleProductSelection = useCallback((product) => {\n        setSelectedProducts(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(product.id)) {\n                newSet.delete(product.id);\n            } else {\n                newSet.add(product.id);\n            }\n            return newSet;\n        });\n    }, []);\n\n    const handleStartSale = useCallback(() => {\n        const cartItems = products.filter(p => selectedProducts.has(p.id)).map(p => ({\n            ...p,\n            cartId: p.id,\n            quantity: 1\n        }));\n        setCart(cartItems);\n        setSelectedProducts(new Set());\n        openSaleModal();\n    }, [products, selectedProducts, setCart, openSaleModal]);\n    \n    const categoryMap = useMemo(() => categories.reduce((acc, cat) => ({...acc, [cat.id]: cat }), {}), [categories]);\n\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n            {activeTab === 'list' && (\n                <div className=\"flex justify-end items-center mb-6 flex-wrap gap-4\">\n                    <div className=\"flex items-center gap-2\">\n                        <button onClick={() => setViewMode('list')} className={`p-2 rounded-lg ${viewMode === 'list' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-600'}`}><List/></button>\n                        <button onClick={() => setViewMode('grid')} className={`p-2 rounded-lg ${viewMode === 'grid' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-600'}`}><LayoutGrid/></button>\n                    </div>\n                    {selectedProducts.size > 0 && (\n                        <button onClick={handleStartSale} className=\"flex items-center bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-600 transition-colors\">\n                            <ShoppingCart size={20} className=\"mr-2\" /> {t('startSale')} ({selectedProducts.size})\n                        </button>\n                    )}\n                    <button onClick={() => openModal('addProduct')} className=\"flex items-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors\"><Plus size={20} className=\"mr-2\" /> {t('addProduct')}</button>\n                </div>\n            )}\n\n            <div className=\"flex border-b mb-6\">\n                <button onClick={() => setActiveTab('list')} className={`px-4 py-2 text-sm font-semibold flex items-center gap-2 ${activeTab === 'list' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'}`}><List size={16}/> {t('productList')}</button>\n                <button onClick={() => setActiveTab('stock')} className={`px-4 py-2 text-sm font-semibold flex items-center gap-2 ${activeTab === 'stock' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'}`}><Archive size={16}/> {t('stockManagement')}</button>\n            </div>\n\n            <div className=\"overflow-x-auto\">\n                {activeTab === 'list' ? (\n                    viewMode === 'list' ? (\n                         <table className=\"w-full text-left\">\n                            <thead className=\"whitespace-nowrap\"><tr className=\"border-b-2 border-gray-200\">\n                                <th className=\"p-4 w-12\"><PlusCircle size={20} className=\"text-gray-400\"/></th>\n                                <th className=\"p-4\">{t('photo')}</th><th className=\"p-4\">{t('name')}</th><th className=\"p-4\">{t('category')}</th>\n                                <th className=\"p-4\">{t('stock')}</th><th className=\"p-4\">{t('price')}</th><th className=\"p-4 text-right\">{t('actions')}</th>\n                            </tr></thead>\n                            <tbody>{products.map(item => (\n                                <tr key={item.id} className=\"border-b hover:bg-gray-50\">\n                                    <td className=\"p-4\"><input type=\"checkbox\" disabled={item.type === PRODUCT_TYPES.VARIANT} checked={selectedProducts.has(item.id)} onChange={() => toggleProductSelection(item)} className=\"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:bg-gray-200\"/></td>\n                                    <td className=\"p-4\"><img src={item.photoURL || 'https://placehold.co/60x60/e2e8f0/4a5568?text=N/A'} alt={item.name} className=\"w-12 h-12 rounded-lg object-cover\" /></td>\n                                    <td className=\"p-4 font-semibold\">{item.name}</td>\n                                    <td className=\"p-4 text-sm\">{categoryMap[item.categoryId]?.name || 'N/A'}</td>\n                                    <td className=\"p-4\"><span className={item.type !== PRODUCT_TYPES.VARIANT && item.quantity <= (item.reorderThreshold || 0) ? 'font-bold text-red-500' : ''}>{item.type === PRODUCT_TYPES.VARIANT ? 'Variants' : item.quantity}</span></td>\n                                    <td className=\"p-4\">{formatCurrency(item.price || item.basePrice, language)}</td>\n                                    <td className=\"p-4 text-right whitespace-nowrap\">\n                                        <button onClick={() => openModal('editProduct', item)} className=\"text-blue-500 hover:text-blue-700 mr-4\"><Edit size={20} /></button>\n                                        <button onClick={() => handleDelete('products', item.id)} className=\"text-red-500 hover:text-red-700\"><Trash2 size={20} /></button>\n                                    </td>\n                                </tr>\n                            ))}</tbody>\n                        </table>\n                    ) : (\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6\">\n                            {products.map(product => (\n                                <div key={product.id} className={`bg-white rounded-2xl shadow-md p-4 flex flex-col items-center text-center relative ${product.type === PRODUCT_TYPES.PACK || product.type === PRODUCT_TYPES.SIMPLE ? 'cursor-pointer' : 'opacity-70'}`} onClick={() => (product.type === PRODUCT_TYPES.PACK || product.type === PRODUCT_TYPES.SIMPLE) && toggleProductSelection(product)}>\n                                    <img src={product.photoURL || 'https://placehold.co/150x150/e2e8f0/4a5568?text=N/A'} alt={product.name} className=\"w-full h-32 object-cover rounded-lg mb-4\"/>\n                                    <h4 className=\"font-semibold text-gray-800 flex-grow\">{product.name}</h4>\n                                    <p className=\"text-blue-600 font-bold\">{formatCurrency(product.price || product.basePrice, language)}</p>\n                                    {(product.type === PRODUCT_TYPES.PACK || product.type === PRODUCT_TYPES.SIMPLE) && <input type=\"checkbox\" checked={selectedProducts.has(product.id)} readOnly className=\"absolute top-2 right-2 h-6 w-6 rounded-md border-gray-400 text-blue-600 focus:ring-blue-500\"/>}\n                                </div>\n                            ))}\n                        </div>\n                    )\n                ) : (\n                   <StockManagementView productsToReorder={productsToReorder} openModal={openModal} />\n                )}\n            </div>\n        </div>\n    );\n});\n\nconst CategoriesView = React.memo(({ categories, openModal, handleDelete, t }) => {\n    const categoryMap = useMemo(() => categories.reduce((acc, cat) => ({...acc, [cat.id]: cat.name}), {}), [categories]);\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n            <div className=\"flex justify-between items-center mb-6\"><h2 className=\"text-3xl font-bold text-gray-800\">{t('categories')}</h2>\n                <button onClick={() => openModal('addCategory')} className=\"flex items-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600\"><Plus size={20} className=\"mr-2\" /> {t('addCategory')}</button>\n            </div>\n            <div className=\"overflow-x-auto\"><table className=\"w-full text-left\">\n                <thead><tr className=\"border-b-2\">\n                    <th className=\"p-4\">{t('name')}</th><th className=\"p-4\">{t('parentCategory')}</th><th className=\"p-4 text-right\">{t('actions')}</th>\n                </tr></thead>\n                <tbody>{categories.map(item => (\n                    <tr key={item.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-4\">{item.name}</td>\n                        <td className=\"p-4\">{item.parentId ? categoryMap[item.parentId] : \"N/A (Main)\"}</td>\n                        <td className=\"p-4 text-right\">\n                            <button onClick={() => openModal('editCategory', item)} className=\"text-blue-500 hover:text-blue-700 mr-4\"><Edit size={20} /></button>\n                            <button onClick={() => handleDelete('categories', item.id)} className=\"text-red-500 hover:text-red-700\"><Trash2 size={20} /></button>\n                        </td>\n                    </tr>\n                ))}</tbody>\n            </table></div>\n        </div>\n    );\n});\n\nconst CustomersView = React.memo(({ customers, openModal, handleDelete, navigate, t, language }) => {\n    const [searchTerm, setSearchTerm] = useState('');\n    const filteredCustomers = useMemo(() => customers.filter(c => c.name.toLowerCase().includes(searchTerm.toLowerCase())), [customers, searchTerm]);\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n            <div className=\"flex justify-between items-center mb-6\"><h2 className=\"text-3xl font-bold text-gray-800\">{t('customers')}</h2>\n                <button onClick={() => openModal('addCustomer')} className=\"flex items-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600\"><Plus size={20} className=\"mr-2\" /> {t('addCustomer')}</button>\n            </div>\n            <div className=\"mb-4\"><input type=\"text\" placeholder={t('searchCustomer')} value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className=\"w-full px-4 py-2 border rounded-lg\" /></div>\n            <div className=\"overflow-x-auto\"><table className=\"w-full text-left\">\n                <thead><tr className=\"border-b-2\"><th className=\"p-4\">{t('name')}</th><th className=\"p-4 hidden sm:table-cell\">{t('nickname')}</th><th className=\"p-4\">{t('phone')}</th><th className=\"p-4 hidden md:table-cell\">{t('customerDeposit')}</th><th className=\"p-4 text-right\">{t('actions')}</th></tr></thead>\n                <tbody>{filteredCustomers.map(item => (\n                    <tr key={item.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-4\"><a href=\"#\" onClick={(e) => { e.preventDefault(); navigate('customer-details', { id: item.id }); }} className=\"text-blue-600 hover:underline\">{item.name}</a></td>\n                        <td className=\"p-4 hidden sm:table-cell\">{item.nickname}</td>\n                        <td className=\"p-4\">{item.phone}</td>\n                        <td className=\"p-4 hidden md:table-cell\">{formatCurrency(item.balance || 0, language)}</td>\n                        <td className=\"p-4 text-right\">\n                            <button onClick={() => openModal('addDeposit', item)} title=\"Add deposit\" className=\"text-green-500 hover:text-green-700 mr-4\"><DollarSign size={20} /></button>\n                            <button onClick={() => openModal('editCustomer', item)} className=\"text-blue-500 hover:text-blue-700 mr-4\"><Edit size={20} /></button>\n                            <button onClick={() => handleDelete('customers', item.id)} className=\"text-red-500 hover:text-red-700\"><Trash2 size={20} /></button>\n                        </td>\n                    </tr>\n                ))}</tbody>\n            </table></div>\n        </div>\n    );\n});\n\nconst CustomerDetailsView = React.memo(({ customerId, customers, db, appId, navigate, openSaleModal, t, language }) => {\n    const [customerSales, setCustomerSales] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const customer = useMemo(() => customers.find(c => c.id === customerId), [customers, customerId]);\n\n    useEffect(() => {\n        if (!customerId) return;\n        setLoading(true);\n        const salesRef = collection(db, `artifacts/${appId}/public/data/sales`);\n        const q = query(salesRef, where(\"customerId\", \"==\", customerId));\n        const unsubscribe = onSnapshot(q, (snapshot) => {\n            const salesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n            salesData.sort((a, b) => new Date(b.saleDate) - new Date(a.saleDate));\n            setCustomerSales(salesData);\n            setLoading(false);\n        }, (err) => {\n            console.error(\"Error reading history:\", err);\n            setLoading(false);\n        });\n        return () => unsubscribe();\n    }, [customerId, db, appId]);\n    \n    if (!customer) return <div>Customer not found. <button className=\"text-blue-500 underline\" onClick={() => navigate('customers')}>{t('backToList')}</button></div>;\n\n    const sanitizedPhone = customer.phone ? customer.phone.replace(/[\\s+()-]/g, '') : '';\n    \n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n            <div className=\"mb-4\">\n                <button onClick={() => navigate('customers')} className=\"flex items-center text-blue-600 hover:underline mb-4\"><ArrowLeft size={18} className=\"mr-2\" /> {t('backToList')}</button>\n                <h2 className=\"text-3xl font-bold text-gray-800\">{customer.name} {customer.nickname && `(${customer.nickname})`}</h2>\n                <p className=\"text-gray-500\">{customer.phone}</p>\n                <p className=\"text-gray-500\">{customer.address}</p>\n            </div>\n\n            {customer.phone && (\n                <div className=\"flex flex-wrap gap-3 mb-6 border-t pt-6 mt-4\">\n                    <a href={`tel:${customer.phone}`} className=\"flex items-center gap-2 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600 transition-colors text-sm\">\n                        <Phone size={16} /> {t('appeler')}\n                    </a>\n                    <a href={`sms:${customer.phone}`} className=\"flex items-center gap-2 bg-cyan-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-cyan-600 transition-colors text-sm\">\n                        <MessageSquare size={16} /> {t('sms')}\n                    </a>\n                    <a href={`https://wa.me/${sanitizedPhone}`} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center gap-2 bg-green-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-600 transition-colors text-sm\">\n                         <MessageSquare size={16} /> WhatsApp\n                    </a>\n                </div>\n            )}\n\n            <div className=\"p-4 bg-green-50 border border-green-200 rounded-lg mb-6\">\n                <p className=\"text-lg font-bold text-green-700\">Acompte disponible: {formatCurrency(customer.balance || 0, language)}</p>\n            </div>\n            <h3 className=\"text-xl font-bold text-gray-700 mb-4\">{t('purchaseHistory')}</h3>\n            <div className=\"overflow-x-auto\">{loading ? <p>{t('loading')}...</p> : <table className=\"w-full text-left\">\n                <thead><tr className=\"border-b\"><th className=\"p-3\">{t('invoiceNo')}</th><th className=\"p-3\">{t('date')}</th><th className=\"p-3 hidden sm:table-cell\">{t('products')}</th><th className=\"p-3 text-right\">{t('total')}</th><th className=\"p-3 text-center\">Status</th></tr></thead>\n                <tbody>{customerSales.length > 0 ? customerSales.map(sale => (\n                    <tr key={sale.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3 font-semibold\">{sale.invoiceId}</td>\n                        <td className=\"p-3\">{formatDateTime(sale.saleDate, language)}</td>\n                        <td className=\"p-3 text-sm hidden sm:table-cell\">{sale.items.map(i => `${i.productName} (x${i.quantity})`).join(', ')}</td>\n                        <td className=\"p-3 text-right\">{formatCurrency(sale.totalPrice, language)}</td>\n                        <td className=\"p-3 text-center\"><StatusBadge status={sale.status} /></td>\n                    </tr>\n                )) : <tr><td colSpan=\"5\" className=\"text-center p-8 text-gray-500\">{t('noPurchases')}</td></tr>}</tbody>\n            </table>}</div>\n        </div>\n    );\n});\n\nconst SalesView = React.memo(({ sales, handleShowInvoice, t, language }) => {\n    const [activeFilter, setActiveFilter] = useState('day');\n    const [customStartDate, setCustomStartDate] = useState(toInputDate(new Date()));\n    const [customEndDate, setCustomEndDate] = useState(toInputDate(new Date()));\n    const [showFilters, setShowFilters] = useState(false);\n\n    const filteredSales = useMemo(() => {\n        if (!sales) return []; let start, end; const now = new Date();\n        switch (activeFilter) {\n            case 'day': start = new Date(new Date().setHours(0,0,0,0)); end = new Date(new Date().setHours(23,59,59,999)); break;\n            case 'week': const first = now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1); start = new Date(new Date().setDate(first)); start.setHours(0,0,0,0); end = new Date(new Date(start).setDate(start.getDate() + 6)); end.setHours(23,59,59,999); break;\n            case 'month': start = new Date(now.getFullYear(), now.getMonth(), 1); end = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59, 999); break;\n            case 'year': start = new Date(now.getFullYear(), 0, 1); end = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999); break;\n            case 'custom': if(customStartDate && customEndDate) { start = new Date(customStartDate); start.setHours(0,0,0,0); end = new Date(customEndDate); end.setHours(23,59,59,999); } break;\n            default: return [...sales].sort((a,b) => new Date(b.saleDate) - new Date(a.saleDate));\n        }\n        if(!start || !end) return [...sales].sort((a,b) => new Date(b.saleDate) - new Date(a.saleDate));\n        return sales.filter(s => { const d = new Date(s.saleDate); return d >= start && d <= end; }).sort((a,b) => new Date(b.saleDate) - new Date(a.saleDate));\n    }, [sales, activeFilter, customStartDate, customEndDate]);\n\n    const subtotal = useMemo(() => filteredSales.reduce((acc, sale) => acc + sale.totalPrice, 0), [filteredSales]);\n\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n            <div className=\"flex justify-end items-center mb-6\">\n                <button onClick={() => setShowFilters(!showFilters)} className=\"flex items-center text-sm font-semibold text-blue-600 hover:text-blue-800\"><Filter size={16} className=\"mr-1\" /> {showFilters ? t('hide') : t('filter')}</button>\n            </div>\n            {showFilters && (<div className=\"bg-gray-50 p-6 rounded-2xl shadow-inner mb-6 border\">\n                <div className=\"flex flex-wrap items-end gap-4\">\n                    <div className=\"flex flex-wrap gap-2\">\n                        <button onClick={() => setActiveFilter('day')} className={`px-4 py-2 rounded-lg text-sm ${activeFilter==='day'?'bg-blue-500 text-white':'bg-gray-200'}`}>{t('today')}</button>\n                        <button onClick={() => setActiveFilter('week')} className={`px-4 py-2 rounded-lg text-sm ${activeFilter==='week'?'bg-blue-500 text-white':'bg-gray-200'}`}>{t('thisWeek')}</button>\n                        <button onClick={() => setActiveFilter('month')} className={`px-4 py-2 rounded-lg text-sm ${activeFilter==='month'?'bg-blue-500 text-white':'bg-gray-200'}`}>{t('thisMonth')}</button>\n                        <button onClick={() => setActiveFilter('year')} className={`px-4 py-2 rounded-lg text-sm ${activeFilter==='year'?'bg-blue-500 text-white':'bg-gray-200'}`}>{t('thisYear')}</button>\n                        <button onClick={() => setActiveFilter('all')} className={`px-4 py-2 rounded-lg text-sm ${activeFilter==='all'?'bg-blue-500 text-white':'bg-gray-200'}`}>{t('all')}</button>\n                    </div>\n                    <div className=\"flex items-end gap-2 border-l-2 pl-4\">\n                        <div><label className=\"text-sm\">{t('from')}</label><input type=\"date\" value={customStartDate} onChange={e => setCustomStartDate(e.target.value)} className=\"w-full px-3 py-1.5 border rounded-lg text-sm\"/></div>\n                        <div><label className=\"text-sm\">{t('to')}</label><input type=\"date\" value={customEndDate} onChange={e => setCustomEndDate(e.target.value)} className=\"w-full px-3 py-1.5 border rounded-lg text-sm\"/></div>\n                        <button onClick={() => setActiveFilter('custom')} className={`px-4 py-2 rounded-lg text-sm ${activeFilter==='custom'?'bg-blue-500 text-white':'bg-blue-200'}`}>{t('filter')}</button>\n                    </div>\n                </div>\n            </div>)}\n            {filteredSales.length > 0 && <p className=\"mb-4 text-xl font-bold text-center bg-blue-500 text-white p-4 rounded-lg\">{t('totalDisplayed')}: {formatCurrency(subtotal, language)}</p>}\n            <div className=\"overflow-x-auto\"><table className=\"w-full text-left\">\n                <thead><tr className=\"border-b\"><th className=\"p-3\">{t('invoiceNo')}</th><th className=\"p-3 hidden sm:table-cell\">{t('products')}</th><th className=\"p-3\">{t('customers')}</th><th className=\"p-3\">{t('total')}</th><th className=\"p-3 hidden md:table-cell\">{t('date')}</th><th className=\"p-3\">Status</th><th className=\"p-3 text-right\">{t('actions')}</th></tr></thead>\n                <tbody>{filteredSales.map(sale => (\n                    <tr key={sale.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3 font-semibold\">{sale.invoiceId}</td>\n                        <td className=\"p-3 text-sm hidden sm:table-cell\">{sale.items.map(i => i.productName).join(', ')}</td>\n                        <td className=\"p-3\">{sale.customerName}</td><td className=\"p-3\">{formatCurrency(sale.totalPrice, language)}</td>\n                        <td className=\"p-3 hidden md:table-cell\">{formatDateTime(sale.saleDate, language)}</td>\n                        <td className=\"p-3\"><StatusBadge status={sale.status} /></td>\n                        <td className=\"p-3 text-right\"><button onClick={() => handleShowInvoice(sale)}><Printer size={20} /></button></td>\n                    </tr>\n                ))}</tbody>\n            </table></div>\n        </div>\n    );\n});\n\nconst DebtsView = React.memo(({ sales, openModal, t, language }) => {\n    const debtSales = useMemo(() => sales.filter(s => s.status === SALE_STATUS.CREDIT), [sales]);\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n             <div className=\"overflow-x-auto\"><table className=\"w-full text-left\">\n                <thead><tr className=\"border-b\">\n                    <th className=\"p-3\">{t('invoiceNo')}</th><th className=\"p-3\">{t('customers')}</th><th className=\"p-3\">{t('amountDue')}</th><th className=\"p-3 hidden md:table-cell\">{t('date')}</th><th className=\"p-3 text-right\">{t('actions')}</th>\n                </tr></thead>\n                <tbody>{debtSales.map(sale => (\n                    <tr key={sale.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3 font-semibold\">{sale.invoiceId}</td>\n                        <td className=\"p-3\">{sale.customerName}</td>\n                        <td className=\"p-3 text-red-600 font-semibold\">{formatCurrency(sale.totalPrice - (sale.paidAmount || 0), language)}</td>\n                        <td className=\"p-3 hidden md:table-cell\">{formatDateTime(sale.saleDate, language)}</td>\n                        <td className=\"p-3 text-right\"><button onClick={() => openModal('makePayment', sale)} className=\"text-green-500\"><CheckCircle size={20} /></button></td>\n                    </tr>\n                ))}</tbody>\n             </table></div>\n        </div>\n    );\n});\n\nconst RefundsView = React.memo(({ payments, t, language }) => {\n    const sortedPayments = useMemo(() => [...payments].sort((a,b) => new Date(b.paymentDate) - new Date(a.paymentDate)), [payments]);\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md\">\n             <div className=\"overflow-x-auto\"><table className=\"w-full text-left\">\n                <thead><tr className=\"border-b\"><th className=\"p-3\">{t('date')}</th><th className=\"p-3\">{t('customers')}</th><th className=\"p-3\">{t('amount')}</th><th className=\"p-3 hidden sm:table-cell\">{t('method')}</th><th className=\"p-3\">{t('invoiceRef')}</th></tr></thead>\n                <tbody>{sortedPayments.map((item, index) => (<tr key={item.id || index} className=\"border-b hover:bg-gray-50\">\n                    <td className=\"p-3\">{formatDateTime(item.paymentDate, language)}</td>\n                    <td className=\"p-3\">{item.customerName}</td>\n                    <td className=\"p-3\">{formatCurrency(item.amount, language)}</td>\n                    <td className=\"p-3 hidden sm:table-cell\">{item.paymentType}</td>\n                    <td className=\"p-3\">{item.invoiceId}</td>\n                </tr>))}</tbody>\n             </table></div>\n        </div>\n    );\n});\n\nconst SettingsView = React.memo(({ companyProfile, handleSaveProfile, t }) => {\n    return (\n        <div className=\"bg-white p-4 sm:p-8 rounded-2xl shadow-md max-w-2xl mx-auto\">\n            <CompanyProfileForm initialData={companyProfile} onSubmit={handleSaveProfile} t={t} />\n        </div>\n    );\n});\n\n// --- FORMS AND MODALS ---\n\nconst ProductForm = React.memo(({ onSubmit, initialData, categories, products, onClose, t, language }) => {\n    const [name, setName] = useState(initialData?.name || '');\n    const [description, setDescription] = useState(initialData?.description || '');\n    const [price, setPrice] = useState(initialData?.price || '');\n    const [basePrice, setBasePrice] = useState(initialData?.basePrice || '');\n    const [photoURL, setPhotoURL] = useState(initialData?.photoURL || null);\n    const [parentCategoryId, setParentCategoryId] = useState('');\n    const [subCategoryId, setSubCategoryId] = useState(initialData?.categoryId || '');\n    const [productType, setProductType] = useState(initialData?.type === PRODUCT_TYPES.PACK ? PRODUCT_TYPES.PACK : PRODUCT_TYPES.SIMPLE);\n    \n    // State for Simple product\n    const [quantity, setQuantity] = useState(initialData?.quantity ?? '');\n    const [reorderThreshold, setReorderThreshold] = useState(initialData?.reorderThreshold ?? '');\n\n    // State for Pack product\n    const [packItems, setPackItems] = useState(() => \n        (initialData?.packItems || []).map(item => ({\n            ...item,\n            packItemId: crypto.randomUUID()\n        }))\n    );\n    \n    // State for Variant product\n    const [variants, setVariants] = useState(initialData?.variants || []);\n\n    const parentCategories = useMemo(() => categories.filter(c => !c.parentId), [categories]);\n    const subCategories = useMemo(() => parentCategoryId ? categories.filter(c => c.parentId === parentCategoryId) : [], [categories, parentCategoryId]);\n    \n    useEffect(() => {\n        if (initialData?.categoryId) {\n            const cat = categories.find(c => c.id === initialData.categoryId);\n            if (cat?.parentId) { setParentCategoryId(cat.parentId); setSubCategoryId(cat.id); } \n            else { setParentCategoryId(cat?.id || ''); }\n        }\n    }, [initialData, categories]);\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        const finalProductType = productType === PRODUCT_TYPES.PACK \n            ? PRODUCT_TYPES.PACK \n            : (variants.length > 0 ? PRODUCT_TYPES.VARIANT : PRODUCT_TYPES.SIMPLE);\n\n        const commonData = { name, description, photoURL, type: finalProductType };\n        let data = {};\n        \n        if (finalProductType !== PRODUCT_TYPES.PACK) {\n            commonData.categoryId = subCategoryId || parentCategoryId;\n        } else {\n            commonData.categoryId = null;\n        }\n\n        if (finalProductType === PRODUCT_TYPES.SIMPLE) {\n            data = { ...commonData, price: Number(price), quantity: Number(quantity), reorderThreshold: Number(reorderThreshold) };\n        } else if (finalProductType === PRODUCT_TYPES.PACK) {\n            const finalPackItems = packItems.map(({ packItemId, ...rest }) => rest);\n            data = { ...commonData, price: Number(price), packItems: finalPackItems, quantity: 0 };\n        } else if (finalProductType === PRODUCT_TYPES.VARIANT) {\n            data = { ...commonData, basePrice: Number(basePrice), variants };\n        }\n        onSubmit(data);\n    };\n    \n    const handlePhotoChange = async (e) => { if (e.target.files[0]) { const r = await resizeImage(e.target.files[0], 400, 400); setPhotoURL(r); } }\n    const handleAddPackItem = (item) => { setPackItems(current => [...current, { ...item, packItemId: crypto.randomUUID() }]); };\n    const handleRemovePackItem = (packItemId) => { setPackItems(current => current.filter(item => item.packItemId !== packItemId)); };\n\n    const handleAddVariant = (variant) => {\n        if (variants.length === 0 && price) {\n            setBasePrice(price);\n        }\n        setVariants(current => [...current, { ...variant, id: crypto.randomUUID() }]);\n    };\n    const handleRemoveVariant = (variantId) => {\n        const newVariants = variants.filter(v => v.id !== variantId);\n        if (newVariants.length === 0 && basePrice) {\n            setPrice(basePrice);\n            setBasePrice('');\n        }\n        setVariants(newVariants);\n    };\n    \n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <h3 className=\"text-2xl font-bold text-center\">{initialData ? t('editProduct') : t('addProduct')}</h3>\n            <div className=\"flex flex-col items-center space-y-2\">\n                 <label className=\"w-full text-sm font-medium\">{t('photo')}</label>\n                 <div className=\"w-32 h-32 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-dashed\">\n                     {photoURL ? <img src={photoURL} alt=\"Preview\" className=\"w-full h-full object-cover rounded-lg\"/> : <ImageIcon className=\"text-gray-400\" size={40}/>}\n                 </div>\n                 <input type=\"file\" accept=\"image/*\" onChange={handlePhotoChange} className=\"text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"/>\n             </div>\n            <FormField label={t('productName')} type=\"text\" value={name} onChange={e => setName(e.target.value)} required />\n            <FormSelect label={t('productType')} value={productType} onChange={e => setProductType(e.target.value)}>\n                <option value={PRODUCT_TYPES.SIMPLE}>{t('standardItem')}</option>\n                <option value={PRODUCT_TYPES.PACK}>{t('pack')}</option>\n            </FormSelect>\n             \n            {productType === PRODUCT_TYPES.SIMPLE && (\n                <>\n                    {variants.length === 0 ? (\n                         <>\n                            <FormField label={t('quantity')} type=\"number\" value={quantity} onChange={e => setQuantity(e.target.value)} required min=\"0\" />\n                            <FormField label={t('reorderThreshold')} type=\"number\" value={reorderThreshold} onChange={e => setReorderThreshold(e.target.value)} required min=\"0\" />\n                            <FormField label={t('salePrice')} type=\"number\" value={price} onChange={e => setPrice(e.target.value)} required min=\"0\" />\n                         </>\n                    ) : (\n                         <FormField label={t('basePrice')} type=\"number\" value={basePrice} onChange={e => setBasePrice(e.target.value)} required min=\"0\" />\n                    )}\n                    <div className=\"p-4 border rounded-lg space-y-4 bg-gray-50\">\n                        <h4 className=\"font-semibold\">{t('productVariantsOptional')}</h4>\n                        <VariantForm onAddVariant={handleAddVariant} t={t} />\n                         {variants.length > 0 && <ul className=\"space-y-2\">\n                            {variants.map(v => (\n                                <li key={v.id} className=\"flex justify-between items-center bg-white p-2 rounded-md text-sm\">\n                                    <span>{v.name} ({t('priceMod')}: {formatCurrency(v.priceModifier, language)}, {t('stock')}: {v.quantity})</span>\n                                    <button type=\"button\" onClick={() => handleRemoveVariant(v.id)} className=\"text-red-500\"><Trash2 size={16}/></button>\n                                </li>\n                            ))}\n                        </ul>}\n                    </div>\n                </>\n            )}\n            \n             {productType === PRODUCT_TYPES.PACK && (<>\n                <FormField label={t('packSalePrice')} type=\"number\" value={price} onChange={e => setPrice(e.target.value)} required min=\"0\" />\n                <div className=\"p-4 border rounded-lg space-y-4 bg-gray-50\">\n                    <h4 className=\"font-semibold\">{t('packComposition')}</h4>\n                    <PackItemSelector products={products.filter(p => p.type === PRODUCT_TYPES.SIMPLE || p.type === PRODUCT_TYPES.VARIANT)} onAddItem={handleAddPackItem} t={t} />\n                    <ul className=\"space-y-2\">\n                        {packItems.map((item) => (\n                            <li key={item.packItemId} className=\"flex justify-between items-center bg-white p-2 rounded-md\">\n                                <span>{item.name} x {item.quantity}</span>\n                                <button type=\"button\" onClick={() => handleRemovePackItem(item.packItemId)} className=\"text-red-500\"><Trash2 size={16}/></button>\n                            </li>\n                        ))}\n                    </ul>\n                </div>\n            </>)}\n\n            <FormSelect label={t('mainCategory')} value={parentCategoryId} onChange={e => { setParentCategoryId(e.target.value); setSubCategoryId(''); }} disabled={productType === PRODUCT_TYPES.PACK}>\n                <option value=\"\">{t('select')}...</option>\n                {parentCategories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}\n            </FormSelect>\n             <FormSelect label={t('subCategory')} value={subCategoryId} onChange={e => setSubCategoryId(e.target.value)} disabled={!parentCategoryId || subCategories.length === 0 || productType === PRODUCT_TYPES.PACK}>\n                <option value=\"\">{t('select')}...</option>\n                {subCategories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}\n            </FormSelect>\n            <FormField label={t('description')} type=\"text\" value={description} onChange={e => setDescription(e.target.value)} />\n            <div className=\"flex justify-end space-x-4 pt-4\">\n                <button type=\"button\" onClick={onClose} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('cancel')}</button>\n                <button type=\"submit\" className=\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\">{initialData ? t('update') : t('add')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst VariantForm = React.memo(({ onAddVariant, t }) => {\n    const [name, setName] = useState('');\n    const [priceModifier, setPriceModifier] = useState(0);\n    const [quantity, setQuantity] = useState('');\n    const [reorderThreshold, setReorderThreshold] = useState('');\n\n    const handleAdd = () => {\n        if (!name || quantity === '') return;\n        onAddVariant({ name, priceModifier: Number(priceModifier), quantity: Number(quantity), reorderThreshold: Number(reorderThreshold || 0) });\n        setName(''); setPriceModifier(0); setQuantity(''); setReorderThreshold('');\n    };\n\n    return (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-2 items-end\">\n            <FormField label={t('variantName')} value={name} onChange={e => setName(e.target.value)} placeholder=\"Ex: Rouge, XL...\"/>\n            <FormField label={t('priceMod')} type=\"number\" value={priceModifier} onChange={e => setPriceModifier(e.target.value)} placeholder=\"Ex: 500 ou -200\" />\n            <FormField label={t('stock')} type=\"number\" value={quantity} onChange={e => setQuantity(e.target.value)} placeholder={t('quantity')}/>\n            <FormField label={t('reorderThresh')} type=\"number\" value={reorderThreshold} onChange={e => setReorderThreshold(e.target.value)} placeholder={t('threshold')}/>\n            <button type=\"button\" onClick={handleAdd} className=\"px-4 py-2 bg-blue-500 text-white rounded-lg h-10\"><Plus size={20}/></button>\n        </div>\n    )\n});\n\nconst PackItemSelector = React.memo(({ products, onAddItem, t }) => {\n    const [selectedProductId, setSelectedProductId] = useState('');\n    const [selectedVariantId, setSelectedVariantId] = useState('');\n    const [quantity, setQuantity] = useState(1);\n\n    const selectedProduct = useMemo(() => {\n        return products.find(p => p.id === selectedProductId);\n    }, [products, selectedProductId]);\n\n    useEffect(() => {\n        setSelectedVariantId('');\n    }, [selectedProductId]);\n\n    const handleAdd = () => {\n        if (!selectedProduct || quantity <= 0) return;\n\n        if (selectedProduct.type === PRODUCT_TYPES.VARIANT) {\n            if (!selectedVariantId) return;\n            const variant = selectedProduct.variants.find(v => v.id === selectedVariantId);\n            if (variant) {\n                const itemToAdd = {\n                    productId: selectedProduct.id,\n                    name: `${selectedProduct.name} - ${variant.name}`,\n                    quantity: quantity,\n                    variant: { id: variant.id, name: variant.name }\n                };\n                onAddItem(itemToAdd);\n            }\n        } else {\n            const itemToAdd = {\n                productId: selectedProduct.id,\n                name: selectedProduct.name,\n                quantity: quantity,\n                variant: null\n            };\n            onAddItem(itemToAdd);\n        }\n\n        setSelectedProductId('');\n        setSelectedVariantId('');\n        setQuantity(1);\n    };\n\n    return (\n        <div className=\"flex flex-wrap items-end gap-2\">\n            <div className=\"flex-grow min-w-[150px]\">\n                 <label className=\"text-sm\">{t('product')}</label>\n                 <select value={selectedProductId} onChange={e => setSelectedProductId(e.target.value)} className=\"w-full px-3 py-2 border rounded-lg bg-white\">\n                    <option value=\"\">{t('chooseProduct')}</option>\n                    {products.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}\n                 </select>\n            </div>\n            \n            {selectedProduct && selectedProduct.type === PRODUCT_TYPES.VARIANT && (\n                <div className=\"flex-grow min-w-[150px]\">\n                    <label className=\"text-sm\">{t('variant')}</label>\n                    <select value={selectedVariantId} onChange={e => setSelectedVariantId(e.target.value)} className=\"w-full px-3 py-2 border rounded-lg bg-white\">\n                        <option value=\"\">{t('chooseVariant')}</option>\n                        {selectedProduct.variants.map(v => <option key={v.id} value={v.id}>{v.name} (Stock: {v.quantity})</option>)}\n                    </select>\n                </div>\n            )}\n\n            <div className=\"w-24\">\n                 <label className=\"text-sm\">{t('quantity')}</label>\n                 <input type=\"number\" value={quantity} onChange={e => setQuantity(Number(e.target.value))} min=\"1\" className=\"w-full px-3 py-2 border rounded-lg\"/>\n            </div>\n            <button type=\"button\" onClick={handleAdd} className=\"px-4 py-2 bg-blue-500 text-white rounded-lg h-10 self-end\"><Plus size={20}/></button>\n        </div>\n    )\n});\n\nconst CategoryForm = React.memo(({ onSubmit, initialData, categories, onClose, t }) => {\n    const [name, setName] = useState(initialData?.name || '');\n    const [parentId, setParentId] = useState(initialData?.parentId || '');\n    const parentCategories = categories.filter(c => !c.parentId && c.id !== initialData?.id);\n    const handleSubmit = (e) => { e.preventDefault(); onSubmit({ name, parentId: parentId || null }); };\n\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <h3 className=\"text-2xl font-bold text-center\">{initialData ? t('editCategory') : t('addCategoryTitle')}</h3>\n            <FormField label={t('name')} type=\"text\" value={name} onChange={e => setName(e.target.value)} required />\n            <FormSelect label={t('parentCategoryOptional')} value={parentId} onChange={e => setParentId(e.target.value)}>\n                <option value=\"\">{t('noneMain')}</option>\n                {parentCategories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}\n            </FormSelect>\n             <div className=\"flex justify-end space-x-4 pt-4\">\n                <button type=\"button\" onClick={onClose} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('cancel')}</button>\n                <button type=\"submit\" className=\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\">{initialData ? t('update') : t('add')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst CustomerForm = React.memo(({ onSubmit, initialData, onClose, onSuccess, t }) => {\n    const [name, setName] = useState(initialData?.name || '');\n    const [nickname, setNickname] = useState(initialData?.nickname || '');\n    const [address, setAddress] = useState(initialData?.address || '');\n    const [email, setEmail] = useState(initialData?.email || '');\n    const [phone, setPhone] = useState(initialData?.phone || '');\n    const handleSubmit = (e) => { \n        e.preventDefault(); \n        const data = { name, nickname, address, email, phone, balance: initialData?.balance || 0 };\n        if (!initialData && onSuccess) {\n            onSubmit(data, onSuccess);\n        } else {\n            onSubmit(data);\n        }\n    };\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <h3 className=\"text-2xl font-bold text-center\">{initialData ? t('editCustomer') : t('addCustomerTitle')}</h3>\n            <FormField label={t('fullName')} type=\"text\" value={name} onChange={e => setName(e.target.value)} required />\n            <FormField label={t('nicknameOptional')} type=\"text\" value={nickname} onChange={e => setNickname(e.target.value)} />\n            <FormField label={t('addressOptional')} type=\"text\" value={address} onChange={e => setAddress(e.target.value)} />\n            <FormField label={t('email')} type=\"email\" value={email} onChange={e => setEmail(e.target.value)} />\n            <FormField label={t('phone')} type=\"tel\" value={phone} onChange={e => setPhone(e.target.value)} />\n            <div className=\"flex justify-end space-x-4 pt-4\">\n                <button type=\"button\" onClick={onClose} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('cancel')}</button>\n                <button type=\"submit\" className=\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\">{initialData ? t('update') : t('add')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst DepositForm = React.memo(({ customer, onSubmit, onClose, t }) => {\n    const [amount, setAmount] = useState('');\n    const handleSubmit = (e) => { e.preventDefault(); onSubmit(amount); };\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <h3 className=\"text-2xl font-bold text-center\">{t('addDeposit')}</h3>\n            <p className=\"text-center\">{t('for')} {customer.name}</p>\n            <FormField label={t('depositAmount')} type=\"number\" value={amount} onChange={e => setAmount(e.target.value)} required min=\"1\" />\n            <div className=\"flex justify-end space-x-4 pt-4\">\n                <button type=\"button\" onClick={onClose} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('cancel')}</button>\n                <button type=\"submit\" className=\"px-6 py-2 rounded-lg text-white bg-green-500 font-semibold\">{t('save')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst SaleForm = React.memo(({ onSubmit, customers, onClose, cart, setCart, preselectedCustomerId, openModal, showAlert, t, language }) => {\n    const [customerId, setCustomerId] = useState(preselectedCustomerId || '');\n    const [paymentType, setPaymentType] = useState(PAYMENT_TYPES[0]);\n    const [discountType, setDiscountType] = useState('percentage');\n    const [discountValue, setDiscountValue] = useState(0);\n    const [applyVAT, setApplyVAT] = useState(false);\n    \n    const { subtotal, discountAmount, vatAmount, finalTotal } = useMemo(() => {\n        const subtotal = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);\n        const discountAmount = discountType === 'percentage' ? subtotal * (Number(discountValue) / 100) : Number(discountValue);\n        const subtotalAfterDiscount = subtotal - discountAmount;\n        const vatAmount = applyVAT ? subtotalAfterDiscount * VAT_RATE : 0;\n        const finalTotal = subtotalAfterDiscount + vatAmount;\n        return { subtotal, discountAmount, vatAmount, finalTotal };\n    }, [cart, discountType, discountValue, applyVAT]);\n    \n    const handleSubmit = (e) => {\n        e.preventDefault();\n        if (cart.length === 0) { showAlert(t('cartEmpty')); return; }\n        if (!customerId) { showAlert(t('selectCustomer')); return; }\n        onSubmit({ customerId, paymentType, items: cart, totalPrice: finalTotal, discountAmount, vatAmount });\n    };\n\n    const handleAddNewCustomer = () => {\n        openModal('addCustomer', { onSuccess: (newCustomer) => {\n            setCustomerId(newCustomer.id);\n        }}, 'md');\n    };\n\n    const updateCartItemQuantity = (cartId, newQuantity) => {\n        setCart(currentCart => currentCart.map(item => item.cartId === cartId ? { ...item, quantity: Math.max(0, newQuantity) } : item).filter(item => item.quantity > 0));\n    };\n\n    const selectedCustomer = useMemo(() => customers.find(c => c.id === customerId), [customers, customerId]);\n\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <h3 className=\"text-2xl font-bold text-center text-gray-800\">{t('salesCart')}</h3>\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                <div className=\"lg:col-span-2 space-y-4\">\n                    <h4 className=\"font-bold text-lg\">{t('items')} ({cart.length})</h4>\n                    <div className=\"max-h-96 overflow-y-auto space-y-3 pr-2\">\n                    {cart.length > 0 ? cart.map(item => (\n                        <div key={item.cartId} className=\"flex items-center gap-4 bg-gray-50 p-3 rounded-lg\">\n                            <img src={item.photoURL || 'https://placehold.co/60x60'} alt={item.name} className=\"w-16 h-16 rounded-md object-cover\"/>\n                            <div className=\"flex-grow\">\n                                <p className=\"font-semibold\">{item.name}</p>\n                                <p className=\"text-sm text-gray-600\">{formatCurrency(item.price, language)}</p>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                                <button type=\"button\" onClick={() => updateCartItemQuantity(item.cartId, item.quantity - 1)} className=\"text-red-500\"><MinusCircle size={20}/></button>\n                                <input type=\"number\" value={item.quantity} onChange={(e) => updateCartItemQuantity(item.cartId, parseInt(e.target.value, 10) || 0)} className=\"w-16 text-center border rounded-md p-1\"/>\n                                <button type=\"button\" onClick={() => updateCartItemQuantity(item.cartId, item.quantity + 1)} className=\"text-green-500\"><PlusCircle size={20}/></button>\n                            </div>\n                            <p className=\"w-24 text-right font-semibold\">{formatCurrency(item.price * item.quantity, language)}</p>\n                        </div>\n                    )) : <p className=\"text-center text-gray-500 py-8\">{t('cartEmpty')}</p>}\n                    </div>\n                </div>\n                <div className=\"bg-gray-50 p-6 rounded-2xl space-y-4\">\n                    <h4 className=\"font-bold text-lg\">{t('summary')}</h4>\n                     <div className=\"flex items-end gap-2\">\n                         <div className=\"flex-grow\"><FormSelect label={t('customers')} value={customerId} onChange={e => setCustomerId(e.target.value)} required>\n                             <option value=\"\" disabled>{t('selectCustomer')}</option>\n                             {customers.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}\n                         </FormSelect></div>\n                         <button type=\"button\" onClick={handleAddNewCustomer} className=\"p-2 bg-blue-500 text-white rounded-lg\"><Plus size={20}/></button>\n                       </div>\n                     <div>\n                        <label className=\"block text-sm font-medium\">{t('discount')}</label>\n                        <div className=\"flex items-center\">\n                            <select value={discountType} onChange={e => setDiscountType(e.target.value)} className=\"w-1/3 px-3 py-2 border rounded-l-lg bg-white\">\n                                <option value=\"percentage\">%</option><option value=\"fixed\">F CFA</option>\n                            </select>\n                            <input type=\"number\" value={discountValue} onChange={e => setDiscountValue(e.target.value)} min=\"0\" className=\"w-2/3 px-3 py-2 border-t border-b border-r rounded-r-lg\"/>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center\"><input type=\"checkbox\" id=\"vat-checkbox\" checked={applyVAT} onChange={e => setApplyVAT(e.target.checked)} className=\"h-4 w-4 rounded\"/>\n                        <label htmlFor=\"vat-checkbox\" className=\"ml-2 text-sm\">{t('applyVAT')}</label>\n                    </div>\n                    <FormSelect label={t('paymentType')} value={paymentType} onChange={e => setPaymentType(e.target.value)} required>\n                        {PAYMENT_TYPES.map(type => {\n                            if(type === 'Acompte Client' && (!selectedCustomer || (selectedCustomer.balance || 0) <= 0)) return null;\n                            return <option key={type} value={type}>{type} {type === 'Acompte Client' && `(${formatCurrency(selectedCustomer?.balance || 0, language)})`}</option>\n                        })}\n                    </FormSelect>\n                    <div className=\"pt-4 space-y-2 text-right border-t\">\n                        <p>{t('subtotal')}: {formatCurrency(subtotal, language)}</p>\n                        {discountAmount > 0 && <p className=\"text-red-500\">{t('discount')}: -{formatCurrency(discountAmount, language)}</p>}\n                        {applyVAT && <p>{t('vat18')}: +{formatCurrency(vatAmount, language)}</p>}\n                        <p className=\"text-2xl font-bold text-green-600\">{t('total')}: {formatCurrency(finalTotal, language)}</p>\n                    </div>\n                </div>\n            </div>\n            <div className=\"flex justify-end space-x-4 pt-6\">\n                 <button type=\"button\" onClick={() => openModal('productSelection', { preselectedCustomerId: customerId }, '7xl')} className=\"px-6 py-3 rounded-lg bg-gray-200 hover:bg-gray-300\">{t('continueShopping')}</button>\n                <button type=\"submit\" className=\"px-8 py-3 rounded-lg text-white bg-blue-500 font-semibold\">{t('validateSale')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst PaymentReceipt = React.memo(({ receiptData, onClose, showAlert, t, language }) => {\n    if (!receiptData) return null;\n    const { customer, amount, paymentType, paymentDate, remainingBalance, companyProfile, saleId, invoiceId } = receiptData;\n    const [canShare, setCanShare] = useState(false);\n\n    useEffect(() => {\n        if (navigator.share && typeof navigator.canShare === 'function') {\n            const dummyFile = new File([\"\"], \"dummy.pdf\", { type: \"application/pdf\" });\n            if (navigator.canShare({ files: [dummyFile] })) {\n                setCanShare(true);\n            }\n        }\n    }, []);\n\n    const handlePrint = () => window.print();\n\n    const generatePdf = async () => {\n        const { jsPDF } = window.jspdf;\n        const input = document.querySelector('.receipt-container.printable-area');\n        if (!input || !window.html2canvas) {\n            showAlert(\"PDF generation library is not loaded.\");\n            return null;\n        }\n        try {\n            const canvas = await window.html2canvas(input, { scale: 2, backgroundColor: '#ffffff' });\n            const imgData = canvas.toDataURL('image/png');\n            const pdf = new jsPDF('p', 'mm', 'a4');\n            const pdfWidth = pdf.internal.pageSize.getWidth();\n            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;\n            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);\n            return pdf;\n        } catch (error) {\n            console.error(\"Error generating PDF:\", error);\n            showAlert(\"Could not generate PDF.\");\n            return null;\n        }\n    };\n\n    const handleDownloadPDF = async () => { const pdf = await generatePdf(); if(pdf) { pdf.save(`payment-receipt-${invoiceId}.pdf`); } };\n    \n    const handleSharePDF = async () => {\n        const pdf = await generatePdf();\n        if (pdf && navigator.share) {\n            const pdfBlob = pdf.output('blob');\n            const fileName = `payment-receipt-${invoiceId}.pdf`;\n            const file = new File([pdfBlob], fileName, { type: 'application/pdf' });\n            try { await navigator.share({ title: 'Payment Receipt', text: `Here is the payment receipt for invoice ${invoiceId}.`, files: [file] }); } \n            catch (error) { if (error.name !== 'AbortError') { showAlert(\"An error occurred while sharing.\"); } }\n        }\n    };\n    \n    return (\n        <div className=\"receipt-container\">\n             <div className=\"printable-area p-6\">\n                <div className=\"flex justify-between items-start\">\n                    <div><h1 className=\"text-2xl font-bold\">{t('paymentReceipt')}</h1></div>\n                    <div className=\"text-right\"><h2 className=\"text-xl font-bold\">{companyProfile.name}</h2></div>\n                </div>\n                <div className=\"border-b my-6\"></div>\n                <div className=\"flex justify-between mb-6\">\n                    <div><h3 className=\"font-bold\">{t('receivedFrom')}</h3><p>{customer.name}</p></div>\n                    <div className=\"text-right\">\n                        <p><span className=\"font-bold\">{t('date')}:</span> {formatDateTime(paymentDate, language)}</p>\n                        <p><span className=\"font-bold\">{t('originalInvoice')}:</span> {invoiceId}</p>\n                    </div>\n                </div>\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <p className=\"text-lg\">{t('amountPaid')}: <span className=\"font-bold text-green-600\">{formatCurrency(amount, language)}</span></p>\n                    <p>{t('paymentMethod')}: {paymentType}</p>\n                </div>\n                <div className=\"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg\">\n                    <p className=\"text-lg\">{t('remainingBalanceDebt')}: <span className=\"font-bold text-red-600\">{formatCurrency(remainingBalance, language)}</span></p>\n                </div>\n            </div>\n            <div className=\"flex justify-end space-x-2 p-6 bg-gray-50 rounded-b-2xl no-print\">\n                <button type=\"button\" onClick={onClose} className=\"px-4 py-2 rounded-lg bg-gray-200\">{t('close')}</button>\n                {canShare && ( <button onClick={handleSharePDF} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-blue-600 font-semibold\"><Share2 size={18} className=\"mr-2\" /> {t('share')}</button> )}\n                <button onClick={handleDownloadPDF} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-green-600 font-semibold\"><FileText size={18} className=\"mr-2\" /> PDF</button>\n                <button onClick={handlePrint} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-gray-500 font-semibold\"><Printer size={18} className=\"mr-2\" /> {t('print')}</button>\n            </div>\n        </div>\n    );\n});\n\nconst DepositReceipt = React.memo(({ receiptData, onClose, showAlert, t, language }) => {\n    if (!receiptData) return null;\n    const { customer, amount, depositDate, companyProfile, customerId } = receiptData;\n    const [canShare, setCanShare] = useState(false);\n    const receiptId = `${companyProfile.depositPrefix || 'DEP-'}${customerId.substring(0,4).toUpperCase()}${new Date(depositDate).getTime().toString().slice(-4)}`;\n\n    useEffect(() => {\n        if (navigator.share && typeof navigator.canShare === 'function') {\n            const dummyFile = new File([\"\"], \"dummy.pdf\", { type: \"application/pdf\" });\n            if (navigator.canShare({ files: [dummyFile] })) {\n                setCanShare(true);\n            }\n        }\n    }, []);\n\n    const handlePrint = () => window.print();\n\n    const generatePdf = async () => {\n        const { jsPDF } = window.jspdf;\n        const input = document.querySelector('.receipt-container.printable-area');\n        if (!input || !window.html2canvas) { showAlert(\"PDF generation library is not loaded.\"); return null; }\n        try {\n            const canvas = await window.html2canvas(input, { scale: 2, backgroundColor: '#ffffff' });\n            const imgData = canvas.toDataURL('image/png');\n            const pdf = new jsPDF('p', 'mm', 'a4');\n            const pdfWidth = pdf.internal.pageSize.getWidth();\n            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;\n            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);\n            return pdf;\n        } catch (error) { console.error(\"Error generating PDF:\", error); showAlert(\"Could not generate PDF.\"); return null; }\n    };\n    \n    const handleDownloadPDF = async () => { const pdf = await generatePdf(); if(pdf) { pdf.save(`deposit-receipt-${receiptId}.pdf`); } };\n    \n    const handleSharePDF = async () => {\n        const pdf = await generatePdf();\n        if (pdf && navigator.share) {\n            const pdfBlob = pdf.output('blob');\n            const fileName = `deposit-receipt-${receiptId}.pdf`;\n            const file = new File([pdfBlob], fileName, { type: 'application/pdf' });\n            try { await navigator.share({ title: 'Deposit Receipt', text: `Here is the deposit receipt for ${customer.name}.`, files: [file] }); } \n            catch (error) { if (error.name !== 'AbortError') { showAlert(\"An error occurred while sharing.\"); } }\n        }\n    };\n    \n    return (\n        <div className=\"receipt-container\">\n             <div className=\"printable-area p-6\">\n                <div className=\"flex justify-between items-start\">\n                    <div><h1 className=\"text-2xl font-bold\">{t('depositReceipt')}</h1><p className=\"text-gray-500 text-sm\">{receiptId}</p></div>\n                    <div className=\"text-right\"><h2 className=\"text-xl font-bold\">{companyProfile.name}</h2></div>\n                </div>\n                <div className=\"border-b my-6\"></div>\n                <div className=\"flex justify-between mb-6\">\n                    <div><h3 className=\"font-bold\">{t('receivedFrom')}</h3><p>{customer.name}</p></div>\n                    <div className=\"text-right\"><p><span className=\"font-bold\">{t('date')}:</span> {formatDateTime(depositDate, language)}</p></div>\n                </div>\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <p className=\"text-lg\">{t('depositAmountLabel')}: <span className=\"font-bold text-green-600\">{formatCurrency(amount, language)}</span></p>\n                </div>\n                 <div className=\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n                    <p className=\"text-lg\">{t('newDepositBalance')}: <span className=\"font-bold text-blue-600\">{formatCurrency(customer.balance || 0, language)}</span></p>\n                </div>\n            </div>\n            <div className=\"flex justify-end space-x-2 p-6 bg-gray-50 rounded-b-2xl no-print\">\n                <button type=\"button\" onClick={onClose} className=\"px-4 py-2 rounded-lg bg-gray-200\">{t('close')}</button>\n                {canShare && ( <button onClick={handleSharePDF} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-blue-600 font-semibold\"><Share2 size={18} className=\"mr-2\" /> {t('share')}</button> )}\n                <button onClick={handleDownloadPDF} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-green-600 font-semibold\"><FileText size={18} className=\"mr-2\" /> PDF</button>\n                <button onClick={handlePrint} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-gray-500 font-semibold\"><Printer size={18} className=\"mr-2\" /> {t('print')}</button>\n            </div>\n        </div>\n    );\n});\n\nconst Invoice = React.memo(({ sale, products, companyProfile, onClose, showAlert, t, language }) => {\n    if (!sale) return null;\n    const [canShare, setCanShare] = useState(false);\n\n    useEffect(() => {\n        if (navigator.share && typeof navigator.canShare === 'function') {\n            const dummyFile = new File([\"\"], \"dummy.pdf\", { type: \"application/pdf\" });\n            if (navigator.canShare({ files: [dummyFile] })) { setCanShare(true); }\n        }\n    }, []);\n\n    const handlePrint = () => window.print();\n    \n    const generatePdf = async () => {\n        const { jsPDF } = window.jspdf;\n        const input = document.querySelector('.invoice-container.printable-area');\n        if (!input || !window.html2canvas) { showAlert(\"PDF generation library is not loaded.\"); return null; }\n        try {\n            const canvas = await window.html2canvas(input, { scale: 2, backgroundColor: '#ffffff' });\n            const imgData = canvas.toDataURL('image/png');\n            const pdf = new jsPDF('p', 'mm', 'a4');\n            const pdfWidth = pdf.internal.pageSize.getWidth();\n            const pdfHeight = (canvas.height * pdfWidth) / canvas.width;\n            pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);\n            return pdf;\n        } catch (error) { console.error(\"Error generating PDF:\", error); showAlert(\"Could not generate PDF.\"); return null; }\n    };\n    \n    const handleDownloadPDF = async () => { const pdf = await generatePdf(); if(pdf) { pdf.save(`invoice-${sale.invoiceId}.pdf`); } };\n    \n    const handleSharePDF = async () => {\n        const pdf = await generatePdf();\n        if (pdf && navigator.share) {\n            const pdfBlob = pdf.output('blob');\n            const fileName = `invoice-${sale.invoiceId}.pdf`;\n            const file = new File([pdfBlob], fileName, { type: 'application/pdf' });\n             try { await navigator.share({ title: `Invoice ${sale.invoiceId}`, text: `Here is the invoice for ${sale.customer.name}.`, files: [file] }); } \n             catch (error) { if (error.name !== 'AbortError') { showAlert(\"An error occurred while sharing.\"); } }\n        }\n    };\n\n    return (\n        <div className=\"invoice-container\">\n            <div className=\"printable-area p-6\">\n                <div className=\"flex justify-between items-start\">\n                    <div><h1 className=\"text-2xl font-bold\">{t('invoice')}</h1><p className=\"text-gray-500 text-sm\">{sale.invoiceId}</p></div>\n                    <div className=\"text-right\">\n                        {companyProfile.logo && <img src={companyProfile.logo} alt={companyProfile.name} className=\"h-12 w-auto ml-auto mb-2\" />}\n                        <h2 className=\"text-xl font-bold\">{companyProfile.name}</h2>\n                        <p className=\"text-sm\">{companyProfile.address}</p><p className=\"text-sm\">{companyProfile.phone}</p>\n                    </div>\n                </div>\n                <div className=\"border-b my-6\"></div>\n                <div className=\"flex justify-between mb-6\">\n                    <div><h3 className=\"font-bold\">{t('billedTo')}</h3><p>{sale.customer?.name}</p></div>\n                    <div className=\"text-right\"><p><span className=\"font-bold\">{t('date')}:</span> {formatDateTime(sale.saleDate, language)}</p><p><span className=\"font-bold\">{t('payment')}:</span> {sale.paymentType}</p></div>\n                </div>\n                <table className=\"w-full text-left mb-8\">\n                    <thead><tr className=\"bg-gray-100\"><th className=\"p-3\">{t('product')}</th><th className=\"p-3\">{t('qty')}</th><th className=\"p-3 text-right\">{t('pu')}</th><th className=\"p-3 text-right\">{t('total')}</th></tr></thead>\n                    <tbody>\n                        {sale.items.flatMap((item, i) => {\n                            const productDetails = products.find(p => p.id === item.productId);\n                            const mainRow = (\n                                <tr key={item.productId || i}>\n                                    <td className=\"p-3 border-b\">{item.productName}</td>\n                                    <td className=\"p-3 border-b\">{item.quantity}</td>\n                                    <td className=\"p-3 border-b text-right\">{formatCurrency(item.unitPrice, language)}</td>\n                                    <td className=\"p-3 border-b text-right\">{formatCurrency(item.subtotal, language)}</td>\n                                </tr>\n                            );\n\n                            if (productDetails && productDetails.type === PRODUCT_TYPES.PACK) {\n                                const subRows = productDetails.packItems.map((packItem, j) => (\n                                    <tr key={`${item.productId}-${j}`} className=\"bg-gray-50 text-sm\">\n                                        <td className=\"pl-8 pr-3 py-2 text-gray-600 border-b\">\n                                            {packItem.quantity * item.quantity} x {packItem.name}\n                                        </td>\n                                        <td className=\"p-2 border-b\"></td>\n                                        <td className=\"p-2 border-b\"></td>\n                                        <td className=\"p-2 border-b\"></td>\n                                    </tr>\n                                ));\n                                return [mainRow, ...subRows];\n                            }\n                            return [mainRow];\n                        })}\n                    </tbody>\n                </table>\n                <div className=\"text-right w-full max-w-xs ml-auto\">\n                    <div className=\"flex justify-between\"><span className=\"font-semibold\">{t('subtotal')}:</span><span>{formatCurrency(sale.items.reduce((acc, i) => acc + i.subtotal, 0), language)}</span></div>\n                    {sale.discountAmount > 0 && <div className=\"flex justify-between text-red-500\"><span className=\"font-semibold\">{t('discount')}:</span><span>-{formatCurrency(sale.discountAmount, language)}</span></div>}\n                    <div className=\"flex justify-between\"><span className=\"font-semibold\">{t('amountBeforeTax')}:</span><span>{formatCurrency(sale.totalPrice - sale.vatAmount, language)}</span></div>\n                    {sale.vatAmount > 0 && <div className=\"flex justify-between\"><span className=\"font-semibold\">{t('vat18')}:</span><span>+{formatCurrency(sale.vatAmount, language)}</span></div>}\n                    <div className=\"flex justify-between text-2xl font-bold border-t mt-2 pt-2\"><span className=\"font-semibold\">{t('total').toUpperCase()}:</span><span>{formatCurrency(sale.totalPrice, language)}</span></div>\n                </div>\n                <div className=\"mt-12 text-center text-sm text-gray-500\"><p>{companyProfile.invoiceFooterMessage || t('thankYou')}</p></div>\n            </div>\n            <div className=\"flex justify-end space-x-2 p-6 bg-gray-50 rounded-b-2xl no-print\">\n                <button type=\"button\" onClick={onClose} className=\"px-4 py-2 rounded-lg bg-gray-200\">{t('close')}</button>\n                 {canShare && ( <button onClick={handleSharePDF} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-blue-600 font-semibold\"><Share2 size={18} className=\"mr-2\" /> {t('share')}</button> )}\n                <button onClick={handleDownloadPDF} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-green-600 font-semibold\"><FileText size={18} className=\"mr-2\" /> PDF</button>\n                <button onClick={handlePrint} className=\"flex items-center px-4 py-2 rounded-lg text-white bg-gray-500 font-semibold\"><Printer size={18} className=\"mr-2\" /> {t('print')}</button>\n            </div>\n        </div>\n    );\n});\n\nconst CompanyProfileForm = React.memo(({ onSubmit, initialData, t }) => {\n    const [name, setName] = useState(initialData?.name || '');\n    const [address, setAddress] = useState(initialData?.address || '');\n    const [phone, setPhone] = useState(initialData?.phone || '');\n    const [logo, setLogo] = useState(initialData?.logo || null);\n    const [invoicePrefix, setInvoicePrefix] = useState(initialData?.invoicePrefix || 'FAC-');\n    const [refundPrefix, setRefundPrefix] = useState(initialData?.refundPrefix || 'REM-');\n    const [depositPrefix, setDepositPrefix] = useState(initialData?.depositPrefix || 'DEP-');\n    const [invoiceFooterMessage, setInvoiceFooterMessage] = useState(initialData?.invoiceFooterMessage || 'Merci pour votre achat !');\n    const [language, setLanguage] = useState(initialData?.language || 'fr');\n    const [isDocSettingsVisible, setIsDocSettingsVisible] = useState(false);\n\n    const handleLogoChange = async (e) => {\n        if(e.target.files[0]) { try { const r = await resizeImage(e.target.files[0], 200, 200); setLogo(r); } catch (err) { console.error(err); } }\n    };\n    const handleSubmit = (e) => { e.preventDefault(); onSubmit({ name, address, phone, logo, invoicePrefix, refundPrefix, depositPrefix, invoiceFooterMessage, language }); };\n    \n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <h3 className=\"text-xl font-bold text-gray-700 mb-4\">{t('generalInfo')}</h3>\n             <FormSelect label={t('language')} value={language} onChange={e => setLanguage(e.target.value)}>\n                <option value=\"fr\">{t('francais')}</option>\n                <option value=\"en\">{t('english')}</option>\n            </FormSelect>\n            <div className=\"flex flex-col items-center space-y-2\">\n                <label className=\"w-full text-sm font-medium\">Logo</label>\n                <div className=\"w-32 h-32 rounded-lg bg-gray-100 flex items-center justify-center border-2 border-dashed\">\n                    {logo ? <img src={logo} alt=\"Logo preview\" className=\"w-full h-full object-contain rounded-lg\"/> : <ImageIcon className=\"text-gray-400\" size={40}/>}\n                </div>\n                <input type=\"file\" accept=\"image/*\" onChange={handleLogoChange} className=\"text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"/>\n            </div>\n            <FormField label={t('companyName')} type=\"text\" value={name} onChange={e => setName(e.target.value)} required />\n            <FormField label={t('address')} type=\"text\" value={address} onChange={e => setAddress(e.target.value)} />\n            <FormField label={t('phone')} type=\"tel\" value={phone} onChange={e => setPhone(e.target.value)} />\n            \n            <div className=\"border-t pt-6\">\n                <button type=\"button\" onClick={() => setIsDocSettingsVisible(!isDocSettingsVisible)} className=\"flex justify-between items-center w-full text-left font-semibold text-lg text-gray-700\">\n                    {t('docCustomization')}\n                    <ChevronDown className={`transition-transform ${isDocSettingsVisible ? 'rotate-180' : ''}`} />\n                </button>\n                {isDocSettingsVisible && (\n                    <div className=\"mt-4 space-y-4\">\n                        <FormField label={t('salesInvoicePrefix')} value={invoicePrefix} onChange={e => setInvoicePrefix(e.target.value)} />\n                        <FormField label={t('refundInvoicePrefix')} value={refundPrefix} onChange={e => setRefundPrefix(e.target.value)} />\n                        <FormField label={t('depositReceiptPrefix')} value={depositPrefix} onChange={e => setDepositPrefix(e.target.value)} />\n                        <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t('invoiceFooterMessage')}</label>\n                            <textarea value={invoiceFooterMessage} onChange={e => setInvoiceFooterMessage(e.target.value)} className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\" rows=\"3\"></textarea>\n                        </div>\n                    </div>\n                )}\n            </div>\n            \n            <div className=\"flex justify-end pt-4\">\n                <button type=\"submit\" className=\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\">{t('save')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst PaymentForm = React.memo(({ onSubmit, sale, customers, onClose, t, language }) => {\n    const customer = useMemo(() => customers.find(c => c.id === sale.customerId), [customers, sale]);\n    const remainingBalance = sale.totalPrice - (sale.paidAmount || 0);\n    const [amount, setAmount] = useState(remainingBalance);\n    const [paymentType, setPaymentType] = useState(PAYMENT_TYPES[0]);\n    useEffect(() => {\n        if (paymentType === 'Acompte Client' && customer?.balance) { setAmount(Math.min(remainingBalance, customer.balance)); } \n        else { setAmount(remainingBalance); }\n    }, [paymentType, customer, remainingBalance]);\n    const handleSubmit = (e) => { e.preventDefault(); onSubmit(amount, paymentType); };\n    return (\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <h3 className=\"text-2xl font-bold text-center\">{t('makeAPayment')}</h3>\n            <div className=\"p-4 bg-gray-50 rounded-lg space-y-1\">\n                <p><strong>{t('customers')}:</strong> {sale.customerName}</p>\n                <p className=\"font-bold text-red-600\">{t('remainingBalance')}: {formatCurrency(remainingBalance, language)}</p>\n            </div>\n            <FormField label={t('amountPaid')} type=\"number\" value={amount} onChange={e => setAmount(e.target.value)} required min=\"1\" max={paymentType === 'Acompte Client' ? Math.min(remainingBalance, customer?.balance || 0) : remainingBalance} />\n            <FormSelect label={t('paymentMethod')} value={paymentType} onChange={e => setPaymentType(e.target.value)} required>\n                {PAYMENT_TYPES.filter(p => p !== 'Créance').filter(p => p !== 'Acompte Client' || (customer && customer.balance > 0)).map(type => \n                    <option key={type} value={type}>{type} {type === 'Acompte Client' && `(${t('available')}: ${formatCurrency(customer?.balance || 0, language)})`}</option>\n                )}\n            </FormSelect>\n            <div className=\"flex justify-end space-x-4 pt-4\">\n                <button type=\"button\" onClick={onClose} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('cancel')}</button>\n                <button type=\"submit\" className=\"px-6 py-2 rounded-lg text-white bg-green-500 font-semibold\">{t('savePayment')}</button>\n            </div>\n        </form>\n    );\n});\n\nconst FormField = React.memo(({ label, ...props }) => ( <div><label className=\"block text-sm font-medium text-gray-700 mb-1\">{label}</label><input {...props} className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\" /></div> ));\nconst FormSelect = React.memo(({ label, children, ...props }) => ( <div><label className=\"block text-sm font-medium text-gray-700 mb-1\">{label}</label><select {...props} className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-white\">{children}</select></div> ));\n\nconst StatusBadge = React.memo(({ status }) => {\n    const statusClasses = {\n        [SALE_STATUS.COMPLETED]: 'bg-green-100 text-green-800', \n        [SALE_STATUS.PARTIALLY_RETURNED]: 'bg-yellow-100 text-yellow-800',\n        [SALE_STATUS.RETURNED]: 'bg-red-100 text-red-800', \n        [SALE_STATUS.CREDIT]: 'bg-orange-100 text-orange-800',\n        \"Espèce\": 'bg-blue-100 text-blue-800', \"Wave\": 'bg-cyan-100 text-cyan-800', \"Orange Money\": 'bg-orange-100 text-orange-800', \"Acompte Client\": 'bg-purple-100 text-purple-800'\n    };\n    return <span className={`px-2 py-1 text-xs font-semibold rounded-full capitalize ${statusClasses[status] || 'bg-gray-100 text-gray-800'}`}>{status}</span>;\n});\n\nconst ProductSelectionModal = React.memo(({ products, onAddToCart, openModal, onClose, onProceedToCart, cart, t, language }) => {\n    const [searchTerm, setSearchTerm] = useState('');\n    const filteredProducts = useMemo(() => products.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase())), [products, searchTerm]);\n\n    return (\n        <div>\n            <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-2xl font-bold\">{t('selectProducts')}</h3>\n                <div className=\"relative w-1/3\">\n                    <input type=\"text\" placeholder={t('search')} value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className=\"w-full pl-10 pr-4 py-2 border rounded-lg\"/>\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={20}/>\n                </div>\n            </div>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 max-h-[60vh] overflow-y-auto p-2\">\n                {filteredProducts.map(product => (\n                    <div key={product.id} onClick={() => openModal('productDetails', product, 'md')} className=\"bg-white rounded-lg shadow p-3 flex flex-col items-center text-center cursor-pointer hover:shadow-lg transition-shadow\">\n                        <img src={product.photoURL || 'https://placehold.co/150x150'} alt={product.name} className=\"w-full h-28 object-cover rounded-md mb-2\"/>\n                        <h4 className=\"font-semibold text-sm flex-grow\">{product.name}</h4>\n                        <p className=\"text-blue-600 font-bold text-sm\">{formatCurrency(product.price || product.basePrice, language)}</p>\n                    </div>\n                ))}\n            </div>\n            <div className=\"flex justify-end space-x-4 pt-6 mt-4 border-t\">\n                <button type=\"button\" onClick={onClose} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('cancel')}</button>\n                <button type=\"button\" onClick={onProceedToCart} className=\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold flex items-center\">\n                    {t('viewCart')} <span className=\"ml-2 bg-white text-blue-500 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\">{cart.length}</span>\n                </button>\n            </div>\n        </div>\n    )\n});\n\nconst ProductDetailModal = React.memo(({ product, onAddToCart, onClose, openModal, t, language }) => {\n    const [quantity, setQuantity] = useState(1);\n    const [selectedVariantId, setSelectedVariantId] = useState(product.variants?.[0]?.id || null);\n\n    const handleAddAndReturn = () => {\n        if(product.type === PRODUCT_TYPES.VARIANT) {\n            const variant = product.variants.find(v => v.id === selectedVariantId);\n            if(variant) { \n                onAddToCart(product, quantity, variant);\n                // Re-open product selection modal after adding\n                openModal('productSelection', null, '7xl');\n             }\n        } else {\n            onAddToCart(product, quantity);\n            // Re-open product selection modal after adding\n            openModal('productSelection', null, '7xl');\n        }\n    };\n\n    const selectedVariant = useMemo(() => product.variants?.find(v => v.id === selectedVariantId), [product, selectedVariantId]);\n    const maxQuantity = selectedVariant ? selectedVariant.quantity : product.quantity;\n\n    return (\n        <div className=\"p-4\">\n            <h3 className=\"text-2xl font-bold text-center mb-4\">{product.name}</h3>\n            <img src={product.photoURL || 'https://placehold.co/300x200'} alt={product.name} className=\"w-full h-48 object-cover rounded-lg mb-4\"/>\n            <p className=\"text-center text-xl font-bold text-blue-600 mb-4\">{formatCurrency(selectedVariant ? (product.basePrice || 0) + (selectedVariant.priceModifier || 0) : product.price, language)}</p>\n            <p className=\"text-sm text-gray-600 mb-4\">{product.description}</p>\n            \n            {product.type === PRODUCT_TYPES.VARIANT && (\n                <div className=\"mb-4\">\n                    <label className=\"font-semibold\">{t('variant')}:</label>\n                    <FormSelect value={selectedVariantId} onChange={e => setSelectedVariantId(e.target.value)}>\n                        {product.variants.map(v => (\n                            <option key={v.id} value={v.id}>{v.name} ({t('stock')}: {v.quantity})</option>\n                        ))}\n                    </FormSelect>\n                </div>\n            )}\n\n            <div className=\"flex items-center justify-center gap-4 mb-6\">\n                 <label className=\"font-semibold\">{t('quantity')}:</label>\n                 <input type=\"number\" value={quantity} onChange={e => setQuantity(Number(e.target.value))} min=\"1\" max={maxQuantity} className=\"w-24 text-center border rounded-md p-2\"/>\n            </div>\n            <div className=\"flex justify-center space-x-4\">\n                <button type=\"button\" onClick={() => openModal('editProduct', product, 'lg')} className=\"px-6 py-2 rounded-lg bg-gray-200\">{t('manageStock')}</button>\n                <button type=\"button\" onClick={handleAddAndReturn} className=\"px-6 py-2 rounded-lg text-white bg-blue-500 font-semibold\">{t('addToCart')}</button>\n            </div>\n        </div>\n    );\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}